<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Twenty Forth & Fifth Security</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon.png">
    <link rel="icon" href="favicon.png" type="image/png">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script type="module">
        // Shared Firebase client (auth/db are consistent across all pages)
        import { auth, db } from "./firebase-client.js";
        import { onAuthStateChanged, signOut, signInWithEmailAndPassword } from "firebase/auth";
        import { doc, getDoc, setDoc, collection, addDoc, serverTimestamp } from "firebase/firestore";

        let currentUser = null;

        // Check if the user is authenticated
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                const userDocRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists()) {
                    const userData = userDoc.data();

                    // Format amounts as "1,000.00" (no $ sign)
                    const formatAmount = (value) => {
                        if (!value) return '0.00';
                        const num = typeof value === 'string' 
                            ? parseFloat(value.replace(/[^0-9.-]/g, '')) || 0
                            : Number(value) || 0;
                        return new Intl.NumberFormat('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2,
                        }).format(num);
                    };
                    
                    // Populate the UI with user's first name and other information
                    const profileUsername = document.getElementById('profileUsername');
                    const depositAccount = document.getElementById('Deposit-account');
                    const profitWallet = document.getElementById('Profit-wallet');
                    const wallet = document.getElementById('wallet');
                    const welcomeMessage = document.getElementById('welcome-message');
                    const displayEmail = document.getElementById('displayEmail');

                    if (profileUsername) profileUsername.textContent = userData.firstName || '@syndicate';
                    if (depositAccount) depositAccount.textContent = formatAmount(userData.checking);
                    if (profitWallet) profitWallet.textContent = formatAmount(userData.profit);
                    if (wallet) wallet.textContent = formatAmount(userData.wallet);
                    if (welcomeMessage) welcomeMessage.textContent = `Welcome ${userData.firstName}`;
                    if (displayEmail) displayEmail.textContent = user.email;

                    // Load KYC status - ensure DOM is ready
                    function ensureKYCStatusLoaded() {
                        const kycStatusElement = document.getElementById('kycStatus');
                        if (kycStatusElement) {
                            loadKYCStatus(userData);
                        } else {
                            // Retry if element not found yet
                            setTimeout(ensureKYCStatusLoaded, 50);
                        }
                    }
                    
                    // Try immediately, then retry if needed
                    ensureKYCStatusLoaded();
                } else {
                    console.log('No user document found.');
                    alert('No user data found.');
                }
            } else {
                console.log('No user signed in. Redirecting to sign-in page.');
                window.location.href = 'login.html';
            }
        });

        // Load KYC status
        async function loadKYCStatus(userData) {
            console.log('=== Loading KYC Status ===');
            console.log('Full userData:', userData);
            console.log('KYC Status value:', userData.kycStatus);
            console.log('KYC Status type:', typeof userData.kycStatus);
            
            const kycStatus = userData.kycStatus || 'not_completed';
            const kycStatusElement = document.getElementById('kycStatus');
            const kycStatusBadge = document.getElementById('kycStatusBadge');
            const kycUploadSection = document.getElementById('kycUploadSection');
            const kycCompletedMessage = document.getElementById('kycCompletedMessage');
            const kycPendingMessage = document.getElementById('kycPendingMessage');
            const kycRejectedMessage = document.getElementById('kycRejectedMessage');

            if (!kycStatusElement || !kycStatusBadge) {
                console.error('KYC status elements not found');
                console.error('kycStatusElement:', kycStatusElement);
                console.error('kycStatusBadge:', kycStatusBadge);
                return;
            }

            // Reset all messages
            if (kycCompletedMessage) kycCompletedMessage.classList.add('hidden');
            if (kycPendingMessage) kycPendingMessage.classList.add('hidden');
            if (kycRejectedMessage) kycRejectedMessage.classList.add('hidden');

            // Check status - match dashboard logic exactly (direct comparison first, then normalized)
            const statusStr = String(kycStatus || '').trim();
            const normalizedStatus = statusStr.toLowerCase();
            console.log('Raw status:', statusStr, 'Type:', typeof kycStatus);
            console.log('Normalized status:', normalizedStatus);
            console.log('Checking if status is approved or completed...');

            // Check for approved status - match dashboard exactly (direct comparison like dashboard)
            // Dashboard uses: kycStatus === 'approved' || kycStatus === 'completed'
            const isApproved = (statusStr === 'approved' || statusStr === 'completed' || 
                               normalizedStatus === 'approved' || normalizedStatus === 'completed' || 
                               normalizedStatus === 'verified');
            
            console.log('Is approved?', isApproved);
            
            if (isApproved) {
                console.log('✅ User is APPROVED - Setting verified tier 3 badge');
                kycStatusElement.innerHTML = '<i class="fas fa-star text-yellow-400 mr-1"></i> KYC Verified Tier 3';
                kycStatusBadge.className = 'px-3 py-1 rounded text-xs font-medium bg-gradient-to-r from-yellow-500 to-yellow-600 text-white';
                kycStatusBadge.style.display = 'inline-flex';
                kycStatusBadge.style.alignItems = 'center';
                kycStatusBadge.style.gap = '4px';
                if (kycUploadSection) kycUploadSection.classList.add('hidden');
                if (kycCompletedMessage) kycCompletedMessage.classList.remove('hidden');
                // Ensure the KYC section card is visible
                const kycSection = document.querySelector('.bg-white.border.border-gray-300.rounded-lg.p-6');
                if (kycSection) {
                    kycSection.style.display = 'block';
                }
                console.log('✅ Badge updated successfully');
                return; // Exit early to prevent fallthrough
            } else if (normalizedStatus === 'rejected') {
                console.log('Status is REJECTED');
                kycStatusElement.textContent = 'KYC Rejected';
                kycStatusBadge.className = 'px-3 py-1 rounded text-xs font-medium bg-red-600 text-white';
                if (kycUploadSection) kycUploadSection.classList.remove('hidden');
                if (kycRejectedMessage) kycRejectedMessage.classList.remove('hidden');
            } else if (normalizedStatus === 'reviewed') {
                console.log('Status is REVIEWED');
                kycStatusElement.textContent = 'KYC Under Review';
                kycStatusBadge.className = 'px-3 py-1 rounded text-xs font-medium bg-green-600 text-white';
                if (kycUploadSection) kycUploadSection.classList.add('hidden');
                if (kycPendingMessage) {
                    kycPendingMessage.classList.remove('hidden');
                    kycPendingMessage.innerHTML = '<p class="text-sm text-gray-700"><strong class="text-gray-900">Status:</strong> Your KYC document has been reviewed and is being processed. You will be notified once a decision is made.</p>';
                }
            } else if (normalizedStatus === 'pending') {
                console.log('Status is PENDING');
                kycStatusElement.textContent = 'KYC Pending Review';
                kycStatusBadge.className = 'px-3 py-1 rounded text-xs font-medium bg-gray-600 text-white';
                if (kycUploadSection) kycUploadSection.classList.add('hidden');
                if (kycPendingMessage) {
                    kycPendingMessage.classList.remove('hidden');
                    kycPendingMessage.innerHTML = '<p class="text-sm text-gray-700"><strong class="text-gray-900">Status:</strong> Your KYC document is currently under review. You will be notified once the verification is complete.</p>';
                }
            } else {
                console.log('❌ Status is NOT COMPLETED. Normalized value:', normalizedStatus);
                console.log('Setting default "KYC Not Completed"');
                kycStatusElement.textContent = 'KYC Not Completed';
                kycStatusBadge.className = 'px-3 py-1 rounded text-xs font-medium bg-gray-400 text-white';
                if (kycUploadSection) kycUploadSection.classList.remove('hidden');
            }
            console.log('=== KYC Status Load Complete ===');
        }
        
        // Make function available globally for debugging
        window.loadKYCStatus = loadKYCStatus;
        
        // Re-check KYC status when page becomes visible (handles tab switching)
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && currentUser) {
                const userDocRef = doc(db, 'users', currentUser.uid);
                getDoc(userDocRef).then(userDoc => {
                    if (userDoc.exists()) {
                        loadKYCStatus(userDoc.data());
                    }
                });
            }
        });

        // Sign out function
        window.signOut = function () {
            signOut(auth).then(() => {
                alert('Signed out successfully!');
                window.location.href = 'login.html';
            }).catch((error) => {
                alert('Error signing out: ' + error.message);
            });
        };

        // Handle PIN submission
        const changePinForm = document.getElementById("changePinForm");
        changePinForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const newPin = document.getElementById("newPin").value;

            if (newPin.length !== 5 || isNaN(newPin)) {
                alert("Please enter a valid 5-digit PIN.");
                return;
            }

            // Show loading state
            const submitButton = document.getElementById("submitButton");
            submitButton.disabled = true;
            submitButton.textContent = 'Processing...';

            // Show password modal after a short delay
            setTimeout(() => {
                document.getElementById("passwordModal").classList.remove("hidden");
                submitButton.disabled = false;
                submitButton.textContent = 'Change PIN';
            }, 1000);
        });

        // Handle password confirmation
        const passwordConfirmForm = document.getElementById("passwordConfirmForm");
        passwordConfirmForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("email").value;
            const firebasePassword = document.getElementById("firebasePassword").value;
            const newPin = document.getElementById("newPin").value;

            const confirmButton = passwordConfirmForm.querySelector('button[type="submit"]');
            confirmButton.disabled = true;
            confirmButton.textContent = 'Processing...';

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, firebasePassword);
                const user = userCredential.user;

                if (user) {
                    const userDocRef = doc(db, 'users', user.uid);
                    await setDoc(userDocRef, { pin: newPin }, { merge: true });

                    const successMessage = document.createElement('div');
                    successMessage.textContent = "PIN Change updated!";
                    successMessage.className = "text-gray-700 text-xs text-center mt-4";

                    const modalBody = passwordConfirmForm.parentElement;
                    modalBody.appendChild(successMessage);

                    setTimeout(() => {
                        document.getElementById("passwordModal").classList.add("hidden");
                    }, 2000);
                }
            } catch (error) {
                console.error('Error updating PIN:', error);
                alert('Error updating PIN: ' + error.message);
            } finally {
                confirmButton.disabled = false;
                confirmButton.textContent = 'Confirm';
            }
        });

        // Handle KYC ID upload
        window.handleKYCUpload = async function() {
            const fileInput = document.getElementById('kycIdFile');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a valid government issued ID image.');
                return;
            }

            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                alert('Please upload a valid image file (JPEG, PNG, or WebP).');
                return;
            }

            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('File size must be less than 5MB.');
                return;
            }

            const uploadButton = document.getElementById('uploadKYCButton');
            uploadButton.disabled = true;
            uploadButton.textContent = 'Uploading...';

            try {
                // Convert image to base64
                const base64 = await convertToBase64(file);

                // Get user data
                const user = auth.currentUser;
                if (!user) {
                    throw new Error('User not authenticated');
                }

                // Create KYC request document
                const kycRequest = {
                    userId: user.uid,
                    userEmail: user.email,
                    idImageBase64: base64,
                    status: 'pending',
                    submittedAt: serverTimestamp(),
                    reviewedAt: null,
                    reviewedBy: null
                };

                // Save to KYC collection
                await addDoc(collection(db, 'kyc_requests'), kycRequest);

                // Update user's KYC status to pending and save image link
                const userDocRef = doc(db, 'users', user.uid);
                await setDoc(userDocRef, { 
                    kycStatus: 'pending',
                    kycIdImageLink: base64  // Save image link in user's document
                }, { merge: true });

                // Show success modal
                document.getElementById('kycSuccessModal').classList.remove('hidden');
                
                // Hide upload section and show pending message
                document.getElementById('kycUploadSection').classList.add('hidden');
                document.getElementById('kycPendingMessage').classList.remove('hidden');
                
                // Reload KYC status
                const userDoc = await getDoc(userDocRef);
                if (userDoc.exists()) {
                    loadKYCStatus(userDoc.data());
                }

                // Reset file input
                fileInput.value = '';
                document.getElementById('kycImagePreview').src = '';
                document.getElementById('imagePreviewContainer').classList.add('hidden');
            } catch (error) {
                console.error('Error uploading KYC:', error);
                alert('Error uploading KYC document: ' + error.message);
            } finally {
                uploadButton.disabled = false;
                uploadButton.textContent = 'Upload ID';
            }
        };

        // Convert file to base64
        function convertToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64String = reader.result;
                    resolve(base64String);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Toggle PIN visibility
        window.togglePinVisibility = function() {
            const pinInput = document.getElementById("newPin");
            const eyeIcon = document.getElementById("eyeIcon");

            if (pinInput.type === "password") {
                pinInput.type = "text";
                eyeIcon.innerHTML = `<path d="M17.94 17.94A10.09 10.09 0 0 1 12 20c-7 0-11-8-11-8a18.66 18.66 0 0 1 3-4m3.53-2.36A10.09 10.09 0 0 1 12 4c7 0 11 8 11 8a18.3 18.3 0 0 1-1.72 2.82M15 12a3 3 0 1 0-3 3m8.17 8.17L3 3"></path>`;
            } else {
                pinInput.type = "password";
                eyeIcon.innerHTML = `<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>`;
            }
        };

        // Preview uploaded image
        window.previewKYCImage = function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('kycImagePreview');
                    const container = document.getElementById('imagePreviewContainer');
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    container.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        };

        // Close KYC success modal
        window.closeKYCSuccessModal = function() {
            document.getElementById('kycSuccessModal').classList.add('hidden');
        };

        // Mobile menu functionality
        const mobileMenu = document.getElementById('mobile-menu');
        const overlay = document.getElementById('overlay');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const closeMenuButton = document.getElementById('close-menu');

        if (mobileMenu && overlay && mobileMenuButton && closeMenuButton) {
            function openMenu() {
                mobileMenu.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            function closeMenu() {
                mobileMenu.classList.add('translate-x-full');
                overlay.classList.add('hidden');
                document.body.style.overflow = '';
            }

            mobileMenuButton.addEventListener('click', openMenu);
            closeMenuButton.addEventListener('click', closeMenu);
            overlay.addEventListener('click', closeMenu);
            
            // Close menu when clicking links
            mobileMenu.querySelectorAll('a').forEach(a => {
                a.addEventListener('click', closeMenu);
            });
        }
    </script>

    <style>
        body {
            background: #f5f5f5;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: pan-y;
        }
        input, textarea, button, a {
            -webkit-user-select: auto;
            user-select: auto;
            touch-action: auto;
        }
    </style>
    <style>
        :root {
            --ttf-brand: #16a34a;
            --ttf-brand-hover: #15803d;
        }
        .bg-gray-900 { background-color: var(--ttf-brand) !important; }
        .bg-gray-800 { background-color: var(--ttf-brand-hover) !important; }
        .hover\:bg-gray-800:hover { background-color: var(--ttf-brand-hover) !important; }
        .focus\:ring-gray-800:focus { --tw-ring-color: var(--ttf-brand-hover) !important; }
        .bg-black { background-color: rgba(22, 163, 74, 0.55) !important; }
    </style>

</head>

<body class="font-sans antialiased">

   <!-- Navbar -->
<nav class="bg-white border-b border-gray-300 p-4 shadow-sm">
    <div class="container mx-auto flex items-center justify-between">
        <img src="11.png" alt="Twenty Forth & Fifth Logo" class="h-14 md:h-16 w-auto">
        <div class="flex items-center gap-3">
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="md:hidden text-gray-800 focus:outline-none" aria-label="Open menu">
                <i class="fas fa-bars text-2xl"></i>
            </button>
            <button onclick="signOut()"
                class="bg-white border border-gray-400 text-xs text-gray-800 px-4 md:px-6 py-2 rounded-full hover:bg-gray-50 transition">Sign Out</button>
        </div>
    </div>
</nav>

<!-- Mobile Menu -->
<div id="mobile-menu" class="fixed inset-0 bg-white shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out md:hidden z-50">
    <div class="p-6">
        <button id="close-menu" class="absolute top-4 right-4 text-2xl text-gray-800" aria-label="Close menu">✖</button>
        <nav class="w-full flex flex-col items-center space-y-4 mt-10">
            <a href="dashboard.html" class="w-4/5 py-3 text-center border border-gray-300 text-gray-900 text-sm font-medium bg-white rounded hover:bg-gray-50 transition">Home</a>
            <a href="deposit.html" class="w-4/5 py-3 text-center border border-gray-300 text-gray-900 text-sm font-medium bg-white rounded hover:bg-gray-50 transition">Deposit</a>
            <a href="support.html" class="w-4/5 py-3 text-center border border-gray-300 text-gray-900 text-sm font-medium bg-white rounded hover:bg-gray-50 transition">Support</a>
            <a href="profile.html" class="w-4/5 py-3 text-center border border-gray-300 text-gray-900 text-sm font-medium bg-white rounded hover:bg-gray-50 transition">Profile</a>
            <a href="security.html" class="w-4/5 py-3 text-center border border-gray-300 text-gray-900 text-sm font-medium bg-white rounded hover:bg-gray-50 transition">Security</a>
        </nav>
    </div>
</div>
<div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40"></div>

<!-- Main Content -->
<div class="min-h-screen bg-gray-100 py-6 md:py-12 px-4 sm:px-6 lg:px-8 pb-48 md:pb-20"> 
    
    <!-- Security Header -->
    <div class="max-w-6xl mx-auto mb-8">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900 text-center mb-2">Security Settings</h1>
        <p class="text-gray-600 text-center text-sm md:text-base">Manage your PIN and KYC verification</p>
    </div>

    <div class="max-w-6xl mx-auto">
        
        <!-- Change PIN Section -->
        <div class="bg-white border border-gray-300 rounded-lg p-6 md:p-8 mb-6 shadow-sm">
            <div class="flex items-start gap-4 mb-6">
                <div class="bg-gray-900 rounded-lg p-3 flex-shrink-0">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
                <div class="flex-1">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-1">Change PIN</h2>
                    <p class="text-gray-600 text-sm">Update your 5-digit PIN for account security</p>
                </div>
            </div>

            <form id="changePinForm" class="space-y-6">
                <div class="relative">
                    <label for="newPin" class="block text-sm font-medium text-gray-700 mb-2">Enter New PIN</label>
                    <div class="relative">
                        <input 
                            type="password" 
                            id="newPin" 
                            maxlength="5" 
                            placeholder="5-digit PIN"
                            class="w-full border border-gray-400 rounded-lg p-3 md:p-4 text-gray-900 text-base focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-gray-800 pr-12 bg-white transition-all"
                            required 
                        />
                        <button type="button" onclick="togglePinVisibility()" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors">
                            <svg id="eyeIcon" class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                    <p class="mt-2 text-xs text-gray-500">Your PIN must be exactly 5 digits and can only be updated 3 times every 30 days</p>
                </div>
              
                <button type="submit" id="submitButton"
                    class="w-full bg-gray-900 hover:bg-gray-800 text-white font-semibold text-base py-3 md:py-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-gray-800 focus:ring-offset-2">
                    Change PIN
                </button>
            </form>
        </div>

        <!-- KYC Verification Section -->
        <div class="bg-white border border-gray-300 rounded-lg p-6 md:p-8 shadow-sm mb-24 md:mb-12">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                <div class="flex items-start gap-4">
                    <div class="bg-gray-900 rounded-lg p-3 flex-shrink-0">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"></path>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-1">KYC Verification</h2>
                        <p class="text-gray-600 text-sm">Verify your identity with a government-issued ID</p>
                    </div>
                </div>
                <div>
                    <span id="kycStatusBadge" class="inline-block px-3 py-1 rounded text-xs font-medium bg-gray-400 text-white">
                        <span id="kycStatus">KYC Not Completed</span>
                    </span>
                </div>
            </div>

            <!-- KYC Upload Section -->
            <div id="kycUploadSection" class="space-y-6">
                <div class="bg-gray-50 border border-gray-300 rounded-lg p-4">
                    <div class="flex items-start gap-2">
                        <svg class="w-5 h-5 text-gray-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        <div>
                            <p class="text-sm font-semibold text-gray-900 mb-1">Important Notice</p>
                            <p class="text-sm text-amber-800 mb-2">
                                Users without completed KYC verification may experience transfer restrictions and limited access to certain account features.
                            </p>
                            <p class="text-sm text-gray-700">
                                Please upload a clear image of a valid government-issued identity card (Driver's License, Passport, National ID, etc.). The image will be reviewed by our administration team.
                            </p>
                        </div>
                    </div>
                </div>

                <div>
                    <label for="kycIdFile" class="block text-sm font-medium text-gray-700 mb-2">Upload Government ID</label>
                    <input 
                        type="file" 
                        id="kycIdFile" 
                        accept="image/jpeg,image/jpg,image/png,image/webp"
                        onchange="previewKYCImage(event)"
                        class="w-full border border-gray-400 rounded-lg p-3 md:p-4 text-gray-900 text-sm md:text-base focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-gray-800 bg-white transition-all file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-gray-800 file:text-white hover:file:bg-gray-700"
                        required 
                    />
                    <p class="mt-2 text-xs text-gray-500">Accepted formats: JPEG, PNG, WebP (Max 5MB)</p>
                </div>

                <!-- Image Preview -->
                <div id="imagePreviewContainer" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Preview</label>
                    <div class="border border-gray-300 rounded-lg p-4 bg-gray-50">
                        <img id="kycImagePreview" src="" alt="ID Preview" class="max-w-full h-auto rounded-lg max-h-64 mx-auto">
                    </div>
                </div>

                <button 
                    type="button" 
                    id="uploadKYCButton"
                    onclick="handleKYCUpload()"
                    class="w-full bg-gray-900 hover:bg-gray-800 text-white font-semibold text-base py-3 md:py-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-gray-800 focus:ring-offset-2">
                    Upload ID
                </button>
            </div>

            <!-- KYC Pending Message -->
            <div id="kycPendingMessage" class="hidden bg-gray-50 border border-gray-300 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                    <strong class="text-gray-900">Status:</strong> Your KYC document is currently under review. You will be notified once the verification is complete.
                </p>
            </div>

            <!-- KYC Approved Message -->
            <div id="kycCompletedMessage" class="hidden bg-green-50 border border-green-300 rounded-lg p-4">
                <div class="flex items-start gap-3">
                    <div class="flex-shrink-0">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-semibold text-green-900 mb-1">KYC Verification Approved</p>
                        <p class="text-sm text-green-700">
                            Your KYC verification has been successfully approved. Your account now has full access to all features and services.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- KYC Rejected Message -->
            <div id="kycRejectedMessage" class="hidden bg-gray-50 border border-gray-300 rounded-lg p-4 mt-6">
                <p class="text-sm text-gray-700">
                    <strong class="text-gray-900">✗ Rejected:</strong> Your KYC verification was not approved. Please upload a new valid government-issued ID document.
                </p>
            </div>
        </div>

    </div>
</div>

<!-- KYC Upload Success Modal -->
<div id="kycSuccessModal" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg p-6 md:p-8 w-full max-w-md mx-auto border border-gray-300 shadow-xl">
        <div class="flex items-center justify-center mb-4">
            <div class="w-16 h-16 bg-gray-900 rounded-full flex items-center justify-center">
                <svg class="w-8 h-8 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414L9 11.586l6.293-6.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
            </div>
        </div>
        <h3 class="text-xl font-bold text-gray-900 text-center mb-2">KYC Document Uploaded Successfully</h3>
        <p class="text-gray-600 text-center mb-6 text-sm">
            Your ID card has been uploaded successfully. Your KYC verification is now being reviewed by our team. You will be notified once the review is complete.
        </p>
        <div class="bg-gray-50 border-l-4 border-gray-800 rounded-lg p-4 mb-6">
            <div class="flex items-start">
                <svg class="w-5 h-5 text-gray-800 mt-0.5 mr-3 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
                <div class="text-sm text-gray-700">
                    <p class="font-semibold text-gray-900 mb-1">What's Next?</p>
                    <p class="text-gray-600">Our team will review your document within 1-3 business days. You can check your verification status in the Security section.</p>
                </div>
            </div>
        </div>
        <button type="button" onclick="closeKYCSuccessModal()"
            class="w-full bg-gray-900 hover:bg-gray-800 text-white font-semibold text-base py-3 md:py-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-gray-800 focus:ring-offset-2">
            Got it
        </button>
    </div>
</div>

<!-- Password Confirmation Modal -->
<div id="passwordModal" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg p-6 md:p-8 w-full max-w-md mx-auto border border-gray-300 shadow-xl">
        <div class="flex items-center justify-center mb-4">
            <div class="bg-gray-900 rounded-full p-2">
                <svg class="w-6 h-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
            </div>
        </div>
        <h3 class="text-xl font-bold text-gray-900 text-center mb-2">Confirm PIN Change</h3>
        <p class="text-gray-600 text-center mb-6 text-sm">
            Please enter your account email and password to confirm the PIN change.
        </p>
        <form id="passwordConfirmForm" class="space-y-6">
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input type="email" id="email" placeholder="Your email"
                    class="w-full border border-gray-400 rounded-lg p-3 md:p-4 text-gray-900 text-base focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-gray-800 bg-white transition-all"
                    required />
            </div>
    
            <div>
                <label for="firebasePassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                <input type="password" id="firebasePassword" placeholder="Your password"
                    class="w-full border border-gray-400 rounded-lg p-3 md:p-4 text-gray-900 text-base focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-gray-800 bg-white transition-all"
                    required />
            </div>
    
            <div class="flex flex-col sm:flex-row gap-3 pt-2">
                <button type="submit"
                    class="flex-1 bg-gray-900 hover:bg-gray-800 text-white font-semibold text-base py-3 md:py-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-gray-800 focus:ring-offset-2">
                    Confirm
                </button>
                <button type="button" id="cancelButton"
                class="flex-1 bg-white border border-gray-400 text-gray-700 font-semibold text-base py-3 md:py-4 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-800 transition-all"
                onclick="document.getElementById('passwordModal').classList.add('hidden');">
                Cancel
                </button>
            </div>
        </form>
    </div>
</div>

    <!-- Bottom Navbar (Mobile Friendly) -->
    <div class="mobile-nav fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-gray-300 p-3" style="height: 100px;">
        <div class="flex justify-around items-center h-full">
            <!-- Wallet Icon -->
            <a href="dashboard.html" class="nav-item flex flex-col items-center" onclick="setActive(this)">
                <div class="bg-white rounded p-2">
                    <img src="1221.png" alt="Wallet Icon" class="h-6 w-6" />
                </div>
                <span class="text-xs font-medium mt-2 text-gray-700">Home</span>
            </a>
            <!-- Deposit Icon -->
            <a href="deposit.html" class="nav-item flex flex-col items-center" onclick="setActive(this)">
                <div class="bg-white rounded p-2">
                    <img src="deposit.png" alt="Redeem Icon" class="h-6 w-6" />
                </div>
                <span class="text-xs font-medium mt-2 text-gray-700">Deposit</span>
            </a>
            <!-- Verify Icon -->
            <a href="support.html" class="nav-item flex flex-col items-center" onclick="setActive(this)">
                <div class="bg-white rounded p-2">
                    <img src="support.png" alt="Support Icon" class="h-6 w-6" />
                </div>
                <span class="text-xs font-medium mt-2 text-gray-700">Support</span>
            </a>
            <!-- Profile Icon -->
            <a href="profile.html" class="nav-item flex flex-col items-center" onclick="setActive(this)">
                <div class="bg-white rounded p-2">
                    <img src="profile.png" alt="Profile Icon" class="h-6 w-6" />
                </div>
                <span class="text-xs font-medium mt-2 text-gray-700">Profile</span>
            </a>
        </div>
    </div>

    <!-- Inactivity Timeout: Auto-logout after 5 minutes of inactivity -->
    <script src="inactivity-timeout.js"></script>
</body>

</html>
