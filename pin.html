<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beal Offshore Ltd PIN</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="logo new.png">
    <link rel="icon" href="logo new.png" type="image/png">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script type="module">
        // Import Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
        apiKey: "AIzaSyABYV12B7RM2ZCD2G1lFTLpgJwflJFwEXY",
        authDomain: "beal-offshore.firebaseapp.com",
        projectId: "beal-offshore",
        storageBucket: "beal-offshore.firebasestorage.app",
        messagingSenderId: "1091834410162",
        appId: "1:1091834410162:web:56285433b5751e681745ab",
        measurementId: "G-CT463F3T6J"
        };


        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Check if the user is authenticated
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userDocRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists()) {
                    const userData = userDoc.data();

                    // Populate the UI with user's first name and other information
                    document.getElementById('firstName').value = userData.firstName || '';
                    document.getElementById('firstName').placeholder = userData.firstName || 'First Name';

                    document.getElementById('profileUsername').textContent = userData.firstName || '@syndicate';
                    document.getElementById('Deposit-account').textContent = userData.deposit || '0.00';
                    document.getElementById('Profit-wallet').textContent = userData.profit || '0.00';
                    document.getElementById('wallet').textContent = userData.wallet || '0.00';
                    document.getElementById('welcome-message').textContent = `Welcome ${userData.firstName}`;
                    document.getElementById('displayEmail').textContent = user.email;
                } else {
                    console.log('No user document found.');
                    alert('No user data found.');
                }
            } else {
                console.log('No user signed in. Redirecting to sign-in page.');
                window.location.href = 'login.html';
            }
        });

        // Sign out function
        window.signOut = function () {
            signOut(auth).then(() => {
                alert('Signed out successfully!');
                window.location.href = 'login.html';
            }).catch((error) => {
                alert('Error signing out: ' + error.message);
            });
        };

        // Function to update user profile
        async function updateProfile() {
            const user = auth.currentUser;
            if (user) {
                const userDocRef = doc(db, 'users', user.uid);

                const updatedData = {
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim(),
                };

                const saveButton = document.querySelector('button[type="submit"]');
                saveButton.disabled = true;
                saveButton.textContent = 'Saving changes...';

                try {
                    await setDoc(userDocRef, updatedData, { merge: true });
                    alert('Profile updated successfully!');
                } catch (error) {
                    console.error('Error updating profile:', error);
                    alert('Error updating profile: ' + error.message);
                } finally {
                    saveButton.disabled = false;
                    saveButton.textContent = 'Save Changes';
                }
            } else {
                alert('No user is currently signed in.');
            }
        }

        // Function to show user info
        async function showUserInfo() {
            const user = auth.currentUser;
            if (user) {
                const userDocRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists()) {
                    const userData = userDoc.data();

                    // Populate the profile form fields with user data
                    document.getElementById('firstName').value = userData.firstName || '';
                    document.getElementById('firstName').placeholder = userData.firstName || 'First Name';
                    document.getElementById('email').value = user.email;
                    document.getElementById('phone').value = userData.phone || '';

                    // Make the profile info div visible
                    const userInfoDiv = document.getElementById('profileInfoCard');
                    userInfoDiv.classList.remove('hidden');
                } else {
                    console.log('No user document found.');
                    alert('No user data found.');
                }
            } else {
                alert('No user is currently signed in.');
            }
        }

        // Handle PIN submission
        const changePinForm = document.getElementById("changePinForm");
        changePinForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const newPin = document.getElementById("newPin").value;

            if (newPin.length !== 5 || isNaN(newPin)) {
                alert("Please enter a valid 5-digit PIN.");
                return;
            }

            // Show loading state
            const submitButton = document.getElementById("submitButton");
            submitButton.disabled = true; // Disable the button
            submitButton.textContent = 'Processing...'; // Change button text

            // Show password modal after a short delay to simulate loading
            setTimeout(() => {
                document.getElementById("passwordModal").classList.remove("hidden");
                submitButton.disabled = false; // Re-enable the button after showing the modal
                submitButton.textContent = 'Change PIN'; // Reset button text
            }, 1000); // Adjust the delay as needed
        });

        // Handle password confirmation
        const passwordConfirmForm = document.getElementById("passwordConfirmForm");
        passwordConfirmForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("email").value;
            const firebasePassword = document.getElementById("firebasePassword").value;
            const newPin = document.getElementById("newPin").value; // Get the new PIN from the previous form

            // Get the confirm button
            const confirmButton = passwordConfirmForm.querySelector('button[type="submit"]');
            confirmButton.disabled = true; // Disable the button
            confirmButton.textContent = 'Processing...'; // Change button text

            // Simulate processing time before showing success message
            setTimeout(() => {
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.textContent = "PIN Change updated!";
                successMessage.className = "text-blue-700 text-xs text-center mt-4";

                // Append to the modal body (the div containing the form)
                const modalBody = passwordConfirmForm.parentElement; // Get the parent of the form
                modalBody.appendChild(successMessage); // Append the success message

                // Hide modal after a short delay (optional)
                setTimeout(() => {
                    document.getElementById("passwordModal").classList.add("hidden");
                }, 2000); // Adjust the delay as needed
            }, 1000); // Simulate processing time (1 second)

            // Re-enable the button and reset text after processing
            setTimeout(() => {
                confirmButton.disabled = false;
                confirmButton.textContent = 'Confirm';
            }, 1000); // Reset button state after the same delay
        });
    </script>


</head>


<body class="font-sans antialiased" style="background-image: url('/Users/circo-mac005/Documents/Beal Offshore Ltd/background 6.png');">

   <!-- Navbar -->
<nav class="bg-white p-4 shadow">
    <div class="container mx-auto flex items-center justify-between">
        <img src="Logo.png" alt="Beal Offshore Ltd Logo" class="h-14">
        <button onclick="signOut()"
            class="bg-white border-b-2 text-xs text-black px-6 py-2 rounded-full hover:bg-white border">Sign Out</button>
    </div>
</nav>

<!-- Main Content -->
<div class="flex flex-col items-center justify-start min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"> 
    <!-- Card Container -->
    <div class="bg-white border rounded-2xl p-8 w-full max-w-3xl mx-auto flex flex-col md:flex-row justify-between transform transition-all duration-300 hover:shadow-2xl">
        <!-- Form Section -->
        <div class="w-full md:w-1/2 pr-0 md:pr-6">
            <!-- Card Header -->
            <div class="flex items-center justify-center mb-2">
                <div class="bg-blue-50 rounded-full p-3">
                    <span class="text-2xl">ðŸ”’</span>
                </div>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-3">Change PIN</h2>
            <p class="text-gray-500 text-center mb-8 text-sm">
                For first-time users, use the OTP from sign-in as your temporary PIN, then proceed to set a new secure PIN.            
            </p>

            <!-- Input Fields -->
            <form id="changePinForm" class="space-y-8">
                <!-- New PIN -->
                <div class="relative">
                    <label for="newPin" class="block text-sm font-medium text-gray-700 mb-2">Enter New PIN</label>
                    <div class="relative rounded-lg shadow-sm">
                        <input 
                            type="password" 
                            id="newPin" 
                            maxlength="5" 
                            placeholder="5-digit PIN"
                            class="w-full border border-gray-300 rounded-lg p-4 text-gray-800 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-10 transition-all duration-200 bg-gray-50"
                            required 
                        />
                        <button type="button" onclick="togglePinVisibility()" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors duration-150">
                            <svg id="eyeIcon" class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                    <p class="mt-2 text-xs text-gray-400">Your PIN must be exactly 5 digits</p>
                </div>

                <script>
                function togglePinVisibility() {
                    const pinInput = document.getElementById("newPin");
                    const eyeIcon = document.getElementById("eyeIcon");

                    if (pinInput.type === "password") {
                        pinInput.type = "text";
                        eyeIcon.innerHTML = `<path d="M17.94 17.94A10.09 10.09 0 0 1 12 20c-7 0-11-8-11-8a18.66 18.66 0 0 1 3-4m3.53-2.36A10.09 10.09 0 0 1 12 4c7 0 11 8 11 8a18.3 18.3 0 0 1-1.72 2.82M15 12a3 3 0 1 0-3 3m8.17 8.17L3 3"></path>`;
                    } else {
                        pinInput.type = "password";
                        eyeIcon.innerHTML = `<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>`;
                    }
                }
                </script>
              
                <!-- Submit Button -->
                <button type="submit" id="submitButton"
                    class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold text-base py-4 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-300 transform hover:-translate-y-px focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75 shadow-md hover:shadow-lg">
                    Change PIN
                </button>
            </form>
        </div>

        <!-- Image Section -->
        <div class="hidden md:block md:w-1/2 bg-cover bg-center rounded-xl ml-4 overflow-hidden"
            style="background-image: url('happy-woman-writing-notepad.jpg');">
            <div class="w-full h-full bg-gradient-to-br from-blue-400 to-purple-500 opacity-75">
                <div class="flex flex-col items-center justify-center h-full p-6 text-white">
                    <svg class="w-16 h-16 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                    <h3 class="text-xl font-bold mb-2">Security First</h3>
                    <p class="text-center text-sm opacity-90">Your security is our priority. Keeping your PIN up-to-date helps protect your account.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Password Confirmation Modal -->
<div id="passwordModal" class="hidden fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl p-8 w-full max-w-md mx-auto border transform transition-all duration-300">
        <!-- Modal Header -->
        <div class="flex items-center justify-center mb-3">
            <div class="bg-blue-50 rounded-full p-2">
                <svg class="w-6 h-6 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
            </div>
        </div>
        <h3 class="text-xl font-bold text-gray-800 text-center mb-2">Confirm PIN Change</h3>
        <p class="text-gray-500 text-center mb-6 text-sm">
            Please enter your account email and password to confirm the PIN change.
        </p>
        <form id="passwordConfirmForm" class="space-y-6">
            <!-- Email Field -->
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input type="email" id="email" placeholder="Your email"
                    class="w-full border border-gray-300 rounded-lg p-4 text-gray-800 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 transition-all duration-200"
                    required />
            </div>
    
            <!-- Password Field -->
            <div>
                <label for="firebasePassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                <input type="password" id="firebasePassword" placeholder="Your password"
                    class="w-full border border-gray-300 rounded-lg p-4 text-gray-800 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 transition-all duration-200"
                    required />
            </div>
    
            <!-- Button Group -->
            <div class="flex flex-col sm:flex-row justify-between space-y-4 sm:space-y-0 sm:space-x-4 pt-2">
                <!-- Confirm Button -->
                <button type="submit"
                    class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold text-base py-4 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-300 transform hover:-translate-y-px focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75 shadow-md">
                    Confirm
                </button>
                <!-- Cancel Button -->
                <button type="button" id="cancelButton"
                class="w-full bg-gray-100 text-gray-700 font-semibold text-base py-4 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400 transition-all duration-300"
                onclick="window.location.href='pin.html';">
                Cancel
                </button>
            </div>
        </form>
    </div>
</div>






    <!-- Bottom Navbar (Mobile Friendly) -->
    <div class="mobile-nav fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t p-3" style="height: 100px;">
        <div class="flex justify-around items-center h-full">
            <!-- Wallet Icon -->
            <a href="dashboard.html" class="nav-item flex flex-col items-center" onclick="setActive(this)">
                <div class="bg-white rounded p-2">
                    <img src="1221.png" alt="Wallet Icon" class="h-6 w-6" />
                </div>
                <span class="text-xs font-medium mt-2">Home</span>
            </a>
            <!-- Deposit Icon -->
            <a href="deposit.html" class="nav-item flex flex-col items-center" onclick="setActive(this)">
                <div class="bg-white rounded p-2">
                    <img src="deposit.png" alt="Redeem Icon" class="h-6 w-6" />
                </div>
                <span class="text-xs font-medium mt-2">Deposit</span>
            </a>
            <!-- Verify Icon -->
            <a href="support.html" class="nav-item flex flex-col items-center" onclick="setActive(this)">
                <div class="bg-white rounded p-2">
                    <img src="support.png" alt="Support Icon" class="h-6 w-6" />
                </div>
                <span class="text-xs font-medium mt-2">Support</span>
            </a>
            <!-- Profile Icon -->
            <a href="profile.html" class="nav-item flex flex-col items-center" onclick="setActive(this)">
                <div class="bg-white rounded p-2">
                    <img src="profile.png" alt="Profile Icon" class="h-6 w-6" />
                </div>
                <span class="text-xs font-medium mt-2">Profile</span>
            </a>
        </div>

</body>

</html>