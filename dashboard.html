<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Twenty Third & Forth Dashboard</title>
    <style>
        :root {
            --chase-blue: #117aca;
            --chase-dark-blue: #0d5394;
            --chase-light-blue: #eef4fa;
            --chase-hover: #f5f7fa;
            --chase-border: #e4e9ef;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--chase-blue);
        }
        
        /* Text-based Logo */
        .text-logo {
            font-family: 'Georgia', 'Times New Roman', serif;
            font-weight: 700;
            font-size: 1.75rem;
            letter-spacing: -0.5px;
            color: #1a1a1a;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
        }
        .text-logo .first {
            color: #1a1a1a;
        }
        .text-logo .citizens {
            color: #4a4a4a;
            font-weight: 600;
        }
        .text-logo .inc {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 500;
            margin-left: 2px;
            vertical-align: super;
        }
        
        .welcome-section {
            margin-bottom: 25px;
        }
        
        .welcome-text {
            font-size: 22px;
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
        }
        
        .date-text {
            font-size: 14px;
            color: #777;
        }
        
        .accounts-section {
            margin-bottom: 30px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }
        
        .view-all {
            font-size: 14px;
            color: var(--chase-blue);
            text-decoration: none;
            cursor: pointer;
        }
        
        .accounts-carousel {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .account-card {
            flex: 0 0 320px;
            background: linear-gradient(135deg, #1800ac 0%, #140099 100%); /* footer blue gradient */
            border-radius: 16px;
            padding: 24px;
            position: relative !important; /* Ensure parent is positioned for absolute children */
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: visible; /* Changed from hidden to visible so button isn't clipped */
        }
        
        .account-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
            pointer-events: none;
        }
        
        .account-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.3);
        }
        
        .account-card.checking {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%); /* monochrome: medium gray to dark gray */
        }
        
        .account-card.savings {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%); /* monochrome: lighter gray to medium gray */
        }
        
        .account-card.fixed {
            background: linear-gradient(135deg, #140099 0%, #0d0066 100%); /* footer blue gradient */
        }
        
        .card-header {
            margin-bottom: 15px;
        }
        
        .account-type {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .account-name {
            font-size: 18px;
            font-weight: 700;
            color: white;
            margin-top: 4px;
        }
        
        .account-balance {
            font-size: 28px;
            font-weight: 800;
            color: #ffffff;
            margin: 20px 0;
            text-shadow: 0 3px 8px rgba(0, 0, 0, 0.25);
        }
        
        .account-number {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            font-family: 'Courier New', monospace;
        }
        
        .account-actions {
            display: flex;
            justify-content: flex-start;
            gap: 15px;
            margin-top: 20px;
        }
        
        .action-button {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 16px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(10px);
            text-decoration: none;
        }
        
        .action-button:hover {
            background-color: #ffffff;
            border-color: #ffffff;
            color: #1e3a8a; /* brand navy for contrast on white */
            transform: translateY(-1px);
        }
        .action-button:focus-visible {
            outline: 2px solid #38bdf8; /* light brand ring */
            outline-offset: 2px;
        }
        
        .quick-actions {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .actions-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .action-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .action-item:hover {
            background-color: var(--chase-hover);
        }
        
        .action-icon {
            background-color: var(--chase-light-blue);
            color: var(--chase-blue);
            width: 50px;
            height: 50px;
            border-radius: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .action-label {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            text-align: center;
        }
        
        .transactions-section {
            background-color: white;
            border-radius: 10px;
            padding: 24px;
            margin-bottom: 30px;
        }
        
        .transaction-tabs {
            display: flex;
            border-bottom: 1px solid var(--chase-border);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            color: #777;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            color: var(--chase-blue);
            border-bottom: 3px solid var(--chase-blue);
        }
        
        .transaction-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--chase-border);
            transition: background-color 0.2s;
        }
        
        .transaction-item:hover {
            background-color: var(--chase-hover);
        }
        
        .transaction-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .transaction-icon {
            background-color: var(--chase-light-blue);
            color: var(--chase-blue);
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .transaction-details {
            display: flex;
            flex-direction: column;
        }
        
        .transaction-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }
        
        .transaction-date {
            font-size: 14px;
            color: #777;
        }
        
        .transaction-amount {
            font-size: 16px;
            font-weight: 600;
        }
        
        .credit {
            color: #0c9;
        }
        
        .debit {
            color: #e74c3c;
        }
        
        .pending {
            color: #f39c12;
        }
        
        /* Simplified Mobile Transaction List Styles */
        .mobile-transaction-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
            -webkit-tap-highlight-color: transparent;
            will-change: background-color;
            contain: layout style paint;
        }
        
        .mobile-transaction-item:active {
            background-color: #f9f9f9;
        }
        
        /* Optimize mobile transaction container */
        @media (max-width: 767px) {
            .transaction-entry {
                contain: layout style paint;
            }
            
            .transaction-entry .hidden {
                display: none !important;
            }
            
            /* Hide desktop layout on mobile to reduce DOM complexity */
            .transaction-entry > .hidden.md\:grid {
                display: none !important;
            }
        }
        
        .mobile-transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-right: 12px;
        }
        
        .mobile-transaction-content {
            flex: 1;
            min-width: 0;
        }
        
        .mobile-transaction-description {
            font-size: 15px;
            font-weight: 500;
            color: #000;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .mobile-transaction-time {
            font-size: 13px;
            color: #999;
        }
        
        .mobile-transaction-amount {
            font-size: 15px;
            font-weight: 600;
            margin-left: 12px;
            flex-shrink: 0;
        }
        
        .mobile-transaction-amount.credit {
            color: #10b981;
        }
        
        .mobile-transaction-amount.debit {
            color: #000;
        }
        
        /* Transaction Detail Modal */
        .transaction-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 1000;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .transaction-detail-modal.active {
            display: block;
        }
        
        .transaction-detail-header {
            position: sticky;
            top: 0;
            background: white;
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
        }
        
        .transaction-detail-back {
            background: none;
            border: none;
            font-size: 18px;
            color: #7c3aed;
            cursor: pointer;
            padding: 8px;
            margin-left: -8px;
        }
        
        .transaction-detail-title {
            font-size: 18px;
            font-weight: 600;
            color: #000;
            flex: 1;
            text-align: center;
            margin: 0 16px;
        }
        
        .transaction-detail-share {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .transaction-detail-body {
            padding: 24px 16px;
        }
        
        .transaction-detail-amount {
            font-size: 32px;
            font-weight: 700;
            color: #000;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .transaction-detail-amount.credit {
            color: #10b981;
        }
        
        .transaction-detail-type {
            font-size: 16px;
            font-weight: 600;
            color: #000;
            text-align: center;
            margin-bottom: 8px;
        }
        
        .transaction-detail-date {
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-bottom: 24px;
        }
        
        .transaction-detail-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #d1fae5;
            color: #065f46;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin: 0 auto 24px;
        }
        
        .transaction-detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .transaction-detail-row:last-child {
            border-bottom: none;
        }
        
        .transaction-detail-label {
            font-size: 14px;
            color: #999;
        }
        
        .transaction-detail-value {
            font-size: 15px;
            font-weight: 600;
            color: #000;
            text-align: right;
            flex: 1;
            margin-left: 16px;
        }
        
        .transaction-detail-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 12px;
            flex-shrink: 0;
        }
        
        .transaction-detail-copy {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            margin-left: 8px;
        }
        
        .transaction-detail-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .transaction-detail-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
        }
        
        .transaction-detail-status-text {
            font-size: 15px;
            font-weight: 600;
            color: #7c3aed;
        }
        
        .transaction-detail-actions {
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid #f0f0f0;
        }
        
        .transaction-detail-action-title {
            font-size: 16px;
            font-weight: 600;
            color: #000;
            margin-bottom: 16px;
        }
        
        .transaction-detail-report {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #fef2f2;
            border: none;
            padding: 16px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
        }
        
        .transaction-detail-report-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .transaction-detail-report-icon {
            width: 24px;
            height: 24px;
            color: #dc2626;
        }
        
        .transaction-detail-report-text {
            text-align: left;
        }
        
        .transaction-detail-report-title {
            font-size: 15px;
            font-weight: 500;
            color: #dc2626;
            margin-bottom: 2px;
        }
        
        .transaction-detail-report-subtitle {
            font-size: 13px;
            color: #999;
        }
        
        .notifications-section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .notification-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid var(--chase-border);
            transition: background-color 0.2s;
        }
        
        .notification-item:hover {
            background-color: var(--chase-hover);
        }
        
        .notification-icon {
            color: var(--chase-blue);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .notification-message {
            font-size: 14px;
            color: #777;
        }
        
        .notification-time {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
        
        .footer {
            background-color: white;
            border-top: 1px solid var(--chase-border);
            padding: 20px;
            text-align: center;
            font-size: 14px;
            color: #777;
        }
        
        /* Extra classes for eye icon toggle */
        .hide-balance {
            filter: blur(5px);
        }
        
        /* Balance toggle button styling */
        .balance-toggle-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1.5px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 5; /* Lower z-index to prevent overlay issues */
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            pointer-events: auto; /* Ensure button is clickable */
        }
        
        .balance-toggle-btn:hover {
            background: rgba(0, 0, 0, 0.5);
            border-color: #ffffff;
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
        }
        
        .balance-toggle-btn i {
            font-size: 14px !important;
            color: #ffffff !important;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5);
            line-height: 1;
        }
    </style>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="app-icon.svg">
    <link rel="icon" href="app-icon.svg" type="image/svg+xml">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Chart.js Library -->

    <style>
        html, body {
            overflow: auto; /* Ensures scrolling is enabled */
        }
        .loader {
            border: 8px solid rgba(0, 0, 0, 0.1); /* Light grey */
            border-top: 8px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* New spinner styles */
        .smart-spinner {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #3498db, #8e44ad);
            animation: smart-spin 1.5s linear infinite;
        }

        @keyframes smart-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .smart-spinner::before {
            content: '';
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            position: absolute;
        }
    </style>
    <script type="module">
        // Firebase SDK imports
        // IMPORTANT: Do not mix CDN Firebase modules with npm-bundled Firebase instances.
        // `auth`/`db` come from `firebase-client.js` (npm Firebase), so the helper functions must also come from npm Firebase.
        import { auth, db, cacheUserData, clearCachedUserData, getCachedUserData } from './firebase-client.js';
        import { onAuthStateChanged, signOut } from 'firebase/auth';
        import { doc, getDoc, collection, getDocs, query, where, updateDoc, addDoc, serverTimestamp, setDoc, deleteDoc, onSnapshot } from 'firebase/firestore';
        
        // Make db available globally for banking details generator
        window.auth = auth;
        window.db = db;
        window.firestoreHelpers = { addDoc, collection, serverTimestamp, doc, getDoc, updateDoc, setDoc, deleteDoc };

        // Surface Firebase connectivity/auth problems clearly instead of failing silently.
        function showFirebaseBanner(message) {
            try {
                let el = document.getElementById('firebaseStatusBanner');
                if (!el) {
                    el = document.createElement('div');
                    el.id = 'firebaseStatusBanner';
                    el.className = 'fixed top-0 left-0 right-0 z-50 bg-red-600 text-white text-sm px-4 py-3 shadow-lg';
                    document.body.appendChild(el);
                }
                el.textContent = message;
            } catch {
                // ignore
            }
        }

        window.addEventListener('unhandledrejection', (event) => {
            const msg = event?.reason?.message || String(event?.reason || '');
            if (msg.includes('auth/internal-error') || msg.includes('Could not reach Cloud Firestore backend')) {
                showFirebaseBanner('Connection issue: Firebase could not be reached (offline/VPN/adblock). Please check your internet connection and try again.');
            }
        });

        // Speed up first paint: render cached user data (if available).
        // IMPORTANT: only apply cache if it belongs to the currently signed-in user.
        // This prevents showing a previous user's cached profile after switching accounts.
        document.addEventListener('DOMContentLoaded', () => {
            try {
            const cached = getCachedUserData();
            const welcomeEl = document.getElementById('user-first-name');
                const currentUid = auth.currentUser?.uid || null;

                if (!cached || !welcomeEl || welcomeEl.textContent.trim()) return;
                if (!currentUid) return; // wait for onAuthStateChanged

                if (cached.__uid && cached.__uid !== currentUid) {
                    clearCachedUserData();
                    return;
                }

                if (cached.__uid === currentUid) {
                    loadUserDataFromCache(cached);
                }
                } catch {
                    // ignore cache failures
            }
        }, { passive: true });

            // Add these at the top of your script section
            // Inactivity timer removed for performance

        // Debit Card progress (dashboard)
        let debitCardUnsubCard = null;
        let debitCardUnsubApp = null;
        let debitCardCardDoc = null;
        let debitCardAppDoc = null;

        function renderDebitCardProgress() {
            const wrap = document.getElementById('debitCardProgressWrap');
            const statusEl = document.getElementById('debitCardProgressStatus');
            const bar = document.getElementById('debitCardProgressBar');
            const text = document.getElementById('debitCardProgressText');
            if (!wrap || !statusEl || !bar || !text) return;

            const cardActive = debitCardCardDoc && (debitCardCardDoc.status || 'active') === 'active';
            const appStatus = (debitCardAppDoc?.status || '').toLowerCase();

            if (cardActive) {
                wrap.classList.add('hidden');
                return;
            }

            if (appStatus === 'pending') {
                wrap.classList.remove('hidden');
                statusEl.textContent = 'Pending approval';
                bar.style.width = '60%';
                text.textContent = 'Your debit card request is being reviewed.';
                return;
            }

            wrap.classList.add('hidden');
        }

        function setupDebitCardProgress(user) {
            try {
                if (debitCardUnsubCard) { try { debitCardUnsubCard(); } catch {} debitCardUnsubCard = null; }
                if (debitCardUnsubApp) { try { debitCardUnsubApp(); } catch {} debitCardUnsubApp = null; }
                debitCardCardDoc = null;
                debitCardAppDoc = null;

                const cardRef = doc(db, 'debit_cards', user.uid);
                const appRef = doc(db, 'debit_card_applications', user.uid);

                debitCardUnsubCard = onSnapshot(cardRef, (snap) => {
                    debitCardCardDoc = snap.exists() ? snap.data() : null;
                    renderDebitCardProgress();
                }, () => {
                    debitCardCardDoc = null;
                    renderDebitCardProgress();
                });

                debitCardUnsubApp = onSnapshot(appRef, (snap) => {
                    debitCardAppDoc = snap.exists() ? snap.data() : null;
                    renderDebitCardProgress();
                }, () => {
                    debitCardAppDoc = null;
                    renderDebitCardProgress();
                });
            } catch (e) {
                console.warn('Debit card progress setup failed', e);
            }
        }
    
        // Function to populate transaction data in the clean layout
        function populateTransactionData(element, historyText) {
            const parts = historyText.split('|').map(part => part.trim());
            
            // Extract transaction components
            const type = parts[0] || '';
            const recipient = parts[1] || '';
            const amount = parts[2] || '';
            const time = parts[3] || '';
            const date = parts[4] || '';
            const reference = parts[5] || '';
            const notes = parts.slice(6).join('|') || '';
            
            // Store transaction data on element for modal
            element.dataset.transactionType = type;
            element.dataset.transactionRecipient = recipient;
            element.dataset.transactionAmount = amount;
            element.dataset.transactionTime = time;
            element.dataset.transactionDate = date;
            element.dataset.transactionReference = reference;
            element.dataset.transactionNotes = notes;
            
            // Update the clean layout elements (desktop)
            const descriptionEl = element.querySelector('.transaction-description');
            const recipientEl = element.querySelector('.transaction-recipient');
            const typeEl = element.querySelector('.transaction-type');
            const amountEl = element.querySelector('.transaction-amount');
            const dateEl = element.querySelector('.transaction-date');
            const referenceEl = element.querySelector('.transaction-reference');
            const metaRow = element.querySelector('.meta-row');
            const separatorEl = element.querySelector('.separator');
            const avatarEl = element.querySelector('.transaction-avatar');
            const avatarTextEl = element.querySelector('.transaction-avatar-text');
            
            if (descriptionEl) descriptionEl.textContent = type;
            if (recipientEl) recipientEl.textContent = recipient;
            if (typeEl) typeEl.textContent = type;
            if (amountEl) amountEl.textContent = amount;
            if (dateEl) dateEl.textContent = date;
            if (referenceEl) referenceEl.textContent = reference;

            // Update mobile-specific elements
            const mobileItem = element.querySelector('.mobile-transaction-item');
            if (mobileItem) {
                const mobileDescription = mobileItem.querySelector('.mobile-transaction-description');
                const mobileTime = mobileItem.querySelector('.mobile-transaction-time');
                const mobileAmount = mobileItem.querySelector('.mobile-transaction-amount');
                const mobileIcon = mobileItem.querySelector('.mobile-transaction-icon');
                const mobileIconText = mobileItem.querySelector('.transaction-icon-text-mobile');
                
                if (mobileDescription) {
                    mobileDescription.textContent = type || recipient || 'Transaction';
                }
                
                if (mobileTime) {
                    mobileTime.textContent = time || date || '-';
                }
                
                if (mobileAmount) {
                    mobileAmount.textContent = amount || '-';
                    // Determine if credit or debit
                    const isCredit = amount && (amount.startsWith('+') || amount.includes('credit') || amount.includes('deposit'));
                    mobileAmount.className = 'mobile-transaction-amount transaction-amount-mobile ' + (isCredit ? 'credit' : 'debit');
                }
                
                // Update icon based on transaction type
                if (mobileIcon && mobileIconText) {
                    const normalizedType = (type || '').toLowerCase();
                    if (normalizedType.includes('cashback') || normalizedType.includes('refund')) {
                        mobileIcon.style.backgroundColor = '#e0f2fe';
                        mobileIconText.textContent = '₦';
                        mobileIconText.style.color = '#0369a1';
                    } else if (normalizedType.includes('mtn') || normalizedType.includes('data')) {
                        mobileIcon.style.backgroundColor = '#fef3c7';
                        mobileIconText.textContent = 'MTN';
                        mobileIconText.style.fontSize = '10px';
                        mobileIconText.style.color = '#1e40af';
                    } else if (normalizedType.includes('savings') || normalizedType.includes('deposit')) {
                        mobileIcon.style.backgroundColor = '#ede9fe';
                        mobileIconText.textContent = 'K.';
                        mobileIconText.style.fontSize = '12px';
                        mobileIconText.style.color = '#7c3aed';
                    } else {
                        mobileIcon.style.backgroundColor = '#e0f2fe';
                        mobileIconText.textContent = '₦';
                        mobileIconText.style.color = '#0369a1';
                    }
                }
            }

            // Hide meta row if no type/date
            if (metaRow) {
                const hasType = !!type && type !== '-';
                const hasDate = !!date && date !== '-';
                if (hasType || hasDate) {
                    metaRow.classList.remove('hidden');
                    if (separatorEl) {
                        if (hasType && hasDate) {
                            separatorEl.classList.remove('hidden');
                        } else {
                            separatorEl.classList.add('hidden');
                        }
                    }
                } else {
                    metaRow.classList.add('hidden');
                }
            }

            // Avatar initials and color by type
            if (avatarEl && avatarTextEl) {
                const normalizedType = (type || '').toLowerCase();
                let initials = 'TX';
                let bg = 'bg-blue-50';
                let fg = 'text-blue-700';

                if (normalizedType.includes('deposit')) {
                    initials = 'DP'; bg = 'bg-blue-50'; fg = 'text-blue-700';
                } else if (normalizedType.includes('transfer')) {
                    initials = 'TF'; bg = 'bg-indigo-50'; fg = 'text-indigo-700';
                } else if (normalizedType.includes('refund')) {
                    initials = 'RF'; bg = 'bg-amber-50'; fg = 'text-amber-700';
                } else if (normalizedType.includes('reversal')) {
                    initials = 'RV'; bg = 'bg-rose-50'; fg = 'text-rose-700';
                }

                avatarTextEl.textContent = initials;

                // Reset classes and apply new theme
                avatarEl.className = 'w-12 h-12 rounded-full flex items-center justify-center transaction-avatar font-semibold text-sm ' + bg + ' ' + fg;
            }
        }
    
        // Transaction detail modal functions
        function openTransactionDetail(element) {
            const modal = document.getElementById('transactionDetailModal');
            if (!modal || !element) return;
            
            // Get transaction data from element dataset
            const type = element.dataset.transactionType || '';
            const recipient = element.dataset.transactionRecipient || '';
            const amount = element.dataset.transactionAmount || '';
            const time = element.dataset.transactionTime || '';
            const date = element.dataset.transactionDate || '';
            const reference = element.dataset.transactionReference || '';
            const notes = element.dataset.transactionNotes || '';
            
            // Format date for display
            let displayDate = date;
            if (date && time) {
                displayDate = `On ${date} at ${time}`;
            } else if (date) {
                displayDate = date;
            } else if (time) {
                displayDate = time;
            }
            
            // Determine if credit
            const isCredit = amount && (amount.startsWith('+') || amount.includes('credit') || amount.includes('deposit'));
            
            // Populate modal
            document.getElementById('detail-amount').textContent = amount || '₦0.00';
            document.getElementById('detail-amount').className = 'transaction-detail-amount' + (isCredit ? ' credit' : '');
            document.getElementById('detail-type').textContent = (type || recipient || 'Transaction').toUpperCase();
            document.getElementById('detail-date').textContent = displayDate || '-';
            document.getElementById('detail-description').textContent = notes || type || recipient || '-';
            document.getElementById('detail-method').textContent = type || '-';
            document.getElementById('detail-reference').textContent = reference || '-';
            document.getElementById('detail-from').textContent = recipient || 'Kuda';
            
            // Determine category
            const normalizedType = (type || '').toLowerCase();
            let category = 'Savings';
            if (normalizedType.includes('cashback')) category = 'Cashback';
            else if (normalizedType.includes('mtn') || normalizedType.includes('data')) category = 'Data';
            else if (normalizedType.includes('savings')) category = 'Savings';
            document.getElementById('detail-category').textContent = category;
            
            // Show modal (mobile only)
            if (window.innerWidth < 768) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeTransactionDetail() {
            const modal = document.getElementById('transactionDetailModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        function shareTransaction() {
            const reference = document.getElementById('detail-reference').textContent;
            const amount = document.getElementById('detail-amount').textContent;
            const type = document.getElementById('detail-type').textContent;
            
            const shareText = `Transaction Details:\nType: ${type}\nAmount: ${amount}\nReference: ${reference}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Transaction Details',
                    text: shareText
                }).catch(err => console.log('Error sharing:', err));
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Transaction details copied to clipboard');
                });
            }
        }
        
        function copyTransactionReference() {
            const reference = document.getElementById('detail-reference').textContent;
            if (reference && reference !== '-') {
                navigator.clipboard.writeText(reference).then(() => {
                    alert('Reference copied to clipboard');
                });
            }
        }
        
        function reportTransaction() {
            alert('Transaction reporting feature coming soon');
        }
        
        // Event delegation handler for mobile transactions (better performance)
        function handleMobileTransactionClick(e) {
            // Only handle on mobile
            if (window.innerWidth >= 768) return;
            
            const mobileItem = e.target.closest('.mobile-transaction-item');
            if (!mobileItem) return;
            
            const transactionId = mobileItem.dataset.transactionId;
            if (!transactionId) return;
            
            const parentElement = document.getElementById(transactionId);
            if (parentElement && parentElement.dataset.transactionType && parentElement.dataset.transactionType !== '') {
                e.preventDefault();
                e.stopPropagation();
                openTransactionDetail(parentElement);
            }
        }
    
        // Check if the user is authenticated (using cached state first)
        let authCheckComplete = false;
        let redirectTimeout = null;
        
        // Always use Firebase auth state (cached check was causing issues)
        // The auth state will be stored automatically for other pages
        onAuthStateChanged(auth, async (user) => {
            // Clear any pending redirect timeout
            if (redirectTimeout) {
                clearTimeout(redirectTimeout);
                redirectTimeout = null;
            }
            
            if (user) {
                authCheckComplete = true;
                
                console.log("User is logged in:", user.uid);
                    
                    // Auth persistence is handled by Firebase; user data caching is handled below.
                    
                    // Show loading indicator for dashboard sections
                    const loadingSections = document.querySelectorAll('.accounts-section, #history-container');
                    loadingSections.forEach(section => {
                        if (section) section.style.opacity = '0.6';
                    });
                    
                    // Fetch user data from Firestore
                    await loadUserDataFromFirestore(user);
                    
                    // Check for loan application status
                    checkLoanApplicationStatus(user);

                    // Debit card progress bar (pending approval)
                    setupDebitCardProgress(user);
                    
                    // Hide loading indicators after data is loaded
                    loadingSections.forEach(section => {
                        if (section) section.style.opacity = '1';
                    });
                } else {
                    // User not authenticated
                    if (!authCheckComplete) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                        authCheckComplete = true;
                    }
                    
                    redirectTimeout = setTimeout(() => {
                        const currentUser = auth.currentUser;
                        if (!currentUser) {
                            console.log('No user signed in. Redirecting to sign-in page.');
                            clearCachedUserData();
                            window.location.href = 'login.html';
                        }
                    }, 1000);
                }
        });
        
        // Store currency sign globally for reuse
        let globalCurrencySign = '$';
        
        // Global function to format amounts with currency sign
        window.formatAmountWithCurrency = function(value) {
            const currencySign = globalCurrencySign || '$';
            if (!value && value !== 0) return currencySign + '0.00';
            const num = typeof value === 'string' 
                ? parseFloat(value.replace(/[^0-9.-]/g, '')) || 0
                : Number(value) || 0;
            const formatted = new Intl.NumberFormat('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
            }).format(num);
            return currencySign + formatted;
        };
        
        // Function to load currency setting and format account balances
        async function loadCurrencyAndFormatBalances(userData) {
            let currencySign = '$'; // Default to $ if not set
            
            try {
                // Load currency setting from Firestore
                const settingsRef = doc(db, 'settings', 'currency');
                const settingsSnap = await getDoc(settingsRef);
                if (settingsSnap.exists() && settingsSnap.data().currencySign) {
                    currencySign = settingsSnap.data().currencySign;
                    console.log('Currency sign loaded from settings:', currencySign);
                } else {
                    console.log('Currency setting not found, using default: $');
                }
            } catch (error) {
                console.error('Error loading currency setting:', error);
                // Continue with default '$'
            }
            
            // Store globally for other functions to use
            globalCurrencySign = currencySign;
            
            // Set the amounts directly from user data using correct field mappings
            // Checking → checking field
            // Savings → savings field
            // Fixed → fixed field
            const checkingEl = document.getElementById('checking');
            const savingsEl = document.getElementById('savings');
            const fixedEl = document.getElementById('fixed');
            
            if (checkingEl) {
                const formatted = window.formatAmountWithCurrency(userData.checking);
                checkingEl.textContent = formatted;
                console.log('Checking balance formatted:', formatted);
            }
            if (savingsEl) {
                const formatted = window.formatAmountWithCurrency(userData.savings);
                savingsEl.textContent = formatted;
                console.log('Savings balance formatted:', formatted);
            }
            if (fixedEl) {
                const formatted = window.formatAmountWithCurrency(userData.fixed);
                fixedEl.textContent = formatted;
                console.log('Fixed balance formatted:', formatted);
            }
        }
        
        // Function to load user data from Firestore
        async function loadUserDataFromFirestore(user) {
            const userDocRef = doc(db, 'users', user.uid);
            const userDoc = await getDoc(userDocRef);
            let userData = null;

            if (userDoc.exists()) {
                userData = userDoc.data() || {};
            } else {
                // Legacy fix: if the user exists in Auth but has no Firestore `users/{uid}` doc,
                // attempt to migrate from older storage where the doc ID was the user's email.
                // If nothing exists, create a minimal profile and mark approved so they are not locked out.
                let migrated = null;
                try {
                    const legacyEmail = (user.email || '').trim();
                    if (legacyEmail) {
                        const legacyRef = doc(db, 'users', legacyEmail);
                        const legacySnap = await getDoc(legacyRef);
                        if (legacySnap.exists()) {
                            migrated = legacySnap.data() || {};
                        }
                    }
                } catch (e) {
                    console.warn('Legacy email-doc migration skipped/failed:', e);
                }

                const base = migrated && typeof migrated === 'object' ? migrated : {};
                const displayName = user.displayName || '';
                const inferredFirstName =
                    base.firstName
                    || (typeof base.name === 'string' ? base.name.split(' ')[0] : '')
                    || (typeof base.fullName === 'string' ? base.fullName.split(' ')[0] : '')
                    || (displayName ? displayName.split(' ')[0] : '')
                    || ((user.email || '').split('@')[0] || '');

                const legacyUserData = {
                    ...base,
                    email: base.email || user.email || null,
                    firstName: base.firstName || inferredFirstName || null,
                    approvalStatus: base.approvalStatus || 'approved',
                    isApproved: (typeof base.isApproved === 'boolean') ? base.isApproved : true,
                    approvedAt: base.approvedAt || serverTimestamp(),
                    approvedBy: base.approvedBy || (migrated ? 'legacy_migrated' : 'legacy_auto'),
                    createdAt: base.createdAt || serverTimestamp(),
                    createdAtIso: base.createdAtIso || new Date().toISOString(),
                    migratedFrom: migrated ? 'users/{email}' : null
                };
                await setDoc(userDocRef, legacyUserData, { merge: true });
                userData = legacyUserData;
            }

                // Enforce admin approval before showing dashboard.
                // Back-compat: legacy accounts without approval fields are allowed.
                const approvalStatus = userData?.approvalStatus || null;
                const isApproved = (typeof userData?.isApproved === 'boolean') ? userData.isApproved : null;
                const approved =
                    approvalStatus === 'approved'
                    || (approvalStatus == null && isApproved !== false);

                if (!approved) {
                    clearCachedUserData();
                    try { await signOut(auth); } catch {}
                    window.location.href = 'login.html?pending=1';
                    return;
                }
                
                // Store user data for other pages (tag with uid to prevent cross-user cache bleed)
                cacheUserData({ ...(userData || {}), __uid: user.uid, __email: user.email || userData?.email || null });
                    
                // Load currency setting and format amounts
                await loadCurrencyAndFormatBalances(userData);
                
                // Update KYC notification based on status
                updateKYCNotification(userData);
                
                // Update welcome message first to ensure it's visible immediately (support legacy field names)
                const welcomeName = document.getElementById('user-first-name');
                const first =
                    (typeof userData.firstName === 'string' && userData.firstName.trim()) ? userData.firstName.trim()
                    : (typeof userData.name === 'string' && userData.name.trim()) ? userData.name.trim().split(' ')[0]
                    : (typeof userData.fullName === 'string' && userData.fullName.trim()) ? userData.fullName.trim().split(' ')[0]
                    : (user.email ? user.email.split('@')[0] : '');
                if (welcomeName) welcomeName.textContent = first || '';
    
                // Update cardholder name on the active card
                const cardholderName = document.getElementById('cardholder-name');
                const modalCardholderName = document.getElementById('modal-cardholder-name');
                let fullName = '';
                
                if (userData.firstName && userData.lastName) {
                    fullName = `${String(userData.firstName).toUpperCase()} ${String(userData.lastName).toUpperCase()}`;
                } else if (userData.firstName) {
                    fullName = String(userData.firstName).toUpperCase();
                } else if (userData.fullName) {
                    fullName = String(userData.fullName).toUpperCase();
                } else if (userData.name) {
                    fullName = String(userData.name).toUpperCase();
                }
                
                if (fullName) {
                    if (cardholderName) cardholderName.textContent = fullName;
                    if (modalCardholderName) modalCardholderName.textContent = fullName;
                }
                
                // Set history data for all 20 history fields
                setTimeout(() => {
                    let hasMoreThan10 = false;
                    let visibleCount = 0;
                    
                    for (let i = 1; i <= 20; i++) {
                        const historyElement = document.getElementById(`history${i}`);
                        if (historyElement) {
                            const historyText = userData[`history${i}`] || '';
                            
                            if (historyText && historyText.trim() !== '') {
                                populateTransactionData(historyElement, historyText);
                                
                                if (visibleCount < 10) {
                                    historyElement.style.display = 'block';
                                    const mobileItem = historyElement.querySelector('.mobile-transaction-item');
                                    if (mobileItem) {
                                        mobileItem.style.display = 'flex';
                                    }
                                    visibleCount++;
                                } else {
                                    historyElement.style.display = 'none';
                                    const mobileItem = historyElement.querySelector('.mobile-transaction-item');
                                    if (mobileItem) {
                                        mobileItem.style.display = 'none';
                                    }
                                }
                                
                                if (i > 10) {
                                    hasMoreThan10 = true;
                                }
                            } else {
                                historyElement.style.display = 'none';
                                const mobileItem = historyElement.querySelector('.mobile-transaction-item');
                                if (mobileItem) {
                                    mobileItem.style.display = 'none';
                                }
                            }
                        }
                    }
                    
                    const seeMoreButton = document.getElementById('see-more');
                    if (seeMoreButton) {
                        if (hasMoreThan10) {
                            seeMoreButton.classList.remove('hidden');
                        } else {
                            seeMoreButton.classList.add('hidden');
                        }
                    }
                    
                    const transactionContainer = document.getElementById('recent-transactions');
                    if (transactionContainer) {
                        transactionContainer.removeEventListener('click', handleMobileTransactionClick);
                        transactionContainer.addEventListener('click', handleMobileTransactionClick, { passive: true });
                    }
                }, 100);
                
                // Process pending transactions
                setTimeout(() => {
                    const pending1Element = document.getElementById('pending1');
                    const pending2Element = document.getElementById('pending2');
                    const pending3Element = document.getElementById('pending3');
                    const pending4Element = document.getElementById('pending4');
                    const pending5Element = document.getElementById('pending5');
                    const pendingList = document.getElementById('pending-list');
                    
                    function populatePendingData(element, pendingText) {
                        const parts = pendingText.split('|').map(part => part.trim());
                        const type = parts[0] || '';
                        const recipient = parts[1] || '';
                        const amount = parts[2] || '';
                        const time = parts[3] || '';
                        const date = parts[4] || '';
                        const reference = parts[5] || '';
                        
                        const descriptionEl = element.querySelector('.pending-description');
                        const recipientEl = element.querySelector('.pending-recipient');
                        const typeEl = element.querySelector('.pending-type');
                        const amountEl = element.querySelector('.pending-amount');
                        const dateEl = element.querySelector('.pending-date');
                        const avatarEl = element.querySelector('.pending-avatar');
                        const avatarTextEl = element.querySelector('.pending-avatar-text');
                        
                        if (descriptionEl) descriptionEl.textContent = type;
                        if (recipientEl) recipientEl.textContent = recipient;
                        if (typeEl) typeEl.textContent = type;
                        if (amountEl) amountEl.textContent = amount;
                        if (dateEl) dateEl.textContent = date;

                        if (avatarEl && avatarTextEl) {
                            avatarTextEl.textContent = 'PN';
                            avatarEl.className = 'w-12 h-12 rounded-full flex items-center justify-center pending-avatar font-semibold text-sm bg-orange-50 text-orange-700';
                        }
                    }
                    
                    function appendPendingCard(targetEl) {
                        if (!pendingList || !targetEl) return;
                        pendingList.appendChild(targetEl);
                    }

                    if (userData.pending1 && userData.pending1.trim() !== '') {
                        pending1Element.classList.remove('hidden');
                        populatePendingData(pending1Element, userData.pending1);
                        appendPendingCard(pending1Element);
                    }
                    
                    if (userData.pending2 && userData.pending2.trim() !== '') {
                        pending2Element.classList.remove('hidden');
                        populatePendingData(pending2Element, userData.pending2);
                        appendPendingCard(pending2Element);
                    }
                    
                    if (userData.pending3 && userData.pending3.trim() !== '') {
                        pending3Element.classList.remove('hidden');
                        populatePendingData(pending3Element, userData.pending3);
                        appendPendingCard(pending3Element);
                    }
                    
                    if (userData.pending4 && userData.pending4.trim() !== '') {
                        pending4Element.classList.remove('hidden');
                        populatePendingData(pending4Element, userData.pending4);
                        appendPendingCard(pending4Element);
                    }
                    
                    if (userData.pending5 && userData.pending5.trim() !== '') {
                        pending5Element.classList.remove('hidden');
                        populatePendingData(pending5Element, userData.pending5);
                        appendPendingCard(pending5Element);
                    }
                    
                    if (userData.pending1 && userData.pending2 && userData.pending3 && userData.pending4 && userData.pending5 &&
                        userData.pending1.trim() !== '' && userData.pending2.trim() !== '' && userData.pending3.trim() !== '' && 
                        userData.pending4.trim() !== '' && userData.pending5.trim() !== '') {
                        document.getElementById('pending-limit-notice').classList.remove('hidden');
                    } else {
                        document.getElementById('pending-limit-notice').classList.add('hidden');
                    }
                }, 200);
        }
        
        // Function to update KYC notification based on user's KYC status
        function updateKYCNotification(userData) {
            const kycNotification = document.getElementById('kycNotification');
            const kycNotificationTitle = document.getElementById('kycNotificationTitle');
            const kycNotificationMessage = document.getElementById('kycNotificationMessage');
            const kycNotificationTime = document.getElementById('kycNotificationTime');
            
            if (!kycNotification || !kycNotificationTitle || !kycNotificationMessage || !kycNotificationTime) {
                return; // Elements not found, skip
            }
            
            const kycStatus = userData.kycStatus || 'not_completed';
            
            // Show notification based on KYC status
            if (kycStatus === 'pending') {
                kycNotificationTitle.textContent = 'KYC Verification Pending';
                kycNotificationMessage.textContent = 'Your KYC document is currently under review. We will notify you once the verification is complete.';
                kycNotificationTime.textContent = 'Recently';
                kycNotification.style.display = 'flex';
            } else if (kycStatus === 'reviewed') {
                kycNotificationTitle.textContent = 'KYC Under Review';
                kycNotificationMessage.textContent = 'Your KYC document has been reviewed and is being processed. You will be notified once a decision is made.';
                kycNotificationTime.textContent = 'Recently';
                kycNotification.style.display = 'flex';
            } else if (kycStatus === 'approved' || kycStatus === 'completed') {
                kycNotificationTitle.textContent = 'KYC Verification Approved';
                kycNotificationMessage.textContent = 'Congratulations! Your KYC verification has been approved. Your account now has full access to all features.';
                kycNotificationTime.textContent = 'Recently';
                kycNotification.style.display = 'flex';
            } else if (kycStatus === 'rejected' || kycStatus === 'declined') {
                kycNotificationTitle.textContent = 'KYC Verification Rejected';
                kycNotificationMessage.textContent = 'Your KYC verification was not approved. Please upload a new valid government-issued ID document to complete verification.';
                kycNotificationTime.textContent = 'Recently';
                kycNotification.style.display = 'flex';
            } else {
                // KYC not started or not_completed - show reminder
                kycNotificationTitle.textContent = 'KYC Verification Required';
                kycNotificationMessage.textContent = 'Complete your KYC verification to unlock all account features. Upload a valid government-issued ID in the Security section.';
                kycNotificationTime.textContent = 'Important';
                kycNotification.style.display = 'flex';
            }
        }
        
        // Function to load user data from cache
        async function loadUserDataFromCache(userData) {
            // Safety: only use cache for the currently signed-in user
            const currentUid = auth.currentUser?.uid || null;
            if (currentUid && userData?.__uid && userData.__uid !== currentUid) return;
            
            // Load currency setting and format balances
            await loadCurrencyAndFormatBalances(userData);
            
            // Update KYC notification from cache
            updateKYCNotification(userData);
            
            // Load transaction history from cache
            loadTransactionHistoryFromCache(userData);
            
            // Load pending transactions from cache
            loadPendingTransactionsFromCache(userData);
            
            // Update welcome message
            const welcomeName = document.getElementById('user-first-name');
            if (userData.firstName && userData.firstName.trim() !== '') {
                welcomeName.textContent = userData.firstName;
            }
            
            // Update cardholder name
            const cardholderName = document.getElementById('cardholder-name');
            const modalCardholderName = document.getElementById('modal-cardholder-name');
            let fullName = '';
            if (userData.firstName && userData.lastName) {
                fullName = `${userData.firstName.toUpperCase()} ${userData.lastName.toUpperCase()}`;
            } else if (userData.firstName) {
                fullName = userData.firstName.toUpperCase();
            }
            if (fullName) {
                if (cardholderName) cardholderName.textContent = fullName;
                if (modalCardholderName) modalCardholderName.textContent = fullName;
            }
        }
        
        // Function to load transaction history from cache
        function loadTransactionHistoryFromCache(userData) {
            let hasMoreThan10 = false;
            let visibleCount = 0;
            
            for (let i = 1; i <= 20; i++) {
                const historyElement = document.getElementById(`history${i}`);
                if (historyElement) {
                    const historyText = userData[`history${i}`] || '';
                    
                    if (historyText && historyText.trim() !== '') {
                        populateTransactionData(historyElement, historyText);
                        
                        if (visibleCount < 10) {
                            historyElement.style.display = 'block';
                            const mobileItem = historyElement.querySelector('.mobile-transaction-item');
                            if (mobileItem) {
                                mobileItem.style.display = 'flex';
                            }
                            visibleCount++;
                        } else {
                            historyElement.style.display = 'none';
                            const mobileItem = historyElement.querySelector('.mobile-transaction-item');
                            if (mobileItem) {
                                mobileItem.style.display = 'none';
                            }
                        }
                        
                        if (i > 10) {
                            hasMoreThan10 = true;
                        }
                    } else {
                        historyElement.style.display = 'none';
                        const mobileItem = historyElement.querySelector('.mobile-transaction-item');
                        if (mobileItem) {
                            mobileItem.style.display = 'none';
                        }
                    }
                }
            }
            
            const seeMoreButton = document.getElementById('see-more');
            if (seeMoreButton) {
                if (hasMoreThan10) {
                    seeMoreButton.classList.remove('hidden');
                } else {
                    seeMoreButton.classList.add('hidden');
                }
            }
            
            // Setup event delegation
            const transactionContainer = document.getElementById('recent-transactions');
            if (transactionContainer) {
                transactionContainer.removeEventListener('click', handleMobileTransactionClick);
                transactionContainer.addEventListener('click', handleMobileTransactionClick, { passive: true });
            }
        }
        
        // Function to load pending transactions from cache
        function loadPendingTransactionsFromCache(userData) {
            const pending1Element = document.getElementById('pending1');
            const pending2Element = document.getElementById('pending2');
            const pending3Element = document.getElementById('pending3');
            const pending4Element = document.getElementById('pending4');
            const pending5Element = document.getElementById('pending5');
            const pendingList = document.getElementById('pending-list');
            
            function populatePendingData(element, pendingText) {
                const parts = pendingText.split('|').map(part => part.trim());
                const type = parts[0] || '';
                const recipient = parts[1] || '';
                const amount = parts[2] || '';
                const time = parts[3] || '';
                const date = parts[4] || '';
                const reference = parts[5] || '';
                
                const descriptionEl = element.querySelector('.pending-description');
                const recipientEl = element.querySelector('.pending-recipient');
                const typeEl = element.querySelector('.pending-type');
                const amountEl = element.querySelector('.pending-amount');
                const dateEl = element.querySelector('.pending-date');
                const avatarEl = element.querySelector('.pending-avatar');
                const avatarTextEl = element.querySelector('.pending-avatar-text');
                
                if (descriptionEl) descriptionEl.textContent = type;
                if (recipientEl) recipientEl.textContent = recipient;
                if (typeEl) typeEl.textContent = type;
                if (amountEl) amountEl.textContent = amount;
                if (dateEl) dateEl.textContent = date;

                if (avatarEl && avatarTextEl) {
                    avatarTextEl.textContent = 'PN';
                    avatarEl.className = 'w-12 h-12 rounded-full flex items-center justify-center pending-avatar font-semibold text-sm bg-orange-50 text-orange-700';
                }
            }
            
            if (userData.pending1 && userData.pending1.trim() !== '') {
                pending1Element.classList.remove('hidden');
                populatePendingData(pending1Element, userData.pending1);
                if (pendingList) pendingList.appendChild(pending1Element);
            }
            
            if (userData.pending2 && userData.pending2.trim() !== '') {
                pending2Element.classList.remove('hidden');
                populatePendingData(pending2Element, userData.pending2);
                if (pendingList) pendingList.appendChild(pending2Element);
            }
            
            if (userData.pending3 && userData.pending3.trim() !== '') {
                pending3Element.classList.remove('hidden');
                populatePendingData(pending3Element, userData.pending3);
                if (pendingList) pendingList.appendChild(pending3Element);
            }
            
            if (userData.pending4 && userData.pending4.trim() !== '') {
                pending4Element.classList.remove('hidden');
                populatePendingData(pending4Element, userData.pending4);
                if (pendingList) pendingList.appendChild(pending4Element);
            }
            
            if (userData.pending5 && userData.pending5.trim() !== '') {
                pending5Element.classList.remove('hidden');
                populatePendingData(pending5Element, userData.pending5);
                if (pendingList) pendingList.appendChild(pending5Element);
            }
            
            if (userData.pending1 && userData.pending2 && userData.pending3 && userData.pending4 && userData.pending5 &&
                userData.pending1.trim() !== '' && userData.pending2.trim() !== '' && userData.pending3.trim() !== '' && 
                userData.pending4.trim() !== '' && userData.pending5.trim() !== '') {
                document.getElementById('pending-limit-notice').classList.remove('hidden');
            } else {
                document.getElementById('pending-limit-notice').classList.add('hidden');
            }
        }
        
        // Function to refresh user data from Firestore (background refresh)
        async function refreshUserData(user) {
            const userDocRef = doc(db, 'users', user.uid);
            const userDoc = await getDoc(userDocRef);
            
                if (userDoc.exists()) {
                const userData = userDoc.data();

                const approvalStatus = userData?.approvalStatus || null;
                const isApproved = (typeof userData?.isApproved === 'boolean') ? userData.isApproved : null;
                const approved =
                    approvalStatus === 'approved'
                    || (approvalStatus == null && isApproved !== false);
                if (!approved) {
                    clearCachedUserData();
                    try { await signOut(auth); } catch {}
                    window.location.href = 'login.html?pending=1';
                    return;
                }

                cacheUserData({ ...(userData || {}), __uid: user.uid, __email: user.email || userData?.email || null });
                // Update welcome message if it changed
                const welcomeName = document.getElementById('user-first-name');
                if (welcomeName && userData.firstName && userData.firstName.trim() !== '') {
                    welcomeName.textContent = userData.firstName;
                }
            }
        }
    
        // Sign out function
        window.signOut = function() {
            // Clear cached profile so a different account won't see the previous user's details.
            clearCachedUserData();
            signOut(auth).then(() => {
                alert('Signed out successfully!');
                window.location.href = 'login.html'; // Redirect after sign-out
            }).catch((error) => {
                alert('Error signing out: ' + error.message);
            });
        };

        // Loan application status tracking
        let loanListenerUnsubscribe = null;

        async function checkLoanApplicationStatus(user) {
            try {
                const loanDocRef = doc(db, 'loans', user.uid);
                
                // Unsubscribe from previous listener if exists
                if (loanListenerUnsubscribe) {
                    loanListenerUnsubscribe();
                }
                
                // Set up real-time listener for loan status
                loanListenerUnsubscribe = onSnapshot(loanDocRef, (loanDoc) => {
                    if (loanDoc.exists()) {
                        const loanData = loanDoc.data();
                        console.log('Loan document updated:', loanData);
                        console.log('Loan status:', loanData.status);
                        // Force update the display with current status
                        updateLoanStatusDisplay(loanData);
                    } else {
                        // No loan application, hide badge and modal
                        console.log('Loan document does not exist');
                        hideLoanStatusDisplay();
                    }
                }, (error) => {
                    console.warn('Error listening to loan status:', error);
                    // Don't show error if document doesn't exist
                    if (error.code !== 'permission-denied') {
                        hideLoanStatusDisplay();
                    }
                });
            } catch (error) {
                console.error('Error checking loan status:', error);
            }
        }

        function updateLoanStatusDisplay(loanData) {
            // Get status - normalize to lowercase for comparison
            const rawStatus = loanData.status || loanData.loanStatus || 'pending';
            const status = String(rawStatus).toLowerCase().trim();
            const loanAmount = loanData.loanAmount || 0;
            const submittedAt = loanData.submittedAt || loanData.createdAt;
            
            console.log('Updating loan status display:', {
                rawStatus: rawStatus,
                normalizedStatus: status,
                fullLoanData: loanData
            });
            
            // Get loan status card elements
            const loanCard = document.getElementById('loanStatusCard');
            
            // Always hide the modal by default - only show when user clicks
            const modal = document.getElementById('loanProgressModal');
            if (modal) {
                modal.classList.add('hidden');
            }
            
            // Show loan status card instead of modal
            if (loanCard) {
                loanCard.classList.remove('hidden');
                updateLoanStatusCard(loanData, status);
            } else {
                console.error('Loan status card not found');
            }
        }
        
        function updateLoanStatusCard(loanData, status) {
            const card = document.getElementById('loanStatusCard');
            if (!card) return;
            
            const loanAmount = loanData.loanAmount || 0;
            const submittedAt = loanData.submittedAt || loanData.createdAt;
            let dateText = 'N/A';
            
            if (submittedAt && submittedAt.toDate) {
                dateText = submittedAt.toDate().toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric' 
                });
            }
            
            // Update card content
            const amountEl = card.querySelector('#loanCardAmount');
            const statusEl = card.querySelector('#loanCardStatus');
            const dateEl = card.querySelector('#loanCardDate');
            const iconEl = card.querySelector('#loanCardIcon');
            const titleEl = card.querySelector('#loanCardTitle');
            const messageEl = card.querySelector('#loanCardMessage');
            
            if (amountEl) amountEl.textContent = `$${loanAmount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            if (dateEl) dateEl.textContent = dateText;
            
            if (status === 'approved') {
                if (iconEl) {
                    iconEl.className = 'w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center';
                    iconEl.innerHTML = '<i class="fas fa-check-circle text-blue-600 text-2xl"></i>';
                }
                if (titleEl) titleEl.textContent = 'Loan Approved';
                if (messageEl) messageEl.textContent = 'Your loan application has been approved. View details to see repayment schedule.';
                if (statusEl) {
                    statusEl.textContent = 'Approved';
                    statusEl.className = 'px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-700';
                }
                card.className = 'bg-white rounded-xl shadow-lg border-2 border-blue-200 p-5 mb-6';
            } else if (status === 'rejected') {
                if (iconEl) {
                    iconEl.className = 'w-12 h-12 bg-red-100 rounded-full flex items-center justify-center';
                    iconEl.innerHTML = '<i class="fas fa-times-circle text-red-600 text-2xl"></i>';
                }
                if (titleEl) titleEl.textContent = 'Loan Rejected';
                if (messageEl) messageEl.textContent = 'Your loan application was not approved. Contact support for more information.';
                if (statusEl) {
                    statusEl.textContent = 'Rejected';
                    statusEl.className = 'px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700';
                }
                card.className = 'bg-white rounded-xl shadow-lg border-2 border-red-200 p-5 mb-6';
            } else {
                // Pending
                if (iconEl) {
                    iconEl.className = 'w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center';
                    iconEl.innerHTML = '<i class="fas fa-spinner fa-spin text-blue-600 text-2xl"></i>';
                }
                if (titleEl) titleEl.textContent = 'Loan Under Review';
                if (messageEl) messageEl.textContent = 'Your loan application is being reviewed. We will notify you once a decision is made.';
                if (statusEl) {
                    statusEl.textContent = 'Pending';
                    statusEl.className = 'px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-700';
                }
                card.className = 'bg-white rounded-xl shadow-lg border-2 border-blue-200 p-5 mb-6';
            }
            
            // Store loan data for modal
            card.dataset.loanData = JSON.stringify(loanData);
            card.dataset.loanStatus = status;
        }

        function showLoanStatusBadge(loanAmount, submittedAt) {
            const badge = document.getElementById('loanStatusBadge');
            const badgeText = document.getElementById('loanStatusBadgeText');
            
            if (badge && badgeText) {
                badge.classList.remove('hidden');
                badgeText.textContent = 'Under Review';
            }
        }

        function showLoanStatusModal(loanData, status) {
            const modal = document.getElementById('loanProgressModal');
            const icon = document.getElementById('loanProgressIcon');
            const title = document.getElementById('loanProgressTitle');
            const message = document.getElementById('loanProgressMessage');
            const amount = document.getElementById('loanProgressAmount');
            const statusEl = document.getElementById('loanProgressStatus');
            const date = document.getElementById('loanProgressDate');
            const progressBar = document.getElementById('loanProgressBar');
            
            if (!modal) {
                console.error('Loan progress modal not found');
                return;
            }

            // Normalize status to lowercase for comparison
            const normalizedStatus = String(status).toLowerCase().trim();
            console.log('Showing loan status modal with status:', normalizedStatus, 'original:', status);

            const loanAmount = loanData.loanAmount || 0;
            const submittedAt = loanData.submittedAt || loanData.createdAt;
            let dateText = 'N/A';
            
            if (submittedAt && submittedAt.toDate) {
                dateText = submittedAt.toDate().toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric' 
                });
            }

            amount.textContent = `$${loanAmount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            date.textContent = dateText;

            if (normalizedStatus === 'approved') {
                console.log('Setting modal to APPROVED state');
                icon.className = 'w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4';
                icon.innerHTML = '<i class="fas fa-check-circle text-blue-600 text-3xl"></i>';
                title.textContent = 'Loan Application Approved!';
                message.textContent = 'Congratulations! Your loan application has been approved. Click the button below to view your loan details and repayment schedule.';
                statusEl.textContent = 'Approved';
                statusEl.className = 'text-sm font-semibold text-blue-600';
                progressBar.style.width = '100%';
                progressBar.className = 'bg-blue-600 h-2 rounded-full transition-all duration-500';
                
                // Update close button to navigate to loan page
                const closeBtn = modal.querySelector('button');
                if (closeBtn) {
                    closeBtn.innerHTML = '<i class="fas fa-arrow-right mr-2"></i>View Loan Details';
                    closeBtn.onclick = function() {
                        window.location.href = 'loan.html';
                    };
                    closeBtn.className = 'w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200';
                }
            } else if (normalizedStatus === 'rejected') {
                console.log('Setting modal to REJECTED state');
                icon.className = 'w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4';
                icon.innerHTML = '<i class="fas fa-times-circle text-red-600 text-3xl"></i>';
                title.textContent = 'Loan Application Rejected';
                message.textContent = 'We\'re sorry, but your loan application has been rejected. Please contact support for more information or try applying again later.';
                statusEl.textContent = 'Rejected';
                statusEl.className = 'text-sm font-semibold text-red-600';
                progressBar.style.width = '100%';
                progressBar.className = 'bg-red-600 h-2 rounded-full transition-all duration-500';
                
                // Reset close button
                const closeBtn = modal.querySelector('button');
                if (closeBtn) {
                    closeBtn.innerHTML = '<i class="fas fa-times mr-2"></i>Close';
                    closeBtn.onclick = function() {
                        closeLoanProgressModal();
                    };
                    closeBtn.className = 'w-full text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200';
                    closeBtn.style.backgroundColor = '#1800ac';
                    closeBtn.onmouseover = function() { this.style.backgroundColor = '#140099'; };
                    closeBtn.onmouseout = function() { this.style.backgroundColor = '#1800ac'; };
                }
            } else {
                console.log('Setting modal to PENDING state');
                icon.className = 'w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4';
                icon.innerHTML = '<i class="fas fa-spinner fa-spin text-blue-600 text-3xl"></i>';
                title.textContent = 'Loan Application Under Review';
                message.textContent = 'Your loan application is being reviewed by our team. You will be notified once a decision has been made.';
                statusEl.textContent = 'Pending';
                statusEl.className = 'text-sm font-semibold text-yellow-600';
                progressBar.style.width = '50%';
                progressBar.className = 'bg-blue-600 h-2 rounded-full transition-all duration-500';
                
                // Reset close button
                const closeBtn = modal.querySelector('button');
                if (closeBtn) {
                    closeBtn.innerHTML = '<i class="fas fa-times mr-2"></i>Close';
                    closeBtn.onclick = function() {
                        closeLoanProgressModal();
                    };
                    closeBtn.className = 'w-full text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200';
                    closeBtn.style.backgroundColor = '#1800ac';
                    closeBtn.onmouseover = function() { this.style.backgroundColor = '#140099'; };
                    closeBtn.onmouseout = function() { this.style.backgroundColor = '#1800ac'; };
                }
            }

            modal.classList.remove('hidden');
        }

        function hideLoanStatusDisplay() {
            const badge = document.getElementById('loanStatusBadge');
            const modal = document.getElementById('loanProgressModal');
            const card = document.getElementById('loanStatusCard');
            
            if (badge) badge.classList.add('hidden');
            if (modal) modal.classList.add('hidden');
            if (card) card.classList.add('hidden');
        }

        window.openLoanProgressModal = function() {
            // Get loan data from the card if available
            const loanCard = document.getElementById('loanStatusCard');
            if (loanCard && loanCard.dataset.loanData) {
                try {
                    const loanData = JSON.parse(loanCard.dataset.loanData);
                    const status = loanCard.dataset.loanStatus || loanData.status || 'pending';
                    showLoanStatusModal(loanData, status);
                } catch (e) {
                    console.error('Error parsing loan data:', e);
                }
            } else {
                // Fallback: fetch from Firestore
                const user = auth.currentUser;
                if (!user) return;

                const loanDocRef = doc(db, 'loans', user.uid);
                getDoc(loanDocRef).then((loanDoc) => {
                    if (loanDoc.exists()) {
                        const loanData = loanDoc.data();
                        showLoanStatusModal(loanData, loanData.status || 'pending');
                    }
                }).catch((error) => {
                    console.error('Error loading loan data:', error);
                });
            }
        };

        window.closeLoanProgressModal = function() {
            const modal = document.getElementById('loanProgressModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        };
    </script>
    
</head>
<body class="font-sans antialiased" style="position: relative; overflow: hidden;">
    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: url('background 5.png'); background-size: cover; opacity: 0.9; z-index: -1;"></div>


    <!-- Navbar -->
    <nav class="bg-white border-b border-gray-300 fixed top-0 w-full z-50 shadow-sm">
        <div class="container mx-auto flex items-center justify-between">
            <!-- Left Logo -->
            <a href="/" class="flex items-center" aria-label="Twenty Third & Forth">
                <img src="11.png" alt="Twenty Third & Forth" class="h-14 md:h-16 w-auto">
            </a>

            <!-- Right Logo (Email) -->
            <a href="mailto:support@twentythirdforth.com" class="flex items-center bg-gray-100 p-2 rounded-full hover:bg-gray-200 transition-all">
                <img src="chat.png" alt="Contact" class="h-8 w-8">
            </a>
        </div>
    </nav>

    <!-- Spacer to prevent content overlap -->
    <div class="h-12"></div>

    <!-- <div class="container mt-16 mb-2">
        <header class="header">
            <div>
                <i class="fas fa-bell" style="margin-right: 6px; color: var(--chase-blue);"></i>
                <i class="fas fa-user-circle" style="font-size: 18px; color: var(--chase-blue);"></i>
            </div>
        </header> -->
        
        <!-- In your HTML section at the bottom -->
        <div class="flex-1 p-2 bg- mt-24" style="padding-bottom: 120px;">
            <h1 id="welcome-name" class="text-sm-xl font-semibold mb-2 mt-2 rounded-lg text-gray-900">
                Welcome back, <span id="user-first-name"></span>
                <p class="date-text" id="date-time-text" style="margin-top: 0.5rem;">Logged in: 11/08/2025 7:11 am</p>
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        const dateTimeText = document.getElementById('date-time-text');
                        
                        function updateDateTime() {
                            const now = new Date();
                            
                            // Format date as MM/DD/YYYY
                            const month = String(now.getMonth() + 1).padStart(2, '0');
                            const day = String(now.getDate()).padStart(2, '0');
                            const year = now.getFullYear();
                            const date = `${month}/${day}/${year}`;
                            
                            // Format time with leading zeros and am/pm
                            let hours = now.getHours();
                            const minutes = String(now.getMinutes()).padStart(2, '0');
                            const ampm = hours >= 12 ? 'pm' : 'am';
                            hours = hours % 12;
                            hours = hours ? hours : 12; // 0 should be 12
                            const time = `${hours}:${minutes} ${ampm}`;
                            
                            dateTimeText.textContent = `Logged in: ${date} ${time}`;
                        }
                        
                        // Update immediately
                        updateDateTime();
                        
                        // Update every second for real-time updates
                        setInterval(updateDateTime, 1000);
                    });
                </script>
            </h1>


            <!-- Add a horizontal line here -->
            <hr class="my-4 border-gray-400">
        
            <section class="accounts-section">
                <div class="section-header">
                    <h2 class="section-title">Accounts</h2>
                </div>
                
                    <div class="accounts-carousel">
                    <!-- Checking Account Card -->
                        <div class="account-card checking">
                        <div class="card-header">
                            <span class="account-type">CHECKING</span>
                            <h3 class="account-name">Checking Account</h3>
                        </div>
                        <div class="account-balance" id="checking">0.00</div>
                        <div class="account-actions">
                            <a href="transfer.html" class="action-button rounded-full">
                                <i class="fas fa-exchange-alt"></i> Transfer
                            </a>
                            <a href="statement.html" class="action-button rounded-full">
                                <i class="fas fa-file-invoice-dollar"></i> Statement
                            </a>
                        </div>
                        <button id="toggle-checking" class="balance-toggle-btn" title="Toggle balance visibility">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    
                        <!-- Savings Account Card -->
                        <div class="account-card savings">
                        <div class="card-header">
                            <span class="account-type">SAVINGS</span>
                            <h3 class="account-name">Savings Account</h3>
                        </div>
                        <div class="account-balance" id="savings">0.00</div>
                        <div class="account-actions">
                            <a href="transfer.html" class="action-button rounded-full">
                                <i class="fas fa-exchange-alt"></i> Transfer
                            </a>
                            <a href="statement.html" class="action-button rounded-full">
                                <i class="fas fa-file-invoice-dollar"></i> Statement
                            </a>
                        </div>
                        <button id="toggle-savings" class="balance-toggle-btn" title="Toggle balance visibility">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    
                        <!-- Fixed Account Card -->
                        <div class="account-card fixed">
                        <div class="card-header">
                            <span class="account-type">FIXED DEPOSIT</span>
                            <h3 class="account-name">Fixed Deposit</h3>
                        </div>
                        <div class="account-balance" id="fixed">0.00</div>
                        <div class="account-actions">
                            <a href="transfer.html" class="action-button rounded-full">
                                <i class="fas fa-exchange-alt"></i> Transfer
                            </a>
                            <a href="statement.html" class="action-button rounded-full">
                                <i class="fas fa-file-invoice-dollar"></i> Statement
                            </a>
                        </div>
                        <button id="toggle-fixed" class="balance-toggle-btn" title="Toggle balance visibility">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Loan Status Card -->
            <div id="loanStatusCard" class="hidden bg-white rounded-xl shadow-lg border-2 border-blue-200 p-5 mb-6">
                <div class="flex items-start justify-between">
                    <div class="flex items-start gap-4 flex-1">
                        <div id="loanCardIcon" class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-spinner fa-spin text-blue-600 text-2xl"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h3 id="loanCardTitle" class="text-lg font-semibold text-gray-900">Loan Under Review</h3>
                                <span id="loanCardStatus" class="px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-700">Pending</span>
                            </div>
                            <p id="loanCardMessage" class="text-sm text-gray-600 mb-3">
                                Your loan application is being reviewed. We will notify you once a decision is made.
                            </p>
                            <div class="flex items-center gap-4 text-sm">
                                <div>
                                    <span class="text-gray-500">Amount:</span>
                                    <span id="loanCardAmount" class="font-semibold text-gray-900 ml-1">$0.00</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Submitted:</span>
                                    <span id="loanCardDate" class="text-gray-700 ml-1">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-3 mt-4 pt-4 border-t border-gray-200">
                    <button 
                        onclick="openLoanProgressModal()" 
                        class="flex-1 text-white font-semibold py-2.5 px-4 rounded-lg transition-all duration-200 text-sm"
                        style="background-color: #1800ac;"
                        onmouseover="this.style.backgroundColor='#140099'"
                        onmouseout="this.style.backgroundColor='#1800ac'"
                    >
                        <i class="fas fa-info-circle mr-2"></i>See More Details
                    </button>
                    <button 
                        onclick="window.location.href='loan.html'" 
                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 px-4 rounded-lg transition-all duration-200 text-sm"
                    >
                        <i class="fas fa-arrow-right mr-2"></i>View Loan Page
                    </button>
                </div>
            </div>

            <!-- ACH Transfer Modal (Subject to Approval) -->
            <div id="achModal" class="hidden fixed inset-0 z-50 flex items-start md:items-center justify-center p-2 md:p-3" style="padding-bottom: 120px; background-color: rgba(24, 0, 172, 0.5);">
                <div class="bg-white rounded-xl md:rounded-2xl shadow-2xl border border-gray-200 w-full max-w-sm md:max-w-md mx-auto relative max-h-[80vh] md:max-h-[85vh] overflow-y-auto" style="margin: auto;">
                    <button type="button" class="absolute top-2 right-2 md:top-3 md:right-3 text-gray-400 hover:text-gray-600 text-xl md:text-2xl font-bold" aria-label="Close" onclick="closeAchModal()">&times;</button>
                    <div class="p-3 md:p-4">
                        <div class="flex items-start justify-between mb-4">
                            <div>
                                <h3 class="text-lg md:text-xl font-semibold text-gray-900">Initiate ACH Transfer</h3>
                                <p class="text-xs md:text-sm text-gray-500 mt-1">Domestic ACH transfers are reviewed and subject to approval.</p>
                            </div>
                            <span class="inline-flex items-center gap-2 text-[11px] md:text-xs px-3 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-200">Pending approval</span>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                            <div>
                                <label class="block text-[11px] uppercase tracking-wide text-gray-500 mb-2">Funding Source</label>
                                <select id="achFundingSource" class="w-full bg-white border border-gray-200 rounded-lg px-4 py-3 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-400 text-sm shadow-sm appearance-none">
                                    <option value="" disabled selected>Select funding source</option>
                                    <option value="checking_account">Checking Account</option>
                                    <option value="savings_account">Savings Account</option>
                                </select>
                                <p id="achFundingSourceError" class="hidden text-[11px] text-red-500 mt-2">Funding Source is required</p>
                            </div>
                            <div>
                                <label class="block text-[11px] uppercase tracking-wide text-gray-500 mb-2">Recipient Name</label>
                                <input id="achRecipientName" type="text" placeholder="Enter recipient name" class="w-full bg-white border border-gray-200 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-400 text-sm shadow-sm" />
                                <p id="achRecipientNameError" class="hidden text-[11px] text-red-500 mt-2">Recipient Name is required</p>
                            </div>

                            <div>
                                <label class="block text-[11px] uppercase tracking-wide text-gray-500 mb-2">Routing Number (ABA)</label>
                                <input id="achRoutingNumber" inputmode="numeric" maxlength="9" placeholder="9-digit routing number" class="w-full bg-white border border-gray-200 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-400 text-sm shadow-sm" />
                                <p id="achRoutingNumberError" class="hidden text-[11px] text-red-500 mt-2">Enter a valid 9-digit routing number</p>
                            </div>
                            <div>
                                <label class="block text-[11px] uppercase tracking-wide text-gray-500 mb-2">Account Number</label>
                                <input id="achAccountNumber" type="text" placeholder="Enter account number" class="w-full bg-white border border-gray-200 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-400 text-sm shadow-sm" />
                                <p id="achAccountNumberError" class="hidden text-[11px] text-red-500 mt-2">Account Number is required</p>
                            </div>

                            <div>
                                <label class="block text-[11px] uppercase tracking-wide text-gray-500 mb-2">Account Type</label>
                                <select id="achAccountType" class="w-full bg-white border border-gray-200 rounded-lg px-4 py-3 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-400 text-sm shadow-sm appearance-none">
                                    <option value="checking">Checking</option>
                                    <option value="savings">Savings</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-[11px] uppercase tracking-wide text-gray-500 mb-2">Amount (USD)</label>
                                <input id="achAmount" inputmode="decimal" placeholder="$ Enter amount" class="w-full bg-white border border-gray-200 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-400 text-sm shadow-sm" />
                                <p id="achAmountError" class="hidden text-[11px] text-red-500 mt-2">Enter a valid amount</p>
                            </div>

                            <div class="md:col-span-2">
                                <label class="block text-[11px] uppercase tracking-wide text-gray-500 mb-2">Memo (optional)</label>
                                <input id="achMemo" type="text" placeholder="Add a note for this transfer" class="w-full bg-white border border-gray-200 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-400 text-sm shadow-sm" />
                            </div>
                        </div>

                        <div class="mt-4 md:mt-5 p-3 md:p-4 rounded-lg bg-blue-50 border border-blue-200">
                            <p class="text-[11px] md:text-xs text-blue-900 leading-relaxed">By submitting, you authorize Twenty Third & Forth to initiate an ACH debit or credit to the account indicated above in accordance with NACHA rules. Transfers are reviewed and may take 1–3 business days after approval to settle.</p>
                        </div>

                        <div class="mt-4 space-y-2">
                            <label class="flex items-start gap-2 text-xs text-gray-700">
                                <input id="achAuthorize" type="checkbox" class="mt-0.5 w-4 h-4 text-blue-600 border-gray-300 rounded" />
                                <span>I authorize this ACH transaction.</span>
                            </label>
                            <label class="flex items-start gap-2 text-xs text-gray-700">
                                <input id="achConfirmDetails" type="checkbox" class="mt-0.5 w-4 h-4 text-blue-600 border-gray-300 rounded" />
                                <span>I confirm the details above are accurate.</span>
                            </label>
                            <p id="achConsentError" class="hidden text-[11px] text-red-500">Authorization and confirmation are required</p>
                        </div>

                        <div class="mt-5 md:mt-6 flex flex-col-reverse md:flex-row md:justify-end gap-2 md:gap-3">
                            <button type="button" class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 text-sm hover:bg-gray-50 w-full md:w-auto" onclick="closeAchModal()">Cancel</button>
                            <button id="achSubmitBtn" type="button" class="px-5 py-2.5 rounded-full text-sm font-semibold text-white bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 shadow hover:shadow-md active:scale-[0.99] w-full md:w-auto" onclick="submitAchRequest()">Submit for Approval</button>
                        </div>
                    </div>
                </div>
            </div>


            <!-- ACH Submitted Modal -->
            <div id="achSubmittedModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-3" style="background-color: rgba(24, 0, 172, 0.5);">
                <div class="bg-white rounded-2xl border border-gray-200 p-6 w-full max-w-sm mx-auto text-center">
                    <div class="w-16 h-16 mx-auto rounded-full bg-blue-50 border-2 border-blue-600 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414L9 11.586l6.293-6.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mt-4">ACH Submitted for Approval</h3>
                    <p class="text-sm text-gray-600 mt-1">We'll notify you once it's approved and processing.</p>
                    <button type="button" class="mt-5 w-full bg-blue-600 hover:bg-blue-700 text-white rounded-full py-2 text-sm font-medium" onclick="closeAchSubmittedModal()">Done</button>
                </div>
            </div>

            <!-- Transaction Detail Modal (Mobile Only) -->
            <div id="transactionDetailModal" class="transaction-detail-modal">
                <div class="transaction-detail-header">
                    <button class="transaction-detail-back" onclick="closeTransactionDetail()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="transaction-detail-title">Transaction</div>
                    <button class="transaction-detail-share" onclick="shareTransaction()">Share</button>
                </div>
                <div class="transaction-detail-body">
                    <div class="transaction-detail-amount" id="detail-amount">+₦0.00</div>
                    <div class="transaction-detail-type" id="detail-type">-</div>
                    <div class="transaction-detail-date" id="detail-date">-</div>
                    <div style="text-align: center;">
                        <div class="transaction-detail-badge">
                            <i class="fas fa-piggy-bank" style="font-size: 14px;"></i>
                            <span id="detail-category">Savings</span>
                        </div>
                    </div>
                    
                    <div class="transaction-detail-row">
                        <span class="transaction-detail-label">From</span>
                        <div style="display: flex; align-items: center; flex: 1; justify-content: flex-end;">
                            <span class="transaction-detail-value" id="detail-from">Kuda</span>
                            <div class="transaction-detail-icon" id="detail-from-icon" style="background-color: #7c3aed;">
                                <span style="color: white; font-weight: 600; font-size: 14px;">K.</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="transaction-detail-row">
                        <span class="transaction-detail-label">Description</span>
                        <span class="transaction-detail-value" id="detail-description">-</span>
                    </div>
                    
                    <div class="transaction-detail-row">
                        <div style="flex: 1;">
                            <span class="transaction-detail-label">Payment Method</span>
                            <div class="transaction-detail-value" style="text-align: left; margin-left: 0; margin-top: 4px;" id="detail-method">-</div>
                        </div>
                        <div style="flex: 1; text-align: right;">
                            <span class="transaction-detail-label">Fees</span>
                            <div class="transaction-detail-value" style="text-align: right; margin-top: 4px;" id="detail-fees">₦0.00</div>
                        </div>
                    </div>
                    
                    <div class="transaction-detail-row">
                        <span class="transaction-detail-label">Transaction Reference</span>
                        <div style="display: flex; align-items: center; flex: 1; justify-content: flex-end;">
                            <span class="transaction-detail-value" id="detail-reference" style="font-family: monospace;">-</span>
                            <button class="transaction-detail-copy" onclick="copyTransactionReference()">
                                <i class="fas fa-copy" style="font-size: 10px;"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="transaction-detail-row">
                        <span class="transaction-detail-label">Status</span>
                        <div class="transaction-detail-status">
                            <div class="transaction-detail-status-dot"></div>
                            <span class="transaction-detail-status-text" id="detail-status">Successful</span>
                        </div>
                    </div>
                    
                    <div class="transaction-detail-actions">
                        <div class="transaction-detail-action-title">More Actions</div>
                        <button class="transaction-detail-report" onclick="reportTransaction()">
                            <div class="transaction-detail-report-left">
                                <i class="fas fa-exclamation-circle transaction-detail-report-icon"></i>
                                <div class="transaction-detail-report-text">
                                    <div class="transaction-detail-report-title">Report Transaction</div>
                                    <div class="transaction-detail-report-subtitle">Report an issue with this payment</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color: #999;"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Add a horizontal line here -->
            <hr class="my-4 border-gray-400"> <!-- Added line -->
        
            <!-- Quick Actions (Clean Design) -->
            <section class="bg-white rounded-lg shadow-sm border border-gray-300 p-6 mb-8">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900">Quick Actions</h2>
                        <p class="text-gray-500 text-sm">Common tasks at your fingertips</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                    <!-- Deposit -->
                    <button type="button" class="group rounded-xl border border-gray-300 bg-white p-4 hover:shadow-md hover:border-gray-400 transition-colors duration-200 focus:outline-none" onclick="navigateWithSpinner('deposit.html')">
                        <div class="flex flex-col items-center">
                            <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center ring-1 ring-gray-300 group-hover:ring-gray-400 mb-3">
                                <img src="deposit.png" alt="Deposit Icon" class="h-6 w-6" />
                            </div>
                            <span class="text-sm font-medium text-gray-800">Deposit</span>
                        </div>
                    </button>
                    
                    <!-- Transfer -->
                    <button type="button" class="group rounded-xl border border-gray-300 bg-white p-4 hover:shadow-md hover:border-gray-400 transition-colors duration-200 focus:outline-none" onclick="navigateWithSpinner('transfer.html')">
                        <div class="flex flex-col items-center">
                            <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center ring-1 ring-gray-300 group-hover:ring-gray-400 mb-3">
                                <img src="transfer.png" alt="Transfer Icon" class="h-6 w-6" />
                            </div>
                            <span class="text-sm font-medium text-gray-800">Transfer</span>
                        </div>
                    </button>

                    <!-- ACH -->
                    <button type="button" class="group rounded-xl border border-gray-300 bg-white p-4 hover:shadow-md hover:border-gray-400 transition-colors duration-200 focus:outline-none" onclick="navigateWithSpinner('ach.html')">
                        <div class="flex flex-col items-center">
                            <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center ring-1 ring-gray-300 group-hover:ring-gray-400 mb-3">
                                <img src="deposit.png" alt="ACH Icon" class="h-6 w-6" />
                            </div>
                            <span class="text-sm font-medium text-gray-800">ACH</span>
                        </div>
                    </button>
                    
                    <!-- Statements -->
                    <button type="button" class="group rounded-xl border border-gray-300 bg-white p-4 hover:shadow-md hover:border-gray-400 transition-colors duration-200 focus:outline-none" onclick="navigateWithSpinner('statement.html')">
                        <div class="flex flex-col items-center">
                            <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center ring-1 ring-gray-300 group-hover:ring-gray-400 mb-3">
                                <img src="statement.png" alt="Statements Icon" class="h-6 w-6" />
                            </div>
                            <span class="text-sm font-medium text-gray-800">Statements</span>
                        </div>
                    </button>
                    
                    <!-- Security -->
                    <button type="button" class="group rounded-xl border border-gray-300 bg-white p-4 hover:shadow-md hover:border-gray-400 transition-colors duration-200 focus:outline-none" onclick="navigateWithSpinner('security.html')">
                        <div class="flex flex-col items-center">
                            <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center ring-1 ring-gray-300 group-hover:ring-gray-400 mb-3">
                                <img src="key.png" alt="Security Icon" class="h-6 w-6" />
                            </div>
                            <span class="text-sm font-medium text-gray-800">Security</span>
                        </div>
                    </button>

                    <!-- Loans -->
                    <button type="button" class="group rounded-xl border border-gray-300 bg-white p-4 hover:shadow-md hover:border-gray-400 transition-colors duration-200 focus:outline-none" onclick="navigateWithSpinner('loan.html')">
                        <div class="flex flex-col items-center">
                            <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center ring-1 ring-gray-300 group-hover:ring-gray-400 mb-3">
                                <i class="fas fa-hand-holding-usd text-gray-800 text-xl"></i>
                            </div>
                            <span class="text-sm font-medium text-gray-800">Loans</span>
                        </div>
                    </button>

                    <!-- Debit Card -->
                    <button type="button" class="group rounded-xl border border-gray-300 bg-white p-4 hover:shadow-md hover:border-gray-400 transition-colors duration-200 focus:outline-none" onclick="window.location.href='debit-card.html'">
                        <div class="flex flex-col items-center">
                            <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center ring-1 ring-gray-300 group-hover:ring-gray-400 mb-3">
                                <i class="fas fa-credit-card text-gray-800 text-xl"></i>
                            </div>
                            <span class="text-sm font-medium text-gray-800">Debit Card</span>
                        </div>
                    </button>
                </div>

                <!-- Debit Card progress (shows prior to approval) -->
                <div id="debitCardProgressWrap" class="hidden mt-4 rounded-xl border border-gray-200 bg-white p-4">
                    <div class="flex items-center justify-between gap-3">
                        <div class="text-sm font-semibold text-gray-900">Debit Card</div>
                        <span id="debitCardProgressStatus" class="text-xs font-semibold px-3 py-1 rounded-full border" style="border-color: rgba(24,0,172,.25); background: rgba(24,0,172,.06); color:#1800ac;">Pending approval</span>
                    </div>
                    <div class="mt-3">
                        <div class="h-2 rounded-full bg-gray-100 overflow-hidden border border-gray-200">
                            <div id="debitCardProgressBar" class="h-full" style="width: 60%; background: linear-gradient(90deg, #1800ac, #4f46e5);"></div>
                        </div>
                        <p id="debitCardProgressText" class="text-xs text-gray-600 mt-2">Your debit card request is being reviewed.</p>
                    </div>
                </div>
            </section>
        
            <!-- Add a horizontal line here -->
            <hr class="my-4 border-gray-400"> <!-- Added line -->

            <!-- Transaction History Card -->
            <div id="recent-transactions" class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden w-full mb-8">
                <!-- Header Section -->
                <div class="bg-white px-6 py-5 border-b border-gray-100">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                            <h2 class="text-xl font-semibold text-gray-900">Transactions</h2>
                        </div>
                        <div class="flex items-center gap-4">
                            <button id="toggle-filters" class="hidden md:block bg-gray-50 hover:bg-gray-100 text-gray-700 transition-all duration-200 px-4 py-2 rounded-lg border border-gray-200 text-sm font-medium">
                            <i class="fas fa-filter mr-2"></i>Filter
                        </button>
                        </div>
                    </div>
                </div>
                
                <!-- Filter Section -->
                <div id="filter-section" class="hidden bg-gray-50 border-b border-gray-200">
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                            <!-- Date Filter -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                                <input type="date" id="filter-date" class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                            </div>
                            
                            <!-- Transaction ID Filter -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Transaction ID</label>
                                <input type="text" id="filter-id" placeholder="Search by ID..." class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                            </div>
                            
                            <!-- Amount Filter -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
                                <input type="number" id="filter-amount" placeholder="Enter amount..." step="0.01" class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                            </div>
                            
                            <!-- Name Filter -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                <input type="text" id="filter-name" placeholder="Search description..." class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <!-- Filter Actions -->
                        <div class="flex gap-3">
                            <button id="apply-filters" class="px-4 py-2 text-white rounded-lg text-sm font-medium focus:outline-none focus:ring-2 transition-all duration-200" style="background-color: #1800ac;" onmouseover="this.style.backgroundColor='#140099'" onmouseout="this.style.backgroundColor='#1800ac'" onfocus="this.style.outlineColor='#1800ac'">
                                <i class="fas fa-search mr-2"></i>Apply
                            </button>
                            <button id="clear-filters" class="px-4 py-2 bg-gray-500 text-white rounded-lg text-sm font-medium hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-400 transition-all duration-200">
                                <i class="fas fa-times mr-2"></i>Clear
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- History Content -->
                <div class="p-4 md:p-6">
                    <!-- Transaction List -->
                    <div class="space-y-0 md:space-y-3">

                    <!-- Transaction Entries -->
                    <div class="space-y-1">
                        <!-- Visible Transaction History Entries (1-10) -->
                        <div id="history1" class="transaction-entry bg-white border border-gray-100 rounded-xl p-4 md:p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300">
                            <!-- Desktop Layout -->
                            <div class="hidden md:grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm">No history available</p>
                                            <p class="text-gray-500 text-xs">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">-</span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900">-</p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm">-</p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono">-</p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-gray-300 rounded-full"></span>
                                </div>
                    </div>

                            <!-- Mobile Layout - Simplified -->
                            <div class="md:hidden mobile-transaction-item" data-transaction-id="history1" style="opacity: 0.5;">
                                <div class="mobile-transaction-icon" style="background-color: #f3f4f6;">
                                    <i class="fas fa-exchange-alt text-gray-400 text-sm"></i>
                                        </div>
                                <div class="mobile-transaction-content">
                                    <div class="mobile-transaction-description">No history available</div>
                                    <div class="mobile-transaction-time">-</div>
                                        </div>
                                <div class="mobile-transaction-amount">-</div>
                            </div>
                    </div>

                        <div id="history2" class="transaction-entry bg-white border border-gray-100 rounded-xl p-4 md:p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300">
                            <!-- Desktop Layout -->
                            <div class="hidden md:grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                    </div>

                            <!-- Mobile Layout - Simplified -->
                            <div class="md:hidden mobile-transaction-item" data-transaction-id="history2">
                                <div class="mobile-transaction-icon transaction-icon-mobile" style="background-color: #e0f2fe;">
                                    <span class="transaction-icon-text-mobile" style="color: #0369a1; font-size: 18px;">₦</span>
                                        </div>
                                <div class="mobile-transaction-content">
                                    <div class="mobile-transaction-description transaction-description"></div>
                                    <div class="mobile-transaction-time transaction-time-mobile"></div>
                                        </div>
                                <div class="mobile-transaction-amount transaction-amount-mobile"></div>
                            </div>
                    </div>

                        <div id="history3" class="transaction-entry bg-white border border-gray-100 rounded-xl p-4 md:p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300">
                            <!-- Desktop Layout -->
                            <div class="hidden md:grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                    </div>

                            <!-- Mobile Layout - Simplified -->
                            <div class="md:hidden mobile-transaction-item" data-transaction-id="history2">
                                <div class="mobile-transaction-icon transaction-icon-mobile" style="background-color: #e0f2fe;">
                                    <span class="transaction-icon-text-mobile" style="color: #0369a1; font-size: 18px;">₦</span>
                                        </div>
                                <div class="mobile-transaction-content">
                                    <div class="mobile-transaction-description transaction-description"></div>
                                    <div class="mobile-transaction-time transaction-time-mobile"></div>
                                        </div>
                                <div class="mobile-transaction-amount transaction-amount-mobile"></div>
                            </div>
                    </div>

                        <div id="history4" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                    </div>

                        <div id="history5" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                    </div>

                        <div id="history6" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                    </div>

                        <div id="history7" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                    </div>

                        <!-- Additional Visible Transaction History Entries (8-10) -->
                        <div id="history8" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>

                        <div id="history9" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>

                        <div id="history10" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden Transaction History Entries (11-20) -->
                        <div id="history11" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300 hidden">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Continue with history12-20 (similar structure) -->
                        <div id="history12" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300 hidden">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Add remaining entries (13-20) with same structure -->
                        <div id="history13" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300 hidden">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>

                        <div id="history14" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300 hidden">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>

                        <div id="history15" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300 hidden">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>

                        <div id="history16" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300 hidden">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>

                        <div id="history17" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300 hidden">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>

                        <div id="history18" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300 hidden">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>

                        <div id="history19" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300 hidden">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>

                        <div id="history20" class="transaction-entry bg-white border border-gray-100 rounded-xl p-6 hover:shadow-lg hover:border-gray-200 transition-all duration-300 hidden">
                            <div class="grid grid-cols-12 gap-4 items-center">
                                <div class="col-span-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-exchange-alt text-gray-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900 text-sm transaction-description"></p>
                                            <p class="text-gray-500 text-xs transaction-recipient"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <span class="transaction-type px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium"></span>
                                </div>
                                <div class="col-span-2">
                                    <p class="font-semibold text-gray-900 transaction-amount"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-600 text-sm transaction-date"></p>
                                </div>
                                <div class="col-span-2">
                                    <p class="text-gray-500 text-xs font-mono transaction-reference"></p>
                                </div>
                                <div class="col-span-1">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- See More / See Less Controls -->
                    <div class="flex items-center justify-center gap-3 mt-12 mb-6 pt-4">
                        <button id="see-more" class="group relative inline-flex items-center justify-center px-8 py-3.5 text-base font-semibold text-white rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300 ease-out focus:outline-none focus:ring-2 focus:ring-offset-2 hidden" style="background-color: #1800ac;" onmouseover="this.style.backgroundColor='#140099'" onmouseout="this.style.backgroundColor='#1800ac'" onfocus="this.style.outlineColor='#1800ac'">
                            <span class="absolute inset-0 w-full h-full bg-gray-800 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
                            <i class="fas fa-chevron-down mr-2 relative z-10 transform group-hover:translate-y-0.5 transition-transform duration-300"></i>
                            <span class="relative z-10">Load More Transactions</span>
                        </button>
                        <button id="see-less" class="group inline-flex items-center justify-center px-8 py-3.5 text-base font-semibold text-gray-700 bg-white border-2 border-gray-300 rounded-xl shadow-md hover:shadow-lg hover:border-gray-400 transform hover:-translate-y-0.5 transition-all duration-300 ease-out focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 hidden">
                            <i class="fas fa-chevron-up mr-2 transform group-hover:-translate-y-0.5 transition-transform duration-300"></i>
                            <span>Show Less</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Add a horizontal line here -->
            <hr class="my-4 border-gray-400">

            <!-- Pending Transactions Card -->
            <div class="bg-white rounded-2xl overflow-hidden w-full mb-8">
                <!-- Header Section -->
                <div class="bg-white px-6 py-5 border-b border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-xl font-semibold text-gray-900">Pending Transactions</h2>
                            <p class="text-gray-500 text-sm mt-1">Transactions awaiting processing</p>
                        </div>
                    </div>
                </div>

                <!-- Content Section -->
                <div class="p-6">
                    <div id="pending-list" class="space-y-1">
                        <div id="pending1" class="bg-white border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 rounded-full flex items-center justify-center pending-avatar bg-orange-50 text-orange-700 font-semibold text-sm">
                                        <span class="pending-avatar-text">PN</span>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900 pending-description"></h3>
                                        <p class="text-sm text-gray-500 pending-recipient"></p>
                                        <p class="text-xs text-gray-400 mt-1">
                                            <span class="pending-type"></span> • 
                                            <span class="pending-date"></span>
                                        </p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold text-gray-900 pending-amount"></p>
                                    <p class="text-xs text-orange-600 font-medium">Pending</p>
                                </div>
                            </div>
                    </div>
                    
                        <div id="pending2" class="bg-white border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-all duration-200 hidden">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 rounded-full flex items-center justify-center pending-avatar bg-orange-50 text-orange-700 font-semibold text-sm">
                                        <span class="pending-avatar-text">PN</span>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900 pending-description"></h3>
                                        <p class="text-sm text-gray-500 pending-recipient"></p>
                                        <p class="text-xs text-gray-400 mt-1">
                                            <span class="pending-type"></span> • 
                                            <span class="pending-date"></span>
                                        </p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold text-gray-900 pending-amount"></p>
                                    <p class="text-xs text-orange-600 font-medium">Pending</p>
                                </div>
                            </div>
                    </div>
                    
                        <div id="pending3" class="bg-white border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-all duration-200 hidden">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 rounded-full flex items-center justify-center pending-avatar bg-orange-50 text-orange-700 font-semibold text-sm">
                                        <span class="pending-avatar-text">PN</span>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900 pending-description"></h3>
                                        <p class="text-sm text-gray-500 pending-recipient"></p>
                                        <p class="text-xs text-gray-400 mt-1">
                                            <span class="pending-type"></span> • 
                                            <span class="pending-date"></span>
                                        </p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold text-gray-900 pending-amount"></p>
                                    <p class="text-xs text-orange-600 font-medium">Pending</p>
                                </div>
                            </div>
                    </div>
                    
                        <div id="pending4" class="bg-white border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-all duration-200 hidden">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 rounded-full flex items-center justify-center pending-avatar bg-orange-50 text-orange-700 font-semibold text-sm">
                                        <span class="pending-avatar-text">PN</span>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900 pending-description"></h3>
                                        <p class="text-sm text-gray-500 pending-recipient"></p>
                                        <p class="text-xs text-gray-400 mt-1">
                                            <span class="pending-type"></span> • 
                                            <span class="pending-date"></span>
                                        </p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold text-gray-900 pending-amount"></p>
                                    <p class="text-xs text-orange-600 font-medium">Pending</p>
                                </div>
                            </div>
                    </div>
                    
                        <div id="pending5" class="bg-white border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-all duration-200 hidden">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 rounded-full flex items-center justify-center pending-avatar bg-orange-50 text-orange-700 font-semibold text-sm">
                                        <span class="pending-avatar-text">PN</span>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900 pending-description"></h3>
                                        <p class="text-sm text-gray-500 pending-recipient"></p>
                                        <p class="text-xs text-gray-400 mt-1">
                                            <span class="pending-type"></span> • 
                                            <span class="pending-date"></span>
                                        </p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold text-gray-900 pending-amount"></p>
                                    <p class="text-xs text-orange-600 font-medium">Pending</p>
                                </div>
                            </div>
                    </div>
                    
                        <div id="pending-limit-notice" class="bg-orange-50 border border-orange-200 rounded-lg p-4 hidden">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-exclamation-triangle text-orange-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-orange-800">Maximum Pending Transactions Reached</h3>
                                    <p class="text-sm text-orange-700 mt-1">This transaction has been queued as you have 5 pending transactions already.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        

<!-- Additional transaction items would go here -->
</div>
</section>

<section class="notifications-section mt-4 mb-32"> <!-- Reduced top margin -->
    <div class="section-header flex items-center justify-between">
        <h2 class="section-title text-xl font-semibold">Notifications</h2>
        <img src="bell.png" alt="Notification Icon" class="w-6 h-6 border-b-2 border-gray-200 rounded-full">
    </div>
    
    <div class="notification-item mt-4">
        <div class="notification-icon">
            <i class="fas fa-shield-alt"></i>
        </div>
        <div class="notification-content">
            <h3 class="notification-title">Security Alert</h3>
            <p class="notification-message">Your security is our priority. Please keep your account details confidential at all times.</p>
            <span class="notification-time">Today</span>
        </div>
    </div>
    
    <div class="notification-item mt-4">
        <div class="notification-icon">
            <i class="fas fa-bell"></i>
        </div>
        <div class="notification-content">
            <h3 class="notification-title">Welcome to Finance</h3>
            <p class="notification-message">Thank you for choosing our financial services. Explore our features to make the most of your account.</p>
            <span class="notification-time">1 day ago</span>
        </div>
    </div>
    
    <!-- System Update Notification -->
    <div class="notification-item mt-4">
        <div class="notification-icon">
            <i class="fas fa-sync-alt"></i>
        </div>
        <div class="notification-content">
            <h3 class="notification-title">System Update Available</h3>
            <p class="notification-message">We've released new features and security enhancements. Your financial experience has been improved with faster transaction processing and enhanced security measures.</p>
            <span class="notification-time">2 days ago</span>
        </div>
    </div>
    
    <!-- System Upgrade Notification -->
    <div class="notification-item mt-4">
        <div class="notification-icon">
            <i class="fas fa-rocket"></i>
        </div>
        <div class="notification-content">
            <h3 class="notification-title">Platform Upgrade Completed</h3>
            <p class="notification-message">Our platform has been upgraded with improved performance, new security protocols, and enhanced user interface. Enjoy a smoother financial experience!</p>
            <span class="notification-time">3 days ago</span>
        </div>
    </div>
    
    <!-- KYC Update Notification (Dynamic) -->
    <div id="kycNotification" class="notification-item mt-4" style="display: none;">
        <div class="notification-icon">
            <i class="fas fa-user-check"></i>
        </div>
        <div class="notification-content">
            <h3 class="notification-title" id="kycNotificationTitle">KYC Verification Update</h3>
            <p class="notification-message" id="kycNotificationMessage">Your KYC verification status has been updated.</p>
            <span class="notification-time" id="kycNotificationTime">Recently</span>
        </div>
    </div>
</section>
</div>



            <script>
                // Toggle balance visibility functions
                document.addEventListener('DOMContentLoaded', function() {
                    // Checking account toggle
                    const toggleChecking = document.getElementById('toggle-checking');
                    if (toggleChecking) {
                        toggleChecking.addEventListener('click', function() {
                    const balance = document.getElementById('checking');
                    const icon = this.querySelector('i');
                    
                            if (balance && balance.classList.contains('hide-balance')) {
                        balance.classList.remove('hide-balance');
                        icon.className = 'fas fa-eye';
                            } else if (balance) {
                        balance.classList.add('hide-balance');
                        icon.className = 'fas fa-eye-slash';
                    }
                });
                    }
                    
                    // Savings account toggle
                    const toggleSavings = document.getElementById('toggle-savings');
                    if (toggleSavings) {
                        toggleSavings.addEventListener('click', function() {
                            const balance = document.getElementById('savings');
                    const icon = this.querySelector('i');
                    
                            if (balance && balance.classList.contains('hide-balance')) {
                        balance.classList.remove('hide-balance');
                        icon.className = 'fas fa-eye';
                            } else if (balance) {
                        balance.classList.add('hide-balance');
                        icon.className = 'fas fa-eye-slash';
                    }
                });
                    }
                    
                    // Fixed account toggle
                    const toggleFixed = document.getElementById('toggle-fixed');
                    if (toggleFixed) {
                        toggleFixed.addEventListener('click', function() {
                            const balance = document.getElementById('fixed');
                    const icon = this.querySelector('i');
                    
                            if (balance && balance.classList.contains('hide-balance')) {
                        balance.classList.remove('hide-balance');
                        icon.className = 'fas fa-eye';
                            } else if (balance) {
                        balance.classList.add('hide-balance');
                        icon.className = 'fas fa-eye-slash';
                            }
                        });
                    }
                });
                
                
                // Navigation with spinner function (placeholder)
                function navigateWithSpinner(url) {
                    // Implementation would go here
                    console.log("Navigating to: " + url);
                }
            </script>

            <script>
                // ACH Modal Controls
                function openAchModal() {
                    const modal = document.getElementById('achModal');
                    if (modal) {
                        modal.classList.remove('hidden');
                        // Prevent background scroll on mobile
                        document.body.style.overflow = 'hidden';
                    }
                }
                function closeAchModal() {
                    const modal = document.getElementById('achModal');
                    if (modal) {
                        modal.classList.add('hidden');
                        document.body.style.overflow = '';
                    }
                }

                function closeAchSubmittedModal() {
                    const modal = document.getElementById('achSubmittedModal');
                    if (modal) {
                        modal.classList.add('hidden');
                        document.body.style.overflow = '';
                    }
                }

                // Routing number checksum validation (ABA mod 10 algorithm)
                function isValidRoutingNumber(routing) {
                    if (!/^\d{9}$/.test(routing)) return false;
                    const weights = [3, 7, 1, 3, 7, 1, 3, 7, 1];
                    let sum = 0;
                    for (let i = 0; i < 9; i++) {
                        sum += parseInt(routing[i], 10) * weights[i];
                    }
                    return sum % 10 === 0;
                }

                function formatCurrency(value) {
                    const num = parseFloat((value || '').toString().replace(/[^0-9.]/g, ''));
                    if (isNaN(num) || num <= 0) return '';
                    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(num);
                }

                async function submitAchRequest() {
                    const funding = document.getElementById('achFundingSource');
                    const recipient = document.getElementById('achRecipientName');
                    const routing = document.getElementById('achRoutingNumber');
                    const account = document.getElementById('achAccountNumber');
                    const acctType = document.getElementById('achAccountType');
                    const amountEl = document.getElementById('achAmount');
                    const memo = document.getElementById('achMemo');
                    const authorize = document.getElementById('achAuthorize');
                    const confirmDetails = document.getElementById('achConfirmDetails');

                    // Reset errors
                    ['achFundingSourceError','achRecipientNameError','achRoutingNumberError','achAccountNumberError','achAmountError','achConsentError']
                        .forEach(id => document.getElementById(id).classList.add('hidden'));

                    let valid = true;
                    if (!funding.value) { document.getElementById('achFundingSourceError').classList.remove('hidden'); valid = false; }
                    if (!recipient.value.trim()) { document.getElementById('achRecipientNameError').classList.remove('hidden'); valid = false; }
                    const routingVal = (routing.value || '').replace(/[^0-9]/g, '');
                    if (!isValidRoutingNumber(routingVal)) { document.getElementById('achRoutingNumberError').classList.remove('hidden'); valid = false; }
                    if (!account.value.trim()) { document.getElementById('achAccountNumberError').classList.remove('hidden'); valid = false; }
                    const rawAmount = parseFloat((amountEl.value || '').toString().replace(/[^0-9.]/g, ''));
                    if (!rawAmount || rawAmount <= 0) { document.getElementById('achAmountError').classList.remove('hidden'); valid = false; }
                    if (!authorize.checked || !confirmDetails.checked) { document.getElementById('achConsentError').classList.remove('hidden'); valid = false; }
                    if (!valid) return;

                    const formattedAmount = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(rawAmount);
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('en-US', { hour12: true, hour: '2-digit', minute: '2-digit' });
                    const dateString = now.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' });

                    const achDescriptor = `ACH Transfer | ${recipient.value.trim()} | ${formattedAmount} | ${timeString} | ${dateString} | Pending Approval`;

                    try {
                        // Show loading state
                        const submitBtn = document.getElementById('achSubmitBtn');
                        const spinner = document.getElementById('spinner');
                        if (submitBtn) {
                            submitBtn.disabled = true;
                            submitBtn.textContent = 'Submitting...';
                        }
                        if (spinner) spinner.classList.remove('hidden');

                        // Prefer modular SDK if available
                        if (window.firebase && window.firebase.auth && window.firebase.firestore) {
                            const user = firebase.auth().currentUser;
                            if (!user) throw new Error('Not signed in');
                            const dbv8 = firebase.firestore();
                            await dbv8.collection('ach_requests').add({
                                userId: user.uid,
                                recipient: recipient.value.trim(),
                                routingNumber: routingVal,
                                accountNumber: account.value.trim(),
                                accountType: acctType.value,
                                fundingSource: funding.value,
                                amount: rawAmount,
                                memo: memo.value.trim() || '',
                                status: 'pending',
                                createdAt: new Date(),
                                descriptor: achDescriptor
                            });
                        } else if (window.getAuth && window.getFirestore) {
                            // Fallback to v9 imports already in this page
                            const user = auth.currentUser;
                            if (!user) throw new Error('Not signed in');
                            await addDoc(collection(db, 'ach_requests'), {
                                userId: user.uid,
                                recipient: recipient.value.trim(),
                                routingNumber: routingVal,
                                accountNumber: account.value.trim(),
                                accountType: acctType.value,
                                fundingSource: funding.value,
                                amount: rawAmount,
                                memo: memo.value.trim() || '',
                                status: 'pending',
                                createdAt: serverTimestamp(),
                                descriptor: achDescriptor
                            });
                        }

                        // Also reflect in user's pending slots if available
                        try {
                            const userMod = auth.currentUser;
                            if (userMod) {
                                const userRef = doc(db, 'users', userMod.uid);
                                const userSnap = await getDoc(userRef);
                                if (userSnap.exists()) {
                                    const data = userSnap.data();
                                    const slots = ['pending1','pending2','pending3'];
                                    const updateData = {};
                                    let placed = false;
                                    for (const slot of slots) {
                                        if (!data[slot]) { updateData[slot] = achDescriptor; placed = true; break; }
                                    }
                                    if (placed) { await updateDoc(userRef, updateData); }
                                }
                            }
                        } catch (e) {
                            console.warn('Could not update pending slots:', e);
                        }

                        // Small delay to let UI show spinner smoothly
                        await new Promise(r => setTimeout(r, 600));
                        if (spinner) spinner.classList.add('hidden');
                        closeAchModal();
                        const submitted = document.getElementById('achSubmittedModal');
                        if (submitted) submitted.classList.remove('hidden');
                    } catch (err) {
                        console.error('ACH submit error:', err);
                        alert('Failed to submit ACH for approval. Please try again.');
                    } finally {
                        const submitBtn = document.getElementById('achSubmitBtn');
                        if (submitBtn) {
                            submitBtn.disabled = false;
                            submitBtn.textContent = 'Submit for Approval';
                        }
                    }
                }
            </script>

            <script>
            let originalBalance = '$0.00'; // Initialize with the actual wallet value

            function toggleBalance() {
                const wallet = document.getElementById('wallet');
                const Deposit = document.getElementById('checking');
                const toggleIcon = document.getElementById('toggle-icon');

                if (wallet.textContent === '****') {
                    wallet.textContent = originalBalance; // Restore original balance
                    toggleIcon.className = 'fas fa-eye'; // Eye icon
                } else {
                    originalBalance = wallet.textContent; // Store the current balance
                    wallet.textContent = '****'; // Mask the balance
                    toggleIcon.className = 'fas fa-eye-slash'; // Eye-slash icon
                }
            }
            </script>                    

            <script>
                // Colorization functions removed to prevent infinite loops and performance issues
                // The MutationObserver was causing an infinite loop: it watched for DOM changes,
                // the colorization functions modified the DOM, which triggered the observer again.
            </script>

            <script>
                // REMOVED: Duplicate onAuthStateChanged listener for pending transactions
                // Pending transactions are already loaded in the main onAuthStateChanged listener above
                
                // Fixed function to add a new pending transaction with a specific ID
                window.addPendingTransaction = async function(transferDetails) {
                    return new Promise((resolve, reject) => {
                        // Use the main auth instance instead of duplicate listener
                        const user = auth.currentUser;
                        if (!user) {
                            reject(new Error('User not authenticated'));
                            return;
                        }
                        
                        (async () => {
                            try {
                                // Get current user data from Firestore to check pending fields
                                const userDocRef = doc(window.db, 'users', user.uid);
                                const userDoc = await getDoc(userDocRef);
                                
                                if (!userDoc.exists()) {
                                    throw new Error("User account not found");
                                }
                                
                                const userData = userDoc.data();
                                
                                // Track which slots are already used
                                let usedSlots = {
                                    pending1: !!userData.pending1 && userData.pending1.trim() !== '',
                                    pending2: !!userData.pending2 && userData.pending2.trim() !== '',
                                    pending3: !!userData.pending3 && userData.pending3.trim() !== ''
                                };
                                
                                // Find the first available slot
                                let nextPendingId = null;
                                if (!usedSlots.pending1) nextPendingId = 'pending1';
                                else if (!usedSlots.pending2) nextPendingId = 'pending2';
                                else if (!usedSlots.pending3) nextPendingId = 'pending3';
                                
                                // Check if all slots are used
                                if (!nextPendingId) {
                                    // Show the limit notice
                                    document.getElementById('pending-limit-notice').classList.remove('hidden');
                                    
                                    resolve({
                                        success: false,
                                        message: 'Maximum pending transactions reached. This transaction has been queued.'
                                    });
                                    return;
                                }
                                
                                // Format the transfer data with consistent formatting 
                                const transferString = `${transferDetails.description || 'Transfer'} | Transfer-${transferDetails.type || 'Intl'} | ${transferDetails.amount || '$0.00'} | ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} | ${new Date().toLocaleDateString()} | Pending`;
                                
                                // Create the update data object with the right pending field
                                const updateData = {};
                                updateData[nextPendingId] = transferString;
                                
                                // Update the user document with the new pending transaction in the right slot
                                await updateDoc(userDocRef, updateData);
                                
                                // Also add to pending collection with pendingId field to preserve the slot
                                await addDoc(collection(window.db, 'pending'), {
                                    userId: user.uid,
                                    pendingId: nextPendingId,
                                    description: transferDetails.description || 'Transfer',
                                    amount: transferDetails.amount || '',
                                    date: new Date().toLocaleDateString(),
                                    time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                                    reference: `Ref TRX${Math.floor(Math.random() * 10000000000)}`,
                                    status: 'pending',
                                    type: transferDetails.type || 'Intl',
                                    createdAt: serverTimestamp()
                                });
                                
                                // Refresh the page to show the new pending transaction
                                location.reload();
                                
                                resolve({
                                    success: true,
                                    message: 'Pending transaction created successfully.'
                                });
                            } catch (error) {
                                console.error('Error adding pending transaction:', error);
                                reject(error);
                            }
                        })();
                    });
                };
            </script>




            <!-- Bottom Navbar (Mobile Friendly) -->
            <div class="mobile-nav fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-gray-300 p-3" style="height: 100px; z-index: 100;">
                <div class="flex justify-around items-center h-full">
                    <!-- Home Icon -->
                    <a href="dashboard.html" class="nav-item flex flex-col items-center" data-page="dashboard">
                        <div class="bg-white rounded p-2">
                            <img src="1221.png" alt="Wallet Icon" class="h-6 w-6" />
                        </div>
                        <span class="text-xs font-medium mt-2 text-gray-700">Home</span>
                    </a>
                    <!-- Deposit Icon -->
                    <a href="deposit.html" class="nav-item flex flex-col items-center" data-page="deposit">
                        <div class="bg-white rounded p-2">
                            <img src="deposit.png" alt="Deposit Icon" class="h-6 w-6" />
                        </div>
                        <span class="text-xs font-medium mt-2 text-gray-700">Deposit</span>
                    </a>
                    <!-- Support Icon -->
                    <a href="support.html" class="nav-item flex flex-col items-center" data-page="support">
                        <div class="bg-white rounded p-2">
                            <img src="support.png" alt="Support Icon" class="h-6 w-6" />
                        </div>
                        <span class="text-xs font-medium mt-2 text-gray-700">Support</span>
                    </a>
                    <!-- Profile Icon -->
                    <a href="profile.html" class="nav-item flex flex-col items-center" data-page="profile">
                        <div class="bg-white rounded p-2">
                            <img src="profile.png" alt="Profile Icon" class="h-6 w-6" />
                        </div>
                        <span class="text-xs font-medium mt-2 text-gray-700">Profile</span>
                    </a>
                </div>
            </div>
            <script src="bottom-navbar.js"></script>

            <script>
                // Duplicate colorization function removed to prevent performance issues
            </script>

            <script>
                function navigateWithSpinner(url) {
                    // Show the spinner
                    document.getElementById('spinner').classList.remove('hidden');

                    // Simulate a delay for loading (e.g., 1 second)
                    setTimeout(() => {
                        // Navigate to the specified URL
                        window.location.href = url;
                    }, 1000); // Adjust the delay as needed
                }
            </script>

            <!-- Transaction History Filtering Script -->
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    // Store original transaction data
                    let originalTransactions = [];
                    let filteredTransactions = [];
                    let isExpanded = false;
                    
                    // Toggle filter section
                    const toggleFiltersBtn = document.getElementById('toggle-filters');
                    const filterSection = document.getElementById('filter-section');
                    
                    toggleFiltersBtn.addEventListener('click', function() {
                        filterSection.classList.toggle('hidden');
                    });
                    
                    // Collect all transaction data
                    function collectTransactionData() {
                        originalTransactions = [];
                        for (let i = 1; i <= 20; i++) {
                            const historyElement = document.getElementById(`history${i}`);
                            if (!historyElement) continue;

                            // Use text from populated fields instead of raw textContent to avoid false positives
                            const desc = historyElement.querySelector('.transaction-description')?.textContent?.trim() || '';
                            const recipient = historyElement.querySelector('.transaction-recipient')?.textContent?.trim() || '';
                            const amount = historyElement.querySelector('.transaction-amount')?.textContent?.trim() || '';
                            const date = historyElement.querySelector('.transaction-date')?.textContent?.trim() || '';

                            const hasAnyData = [desc, recipient, amount, date].some(v => v && v !== '-' && v.toLowerCase() !== 'no history available');
                            if (hasAnyData) {
                                const text = historyElement.textContent.trim();
                                originalTransactions.push({
                                    id: i,
                                    element: historyElement,
                                    text: text,
                                    originalDisplay: historyElement.style.display || 'block'
                                });
                            }
                        }
                        filteredTransactions = [...originalTransactions];
                        updateToggleButtons();
                    }
                    
                    // Parse transaction data for filtering
                    function parseTransactionData(transaction) {
                        const text = transaction.text;
                        const parts = text.split('|').map(part => part.trim());
                        
                        // Try to extract different components
                        let type = '';
                        let recipient = '';
                        let amount = '';
                        let time = '';
                        let date = '';
                        let reference = '';
                        let notes = '';
                        
                        // Common patterns for transaction parsing
                        if (parts.length > 0) type = parts[0];
                        if (parts.length > 1) recipient = parts[1];
                        if (parts.length > 2) amount = parts[2];
                        if (parts.length > 3) time = parts[3];
                        if (parts.length > 4) date = parts[4];
                        if (parts.length > 5) reference = parts[5];
                        if (parts.length > 6) notes = parts.slice(6).join('|');
                        
                        return {
                            type,
                            recipient,
                            amount,
                            time,
                            date,
                            reference,
                            notes,
                            fullText: text
                        };
                    }
                    
                    // Apply filters
                    function applyFilters() {
                        const dateFilter = document.getElementById('filter-date').value;
                        const idFilter = document.getElementById('filter-id').value.toLowerCase();
                        const amountFilter = document.getElementById('filter-amount').value;
                        const nameFilter = document.getElementById('filter-name').value.toLowerCase();
                        
                        // Hide all transactions first
                        for (let i = 1; i <= 20; i++) {
                            const element = document.getElementById(`history${i}`);
                            if (element) {
                                element.style.display = 'none';
                            }
                        }
                        
                        // Filter transactions
                        filteredTransactions = originalTransactions.filter(transaction => {
                            const parsed = parseTransactionData(transaction);
                            let matches = true;
                            
                            // Date filter
                            if (dateFilter && parsed.date) {
                                const transactionDate = new Date(parsed.date);
                                const filterDate = new Date(dateFilter);
                                matches = matches && transactionDate.toDateString() === filterDate.toDateString();
                            }
                            
                            // ID filter
                            if (idFilter && parsed.reference) {
                                matches = matches && parsed.reference.toLowerCase().includes(idFilter);
                            }
                            
                            // Amount filter
                            if (amountFilter && parsed.amount) {
                                const transactionAmount = parseFloat(parsed.amount.replace(/[$,]/g, ''));
                                const filterAmount = parseFloat(amountFilter);
                                matches = matches && Math.abs(transactionAmount - filterAmount) < 0.01;
                            }
                            
                            // Name filter
                            if (nameFilter) {
                                const searchText = (parsed.type + ' ' + parsed.recipient + ' ' + parsed.notes).toLowerCase();
                                matches = matches && searchText.includes(nameFilter);
                            }
                            
                            return matches;
                        });
                        
                        // Show only available filtered transactions
                        filteredTransactions.forEach((transaction, index) => {
                            if (index < 10) {
                                transaction.element.style.display = 'block';
                            } else {
                                transaction.element.style.display = 'none';
                            }
                        });
                        
                        // Update toggle buttons visibility
                        isExpanded = false;
                        updateToggleButtons();
                        
                        // Show "No results" message if no matches
                        if (filteredTransactions.length === 0) {
                            showNoResultsMessage();
                        } else {
                            hideNoResultsMessage();
                        }
                    }
                    
                    // Clear filters
                    function clearFilters() {
                        // Clear filter inputs
                        document.getElementById('filter-date').value = '';
                        document.getElementById('filter-id').value = '';
                        document.getElementById('filter-amount').value = '';
                        document.getElementById('filter-name').value = '';
                        
                        // Only show items that actually have data
                        for (let i = 1; i <= 20; i++) {
                            const element = document.getElementById(`history${i}`);
                            if (!element) continue;
                            const desc = element.querySelector('.transaction-description')?.textContent?.trim() || '';
                            const recipient = element.querySelector('.transaction-recipient')?.textContent?.trim() || '';
                            const amount = element.querySelector('.transaction-amount')?.textContent?.trim() || '';
                            const date = element.querySelector('.transaction-date')?.textContent?.trim() || '';
                            const hasAnyData = [desc, recipient, amount, date].some(v => v && v !== '-' && v.toLowerCase() !== 'no history available');
                            element.style.display = hasAnyData ? 'block' : 'none';
                        }
                        
                        // Reset filtered transactions
                        filteredTransactions = [...originalTransactions];
                        
                        // Update toggle buttons
                        isExpanded = false;
                        updateToggleButtons();
                        
                        hideNoResultsMessage();
                    }
                    
                    // Show no results message
                    function showNoResultsMessage() {
                        let noResultsMsg = document.getElementById('no-results-message');
                        if (!noResultsMsg) {
                            noResultsMsg = document.createElement('div');
                            noResultsMsg.id = 'no-results-message';
                            noResultsMsg.className = 'text-center py-8 text-gray-500';
                            noResultsMsg.innerHTML = '<i class="fas fa-search text-4xl mb-2"></i><p>No transactions found matching your filters.</p>';
                            
                            const historyContainer = document.querySelector('.flex.flex-col.space-y-3');
                            historyContainer.appendChild(noResultsMsg);
                        }
                        noResultsMsg.style.display = 'block';
                    }
                    
                    // Hide no results message
                    function hideNoResultsMessage() {
                        const noResultsMsg = document.getElementById('no-results-message');
                        if (noResultsMsg) {
                            noResultsMsg.style.display = 'none';
                        }
                    }
                    
                    // Event listeners
                    document.getElementById('apply-filters').addEventListener('click', applyFilters);
                    document.getElementById('clear-filters').addEventListener('click', clearFilters);
                    
                    // Allow Enter key to apply filters
                    const filterInputs = ['filter-date', 'filter-id', 'filter-amount', 'filter-name'];
                    filterInputs.forEach(inputId => {
                        document.getElementById(inputId).addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                applyFilters();
                            }
                        });
                    });
                    
                    // Initialize transaction data collection when the browser is idle to avoid blocking first paint.
                    // Keep a timeout so it still runs on busy devices.
                    if ('requestIdleCallback' in window) {
                        requestIdleCallback(() => collectTransactionData(), { timeout: 2500 });
                    } else {
                        setTimeout(() => collectTransactionData(), 2000);
                    }
                    
                    // Toggle helpers
                    function currentSource() {
                        // If there's no active filter or it produced zero results, fall back to original
                        if (!filteredTransactions || filteredTransactions.length === 0) {
                            return originalTransactions;
                        }
                        return (filteredTransactions.length !== originalTransactions.length)
                            ? filteredTransactions
                            : originalTransactions;
                    }

                    function updateToggleButtons() {
                        const seeMoreBtn = document.getElementById('see-more');
                        const seeLessBtn = document.getElementById('see-less');
                        const src = currentSource();
                        if (!seeMoreBtn || !seeLessBtn) return;

                        if (src.length > 10) {
                            if (isExpanded) {
                                seeMoreBtn.classList.add('hidden');
                                seeLessBtn.classList.remove('hidden');
                            } else {
                                seeMoreBtn.classList.remove('hidden');
                                seeLessBtn.classList.add('hidden');
                            }
                        } else {
                            seeMoreBtn.classList.add('hidden');
                            seeLessBtn.classList.add('hidden');
                        }
                    }

                    function showFirstTen() {
                        let src = currentSource();
                        if (!src || src.length === 0) {
                            // Refresh from DOM if needed
                            collectTransactionData();
                            src = currentSource();
                        }
                        for (let i = 1; i <= 20; i++) {
                            const el = document.getElementById(`history${i}`);
                            if (el) el.style.display = 'none';
                        }
                        src.slice(0, 10).forEach(t => t.element.style.display = 'block');
                        isExpanded = false;
                        updateToggleButtons();
                    }

                    function showAll() {
                        let src = currentSource();
                        if (!src || src.length === 0) {
                            // Refresh from DOM if needed
                            collectTransactionData();
                            src = currentSource();
                        }
                        // Only show items that exist in the source (no empty columns)
                        for (let i = 1; i <= 20; i++) {
                            const el = document.getElementById(`history${i}`);
                            if (el) el.style.display = 'none';
                        }
                        src.forEach(t => t.element.style.display = 'block');
                        isExpanded = true;
                        updateToggleButtons();
                    }

                    // Wire buttons
                    const seeMoreBtn = document.getElementById('see-more');
                    const seeLessBtn = document.getElementById('see-less');
                    if (seeMoreBtn) seeMoreBtn.addEventListener('click', showAll);
                    if (seeLessBtn) seeLessBtn.addEventListener('click', showFirstTen);

                    // Function to create clean, modern transaction entries
                    function createCleanTransactionEntries() {
                        for (let i = 1; i <= 20; i++) {
                            const historyElement = document.getElementById(`history${i}`);
                            if (historyElement) {
                                // Replace the entire content with a clean design
                                historyElement.className = 'transaction-entry bg-white border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-all duration-200';
                                historyElement.innerHTML = `
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 rounded-full flex items-center justify-center transaction-avatar bg-blue-50 text-blue-700 font-semibold text-sm">
                                                <span class="transaction-avatar-text">TX</span>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-900 transaction-description"></h3>
                                                <p class="text-sm text-gray-500 transaction-recipient"></p>
                                                <p class="text-xs text-gray-400 mt-1 meta-row hidden">
                                                    <span class="transaction-type"></span>
                                                    <span class="mx-1 separator">•</span>
                                                    <span class="transaction-date"></span>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="font-semibold text-gray-900 transaction-amount"></p>
                                            <p class="text-xs text-gray-500 font-mono transaction-reference"></p>
                                        </div>
                                    </div>
                                `;
                            }
                        }
                    }
                    
                    // Create clean transaction entries
                    createCleanTransactionEntries();
                });
            </script>

            <!-- Spinner -->
            <div id="spinner" class="hidden fixed inset-0 flex items-center justify-center" style="background-color: rgba(24, 0, 172, 0.5);">
                <div class="smart-spinner"></div>
            </div>
        </div>
    </div>

    <!-- Loan Application Progress Modal -->
    <div id="loanProgressModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4" style="background-color: rgba(24, 0, 172, 0.5);">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 md:p-8">
            <div class="text-center">
                <div id="loanProgressIcon" class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-spinner fa-spin text-blue-600 text-3xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-2" id="loanProgressTitle">Loan Application Under Review</h3>
                <p class="text-gray-600 mb-4" id="loanProgressMessage">
                    Your loan application is being reviewed by our team. You will be notified once a decision has been made.
                </p>
                <div class="bg-gray-100 rounded-lg p-4 mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-600">Loan Amount:</span>
                        <span class="text-sm font-semibold text-gray-900" id="loanProgressAmount">$0.00</span>
                    </div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-600">Status:</span>
                        <span class="text-sm font-semibold" id="loanProgressStatus">Pending</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Submitted:</span>
                        <span class="text-sm text-gray-900" id="loanProgressDate">-</span>
                    </div>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                    <div id="loanProgressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 50%"></div>
                </div>
                <button 
                    onclick="closeLoanProgressModal()" 
                    class="w-full text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200"
                    style="background-color: #1800ac;"
                    onmouseover="this.style.backgroundColor='#140099'"
                    onmouseout="this.style.backgroundColor='#1800ac'"
                >
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Loan Application Status Badge (Floating) -->
    <div id="loanStatusBadge" class="hidden fixed bottom-24 right-6 z-40">
        <button 
            onclick="openLoanProgressModal()"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 transition-all duration-200"
        >
            <i class="fas fa-file-invoice-dollar"></i>
            <div class="text-left">
                <div class="text-xs font-semibold">Loan Application</div>
                <div class="text-xs opacity-90" id="loanStatusBadgeText">Under Review</div>
            </div>
            <i class="fas fa-chevron-right ml-2"></i>
        </button>
    </div>

    <!-- Inactivity Timeout: Auto-logout after 5 minutes of inactivity -->
    <script src="inactivity-timeout.js"></script>

    <!-- Card application functionality removed -->
</body>
</html>