import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as w,d as k,g as M,c as z,b as j}from"./firebase-client-DudADU2j.js";import{onAuthStateChanged as A,signOut as O}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";import{deleteDoc as W,setDoc as D,updateDoc as H,getDoc as U,doc as F,serverTimestamp as K,collection as V,addDoc as X}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";import"./firebase-config-CJaibweW.js";import"https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";window.auth=w;window.db=k;window.firestoreHelpers={addDoc:X,collection:V,serverTimestamp:K,doc:F,getDoc:U,updateDoc:H,setDoc:D,deleteDoc:W};function G(e){try{let n=document.getElementById("firebaseStatusBanner");n||(n=document.createElement("div"),n.id="firebaseStatusBanner",n.className="fixed top-0 left-0 right-0 z-50 bg-red-600 text-white text-sm px-4 py-3 shadow-lg",document.body.appendChild(n)),n.textContent=e}catch{}}window.addEventListener("unhandledrejection",e=>{var i;const n=((i=e==null?void 0:e.reason)==null?void 0:i.message)||String((e==null?void 0:e.reason)||"");(n.includes("auth/internal-error")||n.includes("Could not reach Cloud Firestore backend"))&&G("Connection issue: Firebase could not be reached (offline/VPN/adblock). Please check your internet connection and try again.")});document.addEventListener("DOMContentLoaded",()=>{const e=M(),n=document.getElementById("user-first-name");if(e&&n&&!n.textContent.trim())try{Y(e)}catch{}},{passive:!0});function P(e,n){const i=n.split("|").map(g=>g.trim()),t=i[0]||"",o=i[1]||"",c=i[2]||"",s=i[3]||"",r=i[4]||"",a=i[5]||"",f=i.slice(6).join("|")||"";e.dataset.transactionType=t,e.dataset.transactionRecipient=o,e.dataset.transactionAmount=c,e.dataset.transactionTime=s,e.dataset.transactionDate=r,e.dataset.transactionReference=a,e.dataset.transactionNotes=f;const y=e.querySelector(".transaction-description"),p=e.querySelector(".transaction-recipient"),l=e.querySelector(".transaction-type"),m=e.querySelector(".transaction-amount"),d=e.querySelector(".transaction-date"),u=e.querySelector(".transaction-reference"),E=e.querySelector(".meta-row"),S=e.querySelector(".separator"),v=e.querySelector(".transaction-avatar"),N=e.querySelector(".transaction-avatar-text");y&&(y.textContent=t),p&&(p.textContent=o),l&&(l.textContent=t),m&&(m.textContent=c),d&&(d.textContent=r),u&&(u.textContent=a);const B=e.querySelector(".mobile-transaction-item");if(B){const g=B.querySelector(".mobile-transaction-description"),h=B.querySelector(".mobile-transaction-time"),b=B.querySelector(".mobile-transaction-amount"),C=B.querySelector(".mobile-transaction-icon"),x=B.querySelector(".transaction-icon-text-mobile");if(g&&(g.textContent=t||o||"Transaction"),h&&(h.textContent=s||r||"-"),b){b.textContent=c||"-";const I=c&&(c.startsWith("+")||c.includes("credit")||c.includes("deposit"));b.className="mobile-transaction-amount transaction-amount-mobile "+(I?"credit":"debit")}if(C&&x){const I=(t||"").toLowerCase();I.includes("cashback")||I.includes("refund")?(C.style.backgroundColor="#e0f2fe",x.textContent="₦",x.style.color="#0369a1"):I.includes("mtn")||I.includes("data")?(C.style.backgroundColor="#fef3c7",x.textContent="MTN",x.style.fontSize="10px",x.style.color="#1e40af"):I.includes("savings")||I.includes("deposit")?(C.style.backgroundColor="#ede9fe",x.textContent="K.",x.style.fontSize="12px",x.style.color="#7c3aed"):(C.style.backgroundColor="#e0f2fe",x.textContent="₦",x.style.color="#0369a1")}}if(E){const g=!!t&&t!=="-",h=!!r&&r!=="-";g||h?(E.classList.remove("hidden"),S&&(g&&h?S.classList.remove("hidden"):S.classList.add("hidden"))):E.classList.add("hidden")}if(v&&N){const g=(t||"").toLowerCase();let h="TX",b="bg-blue-50",C="text-blue-700";g.includes("deposit")?(h="DP",b="bg-green-50",C="text-green-700"):g.includes("transfer")?(h="TF",b="bg-indigo-50",C="text-indigo-700"):g.includes("refund")?(h="RF",b="bg-amber-50",C="text-amber-700"):g.includes("reversal")&&(h="RV",b="bg-rose-50",C="text-rose-700"),N.textContent=h,v.className="w-12 h-12 rounded-full flex items-center justify-center transaction-avatar font-semibold text-sm "+b+" "+C}}function J(e){const n=document.getElementById("transactionDetailModal");if(!n||!e)return;const i=e.dataset.transactionType||"",t=e.dataset.transactionRecipient||"",o=e.dataset.transactionAmount||"",c=e.dataset.transactionTime||"",s=e.dataset.transactionDate||"",r=e.dataset.transactionReference||"",a=e.dataset.transactionNotes||"";let f=s;s&&c?f=`On ${s} at ${c}`:s?f=s:c&&(f=c);const y=o&&(o.startsWith("+")||o.includes("credit")||o.includes("deposit"));document.getElementById("detail-amount").textContent=o||"₦0.00",document.getElementById("detail-amount").className="transaction-detail-amount"+(y?" credit":""),document.getElementById("detail-type").textContent=(i||t||"Transaction").toUpperCase(),document.getElementById("detail-date").textContent=f||"-",document.getElementById("detail-description").textContent=a||i||t||"-",document.getElementById("detail-method").textContent=i||"-",document.getElementById("detail-reference").textContent=r||"-",document.getElementById("detail-from").textContent=t||"Kuda";const p=(i||"").toLowerCase();let l="Savings";p.includes("cashback")?l="Cashback":p.includes("mtn")||p.includes("data")?l="Data":p.includes("savings")&&(l="Savings"),document.getElementById("detail-category").textContent=l,window.innerWidth<768&&(n.classList.add("active"),document.body.style.overflow="hidden")}function T(e){if(window.innerWidth>=768)return;const n=e.target.closest(".mobile-transaction-item");if(!n)return;const i=n.dataset.transactionId;if(!i)return;const t=document.getElementById(i);t&&t.dataset.transactionType&&t.dataset.transactionType!==""&&(e.preventDefault(),e.stopPropagation(),J(t))}let L=!1,q=null;A(w,async e=>{if(q&&(clearTimeout(q),q=null),e){L=!0,console.log("User is logged in:",e.uid);const n=document.querySelectorAll(".accounts-section, #history-container");n.forEach(i=>{i&&(i.style.opacity="0.6")}),await Q(e),n.forEach(i=>{i&&(i.style.opacity="1")})}else L||(await new Promise(n=>setTimeout(n,500)),L=!0),q=setTimeout(()=>{w.currentUser||(console.log("No user signed in. Redirecting to sign-in page."),z(),window.location.href="login.html")},1e3)});async function Q(e){const n=F(k,"users",e.uid),i=await U(n);if(i.exists()){const t=i.data();j(t),document.getElementById("Deposit-account").textContent=`${t.deposit||"$0.00"}`,document.getElementById("savings").textContent=`${t.savings||"$0.00"}`,document.getElementById("fixed").textContent=`${t.fixed||"$0.00"}`;const o=document.getElementById("user-first-name");t.firstName&&t.firstName.trim()!==""?o.textContent=t.firstName:(o.textContent="",console.log("User data does not contain a valid name field."));const c=document.getElementById("cardholder-name"),s=document.getElementById("modal-cardholder-name");let r="";t.firstName&&t.lastName?r=`${t.firstName.toUpperCase()} ${t.lastName.toUpperCase()}`:t.firstName&&(r=t.firstName.toUpperCase()),r&&(c&&(c.textContent=r),s&&(s.textContent=r)),setTimeout(()=>{let a=!1,f=0;for(let l=1;l<=20;l++){const m=document.getElementById(`history${l}`);if(m){const d=t[`history${l}`]||"";if(d&&d.trim()!==""){if(P(m,d),f<10){m.style.display="block";const u=m.querySelector(".mobile-transaction-item");u&&(u.style.display="flex"),f++}else{m.style.display="none";const u=m.querySelector(".mobile-transaction-item");u&&(u.style.display="none")}l>10&&(a=!0)}else{m.style.display="none";const u=m.querySelector(".mobile-transaction-item");u&&(u.style.display="none")}}}const y=document.getElementById("see-more");y&&(a?y.classList.remove("hidden"):y.classList.add("hidden"));const p=document.getElementById("recent-transactions");p&&(p.removeEventListener("click",T),p.addEventListener("click",T,{passive:!0}))},100),setTimeout(()=>{const a=document.getElementById("pending1"),f=document.getElementById("pending2"),y=document.getElementById("pending3"),p=document.getElementById("pending-list");function l(d,u){const E=u.split("|").map(R=>R.trim()),S=E[0]||"",v=E[1]||"",N=E[2]||"";E[3];const B=E[4]||"";E[5];const g=d.querySelector(".pending-description"),h=d.querySelector(".pending-recipient"),b=d.querySelector(".pending-type"),C=d.querySelector(".pending-amount"),x=d.querySelector(".pending-date"),I=d.querySelector(".pending-avatar"),$=d.querySelector(".pending-avatar-text");g&&(g.textContent=S),h&&(h.textContent=v),b&&(b.textContent=S),C&&(C.textContent=N),x&&(x.textContent=B),I&&$&&($.textContent="PN",I.className="w-12 h-12 rounded-full flex items-center justify-center pending-avatar font-semibold text-sm bg-orange-50 text-orange-700")}function m(d){!p||!d||p.appendChild(d)}t.pending1&&t.pending1.trim()!==""&&(a.classList.remove("hidden"),l(a,t.pending1),m(a)),t.pending2&&t.pending2.trim()!==""&&(f.classList.remove("hidden"),l(f,t.pending2),m(f)),t.pending3&&t.pending3.trim()!==""&&(y.classList.remove("hidden"),l(y,t.pending3),m(y)),t.pending1&&t.pending2&&t.pending3&&t.pending1.trim()!==""&&t.pending2.trim()!==""&&t.pending3.trim()!==""?document.getElementById("pending-limit-notice").classList.remove("hidden"):document.getElementById("pending-limit-notice").classList.add("hidden")},200)}else console.log("No user document found in Firestore."),alert("No user data found.")}function Y(e){document.getElementById("Deposit-account").textContent=`${e.deposit||"$0.00"}`,document.getElementById("savings").textContent=`${e.savings||"$0.00"}`,document.getElementById("fixed").textContent=`${e.fixed||"$0.00"}`,Z(e),_(e);const n=document.getElementById("user-first-name");e.firstName&&e.firstName.trim()!==""&&(n.textContent=e.firstName);const i=document.getElementById("cardholder-name"),t=document.getElementById("modal-cardholder-name");let o="";e.firstName&&e.lastName?o=`${e.firstName.toUpperCase()} ${e.lastName.toUpperCase()}`:e.firstName&&(o=e.firstName.toUpperCase()),o&&(i&&(i.textContent=o),t&&(t.textContent=o))}function Z(e){let n=!1,i=0;for(let c=1;c<=20;c++){const s=document.getElementById(`history${c}`);if(s){const r=e[`history${c}`]||"";if(r&&r.trim()!==""){if(P(s,r),i<10){s.style.display="block";const a=s.querySelector(".mobile-transaction-item");a&&(a.style.display="flex"),i++}else{s.style.display="none";const a=s.querySelector(".mobile-transaction-item");a&&(a.style.display="none")}c>10&&(n=!0)}else{s.style.display="none";const a=s.querySelector(".mobile-transaction-item");a&&(a.style.display="none")}}}const t=document.getElementById("see-more");t&&(n?t.classList.remove("hidden"):t.classList.add("hidden"));const o=document.getElementById("recent-transactions");o&&(o.removeEventListener("click",T),o.addEventListener("click",T,{passive:!0}))}function _(e){const n=document.getElementById("pending1"),i=document.getElementById("pending2"),t=document.getElementById("pending3"),o=document.getElementById("pending-list");function c(s,r){const a=r.split("|").map(B=>B.trim()),f=a[0]||"",y=a[1]||"",p=a[2]||"";a[3];const l=a[4]||"";a[5];const m=s.querySelector(".pending-description"),d=s.querySelector(".pending-recipient"),u=s.querySelector(".pending-type"),E=s.querySelector(".pending-amount"),S=s.querySelector(".pending-date"),v=s.querySelector(".pending-avatar"),N=s.querySelector(".pending-avatar-text");m&&(m.textContent=f),d&&(d.textContent=y),u&&(u.textContent=f),E&&(E.textContent=p),S&&(S.textContent=l),v&&N&&(N.textContent="PN",v.className="w-12 h-12 rounded-full flex items-center justify-center pending-avatar font-semibold text-sm bg-orange-50 text-orange-700")}e.pending1&&e.pending1.trim()!==""&&(n.classList.remove("hidden"),c(n,e.pending1),o&&o.appendChild(n)),e.pending2&&e.pending2.trim()!==""&&(i.classList.remove("hidden"),c(i,e.pending2),o&&o.appendChild(i)),e.pending3&&e.pending3.trim()!==""&&(t.classList.remove("hidden"),c(t,e.pending3),o&&o.appendChild(t)),e.pending1&&e.pending2&&e.pending3&&e.pending1.trim()!==""&&e.pending2.trim()!==""&&e.pending3.trim()!==""?document.getElementById("pending-limit-notice").classList.remove("hidden"):document.getElementById("pending-limit-notice").classList.add("hidden")}window.signOut=function(){O(w).then(()=>{alert("Signed out successfully!"),window.location.href="login.html"}).catch(e=>{alert("Error signing out: "+e.message)})};
