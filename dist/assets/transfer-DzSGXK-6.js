import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as L}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";import{getAuth as C,onAuthStateChanged as P,signOut as S}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js";import{getFirestore as N,doc as f,getDoc as w,updateDoc as F}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";const R={apiKey:"AIzaSyABYV12B7RM2ZCD2G1lFTLpgJwflJFwEXY",authDomain:"beal-offshore.firebaseapp.com",projectId:"beal-offshore",storageBucket:"beal-offshore.firebasestorage.app",messagingSenderId:"1091834410162",appId:"1:1091834410162:web:56285433b5751e681745ab",measurementId:"G-CT463F3T6J"},B=L(R);window.auth=C(B);window.db=N(B);window.executeTransfer=async function(){try{const e=window.auth.currentUser;if(!e)throw new Error("No user is signed in");const r=f(window.db,"users",e.uid),n=await w(r);if(!n.exists())throw new Error("User account not found");const t=n.data();switch((t.status||"inactive").toLowerCase()){case"suspended":throw new Error("Your account is currently suspended. Please contact support for assistance.");case"inactive":throw new Error("Your account is inactive. Please activate your account to make transfers.");case"banned":throw new Error("This account has been banned. Please contact support for more information.");case"processing":throw new Error("Your account is currently under review. Please try again later.");case"active":break;default:throw new Error("Unable to verify account status. Please contact support.")}let i=document.getElementById("bankName").value,d=document.getElementById("accountNumber").value,c=document.getElementById("accountName").value,m=parseFloat(document.getElementById("withdrawCash").value.replace(/[^0-9.]/g,""))||0,a=document.getElementById("swiftCode").value,p=document.getElementById("paymentDescription").value,y="TRX"+Math.floor(Math.random()*1e6);const h=m*1e-4,E=new Date,I=E.toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),b=E.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}),g=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(m),u=`${i} - Beal-Offshore  |  Transfer-Intl  |  ${g} |  ${I}  |  ${b}  |  Pending`,v=t.pending1||"",x=t.pending2||"",D=t.pending3||"";let s="",l={};if(!v)s="pending1",l={pending1:u};else if(!x)s="pending2",l={pending2:u};else if(!D)s="pending3",l={pending3:u};else throw document.getElementById("pendingLimitReached").classList.remove("hidden"),new Error("Maximum pending transactions reached. This transaction has been queued as you have 3 pending transactions already. Cheers!");s&&(await F(r,l),console.log(`Transfer string saved in Firebase as ${s}:`,u));const T={bankName:i,accountNumber:d,accountName:c,transferAmount:g,swiftCode:a,transferType:selectedTransferType||"Domestic",paymentDescription:p,transactionRef:y,fee:h.toFixed(2),pendingSlot:s};await sendTransferDetails(T),document.getElementById("beneficiaryName").innerText=c,document.getElementById("beneficiaryAccount").innerText=d,document.getElementById("beneficiaryBank").innerText=i,document.getElementById("transferAmount").innerText=g,document.getElementById("transferFee").innerText=`$${h.toFixed(2)}`,document.getElementById("transactionRef").innerText=y,document.getElementById("receiptPaymentDescription").innerText=p||"-",selectedTransferType==="International"&&a?(document.getElementById("swiftCodeReceiptSection").classList.remove("hidden"),document.getElementById("receiptSwiftCode").innerText=a):document.getElementById("swiftCodeReceiptSection").classList.add("hidden"),document.getElementById("spinner").classList.add("hidden"),document.getElementById("successModal").classList.remove("hidden")}catch(e){console.error("Error executing transfer:",e),document.getElementById("spinner").classList.add("hidden"),showErrorModal(e.message)}};P(window.auth,async e=>{if(e){const r=f(window.db,"users",e.uid),n=await w(r);if(n.exists()){const t=n.data();document.getElementById("Deposit-account").textContent=`${t.deposit||"0.00"}`,document.getElementById("Profit-wallet").textContent=`${t.profit||"0.00"}`,document.getElementById("wallet").textContent=`${t.wallet||"0.00"}`,document.getElementById("welcome-message").textContent=`Welcome ${t.name}`}else console.log("No user document found in Firestore."),alert("No user data found.")}else console.log("No user signed in, redirecting to sign-in page."),window.location.href="login.html"});window.signOut=function(){S(window.auth).then(()=>{alert("Signed out successfully!"),window.location.href="login.html"}).catch(e=>{alert("Error signing out: "+e.message)})};window.validatePin=async function(){const e=document.getElementById("securityPin").value.trim(),r=document.getElementById("confirmButton"),n=document.getElementById("confirmButtonText"),t=document.getElementById("confirmButtonLoader"),o=document.getElementById("securityPinError");o.classList.add("hidden"),r.disabled=!0,n.textContent="Processing...",t.classList.remove("hidden"),document.getElementById("spinner").classList.remove("hidden");try{const i=window.auth.currentUser;if(i){const d=f(window.db,"users",i.uid),c=await w(d);if(c.exists()){const a=c.data().pin;a?e===a?(document.getElementById("securityPinModal").classList.add("hidden"),executeTransfer()):(o.textContent="Incorrect Pin. Please try again.",o.classList.remove("hidden")):(o.textContent="Please update your PIN in settings.",o.classList.remove("hidden"),window.location.href="pin.html")}}}catch(i){console.error("Error validating PIN:",i),o.textContent="Error validating PIN. Please try again.",o.classList.remove("hidden")}finally{r.disabled=!1,n.textContent="Confirm",t.classList.add("hidden"),document.getElementById("spinner").classList.add("hidden")}};document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("confirmButton");e&&e.addEventListener("click",window.validatePin)});
