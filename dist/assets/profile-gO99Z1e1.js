import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as d,d as m}from"./firebase-client-DudADU2j.js";import{onAuthStateChanged as y,signOut as N}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";import{doc as h,setDoc as x,getDoc as b}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";import"./firebase-config-CJaibweW.js";import"https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";window.auth=d;window.db=m;window.joinCreditCardWaitlist=async function(e){try{const t=d.currentUser,r=t?t.uid:`anon_${Date.now()}`,n=h(m,"credit_card_waitlist",r);return await x(n,{name:e.name,email:e.email,creditScore:e.creditScore||"",address:e.address,requestedAt:new Date().toISOString()},{merge:!0}),{ok:!0}}catch(t){console.error("joinCreditCardWaitlist error",t);try{const r="waitlistQueue",n=JSON.parse(localStorage.getItem(r)||"[]");n.push({...e,requestedAt:new Date().toISOString()}),localStorage.setItem(r,JSON.stringify(n))}catch{}return{ok:!0,queued:!0,error:t}}};async function p(e){const t=document.getElementById("status");t&&(t.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-gray-200 text-gray-700",t.innerHTML='<div class="h-2 w-2 rounded-full bg-gray-500 mr-2 animate-pulse"></div><span>Loading...</span>');try{const r=h(m,"users",e.uid),n=await b(r);if(n.exists()){const i=n.data();console.log("User data loaded:",i);const a=(o,c,l="")=>{const u=document.getElementById(o);u?u.tagName==="INPUT"?(u.value=c||l,u.placeholder=c||l):u.textContent=c||l:console.warn(`Element with id "${o}" not found`)};a("firstName",i.firstName,"First Name"),a("email",e.email,e.email);const s=document.getElementById("status");if(s){const o=i.status||"Processing...";switch(s.textContent=o,o.toLowerCase()){case"active":s.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-green-500 text-white",s.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2"></div><span>'+o+"</span>";break;case"suspended":s.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-yellow-500 text-white",s.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2"></div><span>'+o+"</span>";break;case"banned":s.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-red-500 text-white",s.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2"></div><span>'+o+"</span>";break;case"processing":s.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-blue-600 text-white",s.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2 animate-pulse"></div><span>'+o+"</span>";break;case"inactive":s.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-gray-500 text-white",s.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2"></div><span>'+o+"</span>";break;default:s.textContent="Processing",s.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-blue-500 text-white",s.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2 animate-pulse"></div><span>Processing</span>'}}}else{console.log("No user document found."),console.error("No user data found.");const i=document.getElementById("email");i&&(i.value=e.email,i.placeholder=e.email)}}catch(r){console.error("Error fetching user data:",r);const n=document.getElementById("status");n&&(n.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-red-500 text-white",n.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2"></div><span>Error loading data</span>')}}let w=!1,f=null,g=!1;y(d,async e=>{f&&(clearTimeout(f),f=null),e?(g=!0,w=!0,console.log("User authenticated:",e.uid,e.email),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>p(e)):p(e)):(w||(await new Promise(t=>setTimeout(t,500)),w=!0),g?console.log("User state changed to null, but user was previously authenticated. Waiting..."):f=setTimeout(()=>{const t=d.currentUser;!t&&!g?(console.log("No user signed in after verification. Redirecting to sign-in page."),window.location.href="login.html"):t&&(console.log("Auth state changed - user is now authenticated, canceling redirect"),g=!0)},1e3))});window.signOut=function(){N(d).then(()=>{alert("Signed out successfully!"),window.location.href="login.html"}).catch(e=>{alert("Error signing out: "+e.message)})};window.updateProfile=async function(){var t,r;const e=d.currentUser;if(e){const n=h(m,"users",e.uid),i={firstName:((t=document.getElementById("firstName"))==null?void 0:t.value.trim())||"",lastName:((r=document.getElementById("lastName"))==null?void 0:r.value.trim())||""},a=document.querySelector('button[type="submit"]');a&&(a.disabled=!0,a.textContent="Saving changes...");try{await x(n,i,{merge:!0}),alert("Profile updated successfully!")}catch(s){console.error("Error updating profile:",s),alert("Error updating profile: "+s.message)}finally{a&&(a.disabled=!1,a.textContent="Save Changes")}}else alert("No user is currently signed in.")};window.showUserInfo=async function(){const e=d.currentUser;if(e)try{const t=h(m,"users",e.uid),r=await b(t);if(r.exists()){const n=r.data(),i=(s,o,c="")=>{const l=document.getElementById(s);l&&(l.value=o||c,l.hasAttribute("placeholder")&&(l.placeholder=o||c))};i("firstName",n.firstName,"First Name"),i("status",n.status,"status"),i("email",e.email),i("phone",n.phone);const a=document.getElementById("profileInfoCard");a&&a.classList.remove("hidden")}else console.log("No user document found."),alert("No user data found.")}catch(t){console.error("Error fetching user info:",t),alert("Error fetching user information.")}else alert("No user is currently signed in.")};
