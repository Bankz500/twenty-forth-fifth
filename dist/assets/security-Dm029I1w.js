import"./modulepreload-polyfill-B5Qt9EMX.js";import{o as L,d as p,a as g,g as v,b as w,s as S,i as k,c as B,e as P,f as M,h as N}from"./firebase-client-DvgkFHPb.js";import"./firebase-config-C56FTJjz.js";let I=null;L(w,async t=>{if(t){I=t;const s=p(g,"users",t.uid),o=await v(s);if(o.exists()){let u=function(){document.getElementById("kycStatus")?E(e):setTimeout(u,50)};const e=o.data(),n=m=>{if(!m)return"0.00";const b=typeof m=="string"?parseFloat(m.replace(/[^0-9.-]/g,""))||0:Number(m)||0;return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(b)},i=document.getElementById("profileUsername"),d=document.getElementById("Deposit-account"),l=document.getElementById("Profit-wallet"),a=document.getElementById("wallet"),c=document.getElementById("welcome-message"),r=document.getElementById("displayEmail");i&&(i.textContent=e.firstName||"@syndicate"),d&&(d.textContent=n(e.checking)),l&&(l.textContent=n(e.profit)),a&&(a.textContent=n(e.wallet)),c&&(c.textContent=`Welcome ${e.firstName}`),r&&(r.textContent=t.email),u()}else console.log("No user document found."),alert("No user data found.")}else console.log("No user signed in. Redirecting to sign-in page."),window.location.href="login.html"});async function E(t){console.log("=== Loading KYC Status ==="),console.log("Full userData:",t),console.log("KYC Status value:",t.kycStatus),console.log("KYC Status type:",typeof t.kycStatus);const s=t.kycStatus||"not_completed",o=document.getElementById("kycStatus"),e=document.getElementById("kycStatusBadge"),n=document.getElementById("kycUploadSection"),i=document.getElementById("kycCompletedMessage"),d=document.getElementById("kycPendingMessage"),l=document.getElementById("kycRejectedMessage");if(!o||!e){console.error("KYC status elements not found"),console.error("kycStatusElement:",o),console.error("kycStatusBadge:",e);return}i&&i.classList.add("hidden"),d&&d.classList.add("hidden"),l&&l.classList.add("hidden");const a=String(s||"").trim(),c=a.toLowerCase();console.log("Raw status:",a,"Type:",typeof s),console.log("Normalized status:",c),console.log("Checking if status is approved or completed...");const r=a==="approved"||a==="completed"||c==="approved"||c==="completed"||c==="verified";if(console.log("Is approved?",r),r){console.log("✅ User is APPROVED - Setting verified tier 3 badge"),o.innerHTML='<i class="fas fa-star text-yellow-400 mr-1"></i> KYC Verified Tier 3',e.className="px-3 py-1 rounded text-xs font-medium bg-gradient-to-r from-yellow-500 to-yellow-600 text-white",e.style.display="inline-flex",e.style.alignItems="center",e.style.gap="4px",n&&n.classList.add("hidden"),i&&i.classList.remove("hidden");const u=document.querySelector(".bg-white.border.border-gray-300.rounded-lg.p-6");u&&(u.style.display="block"),console.log("✅ Badge updated successfully");return}else c==="rejected"?(console.log("Status is REJECTED"),o.textContent="KYC Rejected",e.className="px-3 py-1 rounded text-xs font-medium bg-red-600 text-white",n&&n.classList.remove("hidden"),l&&l.classList.remove("hidden")):c==="reviewed"?(console.log("Status is REVIEWED"),o.textContent="KYC Under Review",e.className="px-3 py-1 rounded text-xs font-medium bg-blue-600 text-white",n&&n.classList.add("hidden"),d&&(d.classList.remove("hidden"),d.innerHTML='<p class="text-sm text-gray-700"><strong class="text-gray-900">Status:</strong> Your KYC document has been reviewed and is being processed. You will be notified once a decision is made.</p>')):c==="pending"?(console.log("Status is PENDING"),o.textContent="KYC Pending Review",e.className="px-3 py-1 rounded text-xs font-medium bg-gray-600 text-white",n&&n.classList.add("hidden"),d&&(d.classList.remove("hidden"),d.innerHTML='<p class="text-sm text-gray-700"><strong class="text-gray-900">Status:</strong> Your KYC document is currently under review. You will be notified once the verification is complete.</p>')):(console.log("❌ Status is NOT COMPLETED. Normalized value:",c),console.log('Setting default "KYC Not Completed"'),o.textContent="KYC Not Completed",e.className="px-3 py-1 rounded text-xs font-medium bg-gray-400 text-white",n&&n.classList.remove("hidden"));console.log("=== KYC Status Load Complete ===")}window.loadKYCStatus=E;document.addEventListener("visibilitychange",()=>{if(!document.hidden&&I){const t=p(g,"users",I.uid);v(t).then(s=>{s.exists()&&E(s.data())})}});window.signOut=function(){S(w).then(()=>{alert("Signed out successfully!"),window.location.href="login.html"}).catch(t=>{alert("Error signing out: "+t.message)})};const Y=document.getElementById("changePinForm");Y.addEventListener("submit",t=>{t.preventDefault();const s=document.getElementById("newPin").value;if(s.length!==5||isNaN(s)){alert("Please enter a valid 5-digit PIN.");return}const o=document.getElementById("submitButton");o.disabled=!0,o.textContent="Processing...",setTimeout(()=>{document.getElementById("passwordModal").classList.remove("hidden"),o.disabled=!1,o.textContent="Change PIN"},1e3)});const h=document.getElementById("passwordConfirmForm");h.addEventListener("submit",async t=>{t.preventDefault();const s=document.getElementById("email").value,o=document.getElementById("firebasePassword").value,e=document.getElementById("newPin").value,n=h.querySelector('button[type="submit"]');n.disabled=!0,n.textContent="Processing...";try{const d=(await k(w,s,o)).user;if(d){const l=p(g,"users",d.uid);await B(l,{pin:e},{merge:!0});const a=document.createElement("div");a.textContent="PIN Change updated!",a.className="text-gray-700 text-xs text-center mt-4",h.parentElement.appendChild(a),setTimeout(()=>{document.getElementById("passwordModal").classList.add("hidden")},2e3)}}catch(i){console.error("Error updating PIN:",i),alert("Error updating PIN: "+i.message)}finally{n.disabled=!1,n.textContent="Confirm"}});window.handleKYCUpload=async function(){const t=document.getElementById("kycIdFile"),s=t.files[0];if(!s){alert("Please select a valid government issued ID image.");return}if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(s.type)){alert("Please upload a valid image file (JPEG, PNG, or WebP).");return}if(s.size>5*1024*1024){alert("File size must be less than 5MB.");return}const e=document.getElementById("uploadKYCButton");e.disabled=!0,e.textContent="Uploading...";try{const n=await K(s),i=w.currentUser;if(!i)throw new Error("User not authenticated");const d={userId:i.uid,userEmail:i.email,idImageBase64:n,status:"pending",submittedAt:P(),reviewedAt:null,reviewedBy:null};await M(N(g,"kyc_requests"),d);const l=p(g,"users",i.uid);await B(l,{kycStatus:"pending",kycIdImageLink:n},{merge:!0}),document.getElementById("kycSuccessModal").classList.remove("hidden"),document.getElementById("kycUploadSection").classList.add("hidden"),document.getElementById("kycPendingMessage").classList.remove("hidden");const a=await v(l);a.exists()&&E(a.data()),t.value="",document.getElementById("kycImagePreview").src="",document.getElementById("imagePreviewContainer").classList.add("hidden")}catch(n){console.error("Error uploading KYC:",n),alert("Error uploading KYC document: "+n.message)}finally{e.disabled=!1,e.textContent="Upload ID"}};function K(t){return new Promise((s,o)=>{const e=new FileReader;e.onload=()=>{const n=e.result;s(n)},e.onerror=o,e.readAsDataURL(t)})}window.togglePinVisibility=function(){const t=document.getElementById("newPin"),s=document.getElementById("eyeIcon");t.type==="password"?(t.type="text",s.innerHTML='<path d="M17.94 17.94A10.09 10.09 0 0 1 12 20c-7 0-11-8-11-8a18.66 18.66 0 0 1 3-4m3.53-2.36A10.09 10.09 0 0 1 12 4c7 0 11 8 11 8a18.3 18.3 0 0 1-1.72 2.82M15 12a3 3 0 1 0-3 3m8.17 8.17L3 3"></path>'):(t.type="password",s.innerHTML='<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>')};window.previewKYCImage=function(t){const s=t.target.files[0];if(s){const o=new FileReader;o.onload=function(e){const n=document.getElementById("kycImagePreview"),i=document.getElementById("imagePreviewContainer");n.src=e.target.result,n.classList.remove("hidden"),i.classList.remove("hidden")},o.readAsDataURL(s)}};window.closeKYCSuccessModal=function(){document.getElementById("kycSuccessModal").classList.add("hidden")};const y=document.getElementById("mobile-menu"),f=document.getElementById("overlay"),C=document.getElementById("mobile-menu-button"),x=document.getElementById("close-menu");if(y&&f&&C&&x){let t=function(){y.classList.remove("translate-x-full"),f.classList.remove("hidden"),document.body.style.overflow="hidden"},s=function(){y.classList.add("translate-x-full"),f.classList.add("hidden"),document.body.style.overflow=""};C.addEventListener("click",t),x.addEventListener("click",s),f.addEventListener("click",s),y.querySelectorAll("a").forEach(o=>{o.addEventListener("click",s)})}
