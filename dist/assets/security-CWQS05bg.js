import"./modulepreload-polyfill-B5Qt9EMX.js";import{o as C,e as m,d as u,b as E,a as g,l as I,v,s as h,h as x,i as B,c as S}from"./firebase-client-BQD81AQz.js";import"./firebase-config-D2Ob3NcO.js";let w=null;C(g,async n=>{if(n){w=n;const s=m(u,"users",n.uid),o=await E(s);if(o.exists()){let r=function(){document.getElementById("kycStatus")?y(e):setTimeout(r,50)};const e=o.data(),t=document.getElementById("profileUsername"),i=document.getElementById("Deposit-account"),a=document.getElementById("Profit-wallet"),l=document.getElementById("wallet"),d=document.getElementById("welcome-message"),c=document.getElementById("displayEmail");t&&(t.textContent=e.firstName||"@syndicate"),i&&(i.textContent=e.deposit||"0.00"),a&&(a.textContent=e.profit||"0.00"),l&&(l.textContent=e.wallet||"0.00"),d&&(d.textContent=`Welcome ${e.firstName}`),c&&(c.textContent=n.email),r()}else console.log("No user document found."),alert("No user data found.")}else console.log("No user signed in. Redirecting to sign-in page."),window.location.href="login.html"});async function y(n){console.log("=== Loading KYC Status ==="),console.log("Full userData:",n),console.log("KYC Status value:",n.kycStatus),console.log("KYC Status type:",typeof n.kycStatus);const s=n.kycStatus||"not_completed",o=document.getElementById("kycStatus"),e=document.getElementById("kycStatusBadge"),t=document.getElementById("kycUploadSection"),i=document.getElementById("kycCompletedMessage"),a=document.getElementById("kycPendingMessage"),l=document.getElementById("kycRejectedMessage");if(!o||!e){console.error("KYC status elements not found"),console.error("kycStatusElement:",o),console.error("kycStatusBadge:",e);return}i&&i.classList.add("hidden"),a&&a.classList.add("hidden"),l&&l.classList.add("hidden");const d=String(s||"").trim(),c=d.toLowerCase();console.log("Raw status:",d,"Type:",typeof s),console.log("Normalized status:",c),console.log("Checking if status is approved or completed...");const r=d==="approved"||d==="completed"||c==="approved"||c==="completed"||c==="verified";if(console.log("Is approved?",r),r){console.log("✅ User is APPROVED - Setting verified tier 3 badge"),o.innerHTML='<i class="fas fa-star text-yellow-400 mr-1"></i> KYC Verified Tier 3',e.className="px-3 py-1 rounded text-xs font-medium bg-gradient-to-r from-yellow-500 to-yellow-600 text-white",e.style.display="inline-flex",e.style.alignItems="center",e.style.gap="4px",t&&t.classList.add("hidden"),i&&i.classList.remove("hidden");const p=document.querySelector(".bg-white.border.border-gray-300.rounded-lg.p-6");p&&(p.style.display="block"),console.log("✅ Badge updated successfully");return}else c==="rejected"?(console.log("Status is REJECTED"),o.textContent="KYC Rejected",e.className="px-3 py-1 rounded text-xs font-medium bg-red-600 text-white",t&&t.classList.remove("hidden"),l&&l.classList.remove("hidden")):c==="reviewed"?(console.log("Status is REVIEWED"),o.textContent="KYC Under Review",e.className="px-3 py-1 rounded text-xs font-medium bg-blue-600 text-white",t&&t.classList.add("hidden"),a&&(a.classList.remove("hidden"),a.innerHTML='<p class="text-sm text-gray-700"><strong class="text-gray-900">Status:</strong> Your KYC document has been reviewed and is being processed. You will be notified once a decision is made.</p>')):c==="pending"?(console.log("Status is PENDING"),o.textContent="KYC Pending Review",e.className="px-3 py-1 rounded text-xs font-medium bg-gray-600 text-white",t&&t.classList.add("hidden"),a&&(a.classList.remove("hidden"),a.innerHTML='<p class="text-sm text-gray-700"><strong class="text-gray-900">Status:</strong> Your KYC document is currently under review. You will be notified once the verification is complete.</p>')):(console.log("❌ Status is NOT COMPLETED. Normalized value:",c),console.log('Setting default "KYC Not Completed"'),o.textContent="KYC Not Completed",e.className="px-3 py-1 rounded text-xs font-medium bg-gray-400 text-white",t&&t.classList.remove("hidden"));console.log("=== KYC Status Load Complete ===")}window.loadKYCStatus=y;document.addEventListener("visibilitychange",()=>{if(!document.hidden&&w){const n=m(u,"users",w.uid);E(n).then(s=>{s.exists()&&y(s.data())})}});window.signOut=function(){I(g).then(()=>{alert("Signed out successfully!"),window.location.href="login.html"}).catch(n=>{alert("Error signing out: "+n.message)})};const b=document.getElementById("changePinForm");b.addEventListener("submit",n=>{n.preventDefault();const s=document.getElementById("newPin").value;if(s.length!==5||isNaN(s)){alert("Please enter a valid 5-digit PIN.");return}const o=document.getElementById("submitButton");o.disabled=!0,o.textContent="Processing...",setTimeout(()=>{document.getElementById("passwordModal").classList.remove("hidden"),o.disabled=!1,o.textContent="Change PIN"},1e3)});const f=document.getElementById("passwordConfirmForm");f.addEventListener("submit",async n=>{n.preventDefault();const s=document.getElementById("email").value,o=document.getElementById("firebasePassword").value,e=document.getElementById("newPin").value,t=f.querySelector('button[type="submit"]');t.disabled=!0,t.textContent="Processing...";try{const a=(await v(g,s,o)).user;if(a){const l=m(u,"users",a.uid);await h(l,{pin:e},{merge:!0});const d=document.createElement("div");d.textContent="PIN Change updated!",d.className="text-gray-700 text-xs text-center mt-4",f.parentElement.appendChild(d),setTimeout(()=>{document.getElementById("passwordModal").classList.add("hidden")},2e3)}}catch(i){console.error("Error updating PIN:",i),alert("Error updating PIN: "+i.message)}finally{t.disabled=!1,t.textContent="Confirm"}});window.handleKYCUpload=async function(){const n=document.getElementById("kycIdFile"),s=n.files[0];if(!s){alert("Please select a valid government issued ID image.");return}if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(s.type)){alert("Please upload a valid image file (JPEG, PNG, or WebP).");return}if(s.size>5*1024*1024){alert("File size must be less than 5MB.");return}const e=document.getElementById("uploadKYCButton");e.disabled=!0,e.textContent="Uploading...";try{const t=await L(s),i=g.currentUser;if(!i)throw new Error("User not authenticated");const a={userId:i.uid,userEmail:i.email,idImageBase64:t,status:"pending",submittedAt:x(),reviewedAt:null,reviewedBy:null};await B(S(u,"kyc_requests"),a);const l=m(u,"users",i.uid);await h(l,{kycStatus:"pending",kycIdImageLink:t},{merge:!0}),document.getElementById("kycSuccessModal").classList.remove("hidden"),document.getElementById("kycUploadSection").classList.add("hidden"),document.getElementById("kycPendingMessage").classList.remove("hidden");const d=await E(l);d.exists()&&y(d.data()),n.value="",document.getElementById("kycImagePreview").src="",document.getElementById("imagePreviewContainer").classList.add("hidden")}catch(t){console.error("Error uploading KYC:",t),alert("Error uploading KYC document: "+t.message)}finally{e.disabled=!1,e.textContent="Upload ID"}};function L(n){return new Promise((s,o)=>{const e=new FileReader;e.onload=()=>{const t=e.result;s(t)},e.onerror=o,e.readAsDataURL(n)})}window.togglePinVisibility=function(){const n=document.getElementById("newPin"),s=document.getElementById("eyeIcon");n.type==="password"?(n.type="text",s.innerHTML='<path d="M17.94 17.94A10.09 10.09 0 0 1 12 20c-7 0-11-8-11-8a18.66 18.66 0 0 1 3-4m3.53-2.36A10.09 10.09 0 0 1 12 4c7 0 11 8 11 8a18.3 18.3 0 0 1-1.72 2.82M15 12a3 3 0 1 0-3 3m8.17 8.17L3 3"></path>'):(n.type="password",s.innerHTML='<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>')};window.previewKYCImage=function(n){const s=n.target.files[0];if(s){const o=new FileReader;o.onload=function(e){const t=document.getElementById("kycImagePreview"),i=document.getElementById("imagePreviewContainer");t.src=e.target.result,t.classList.remove("hidden"),i.classList.remove("hidden")},o.readAsDataURL(s)}};window.closeKYCSuccessModal=function(){document.getElementById("kycSuccessModal").classList.add("hidden")};
