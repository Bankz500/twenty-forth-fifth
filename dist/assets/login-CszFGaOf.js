import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as c}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";import{getAuth as m,signInWithEmailAndPassword as g}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";import{f as p}from"./firebase-config-CJaibweW.js";const u=c(p),f=m(u);emailjs.init("PpoJ-7X-bqUjp3Wa7");const y=document.getElementById("login-section"),w=document.getElementById("otp-section"),h=document.getElementById("login-form"),E=document.getElementById("otp-form"),s=document.getElementById("login-btn"),a=document.getElementById("resend-otp"),I=document.getElementById("email-display");let i=null;function l(t=6){return Array.from({length:t},()=>Math.floor(Math.random()*10)).join("")}async function d(t,e){try{return await emailjs.send("service_dou8hz3","template_nncgc6k",{to_email:t,email:t,otp:e}),!0}catch(r){return console.error("Error sending OTP:",r),!1}}h.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("email").value.trim(),r=document.getElementById("password").value;try{s.disabled=!0,s.textContent="Authenticating...",i=(await g(f,e,r)).user;const n=l();if(sessionStorage.setItem("loginOtp",n),!await d(e,n))throw new Error("Failed to send OTP");I.textContent=e,y.classList.add("hidden"),w.classList.remove("hidden")}catch(o){console.error("Login error:",o);let n="An error occurred during login.";o.code==="auth/user-not-found"||o.code==="auth/wrong-password"?n="Invalid email or password.":o.code==="auth/too-many-requests"&&(n="Too many failed attempts. Please try again later."),alert(n)}finally{s.disabled=!1,s.textContent="Log in"}});E.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("verify-otp-btn"),r=document.getElementById("otp").value,o=sessionStorage.getItem("loginOtp");e.disabled=!0,e.textContent="Logging in...";try{if(!o)throw new Error("OTP session expired");if(r===o)sessionStorage.removeItem("loginOtp"),await new Promise(n=>setTimeout(n,1e3)),window.location.href="dashboard.html";else throw new Error("Invalid OTP")}catch(n){alert(n.message+". Please try again."),e.disabled=!1,e.textContent="Proceed"}});a.addEventListener("click",async t=>{if(t.preventDefault(),!i){alert("Session expired. Please login again."),window.location.reload();return}a.textContent="Sending...";const e=l();await d(i.email,e)?(sessionStorage.setItem("loginOtp",e),alert("New OTP has been sent to your email.")):alert("Failed to send new OTP. Please try again."),a.textContent="Request again"});sessionStorage.removeItem("loginOtp");
