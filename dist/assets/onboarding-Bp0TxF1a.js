import"./modulepreload-polyfill-B5Qt9EMX.js";import{f as x}from"./firebase-config-BJbrxyFw.js";import{initializeApp as C}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";import{getAuth as E,onAuthStateChanged as v,signOut as w}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";import{getFirestore as L,doc as B,getDoc as S,serverTimestamp as l,updateDoc as b,setDoc as A}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";import{s as I,a as k}from"./compliance-modals-BQvUBI0-.js";const f=C(x),h=E(f),D=L(f),m=document.getElementById("step1"),u=document.getElementById("step2"),p=document.getElementById("progressBar"),g=document.getElementById("stepLabel"),o=document.getElementById("statusLine"),M=document.getElementById("nextBtn"),O=document.getElementById("backBtn"),n=document.getElementById("finishBtn");let i=new Set,a="",r=null;function d(e){e===1?(m.classList.remove("hidden"),u.classList.add("hidden"),p.style.width="50%",g.textContent="Step 1"):(m.classList.add("hidden"),u.classList.remove("hidden"),p.style.width="100%",g.textContent="Step 2")}function P(e,t){e.forEach(s=>{s.classList.remove("selected"),s.style.borderColor=""}),t.classList.add("selected"),t.style.borderColor="#1800ac"}document.querySelectorAll(".depositOption").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.deposit||"";t&&(i.has(t)?(i.delete(t),e.classList.remove("selected"),e.style.borderColor=""):(i.add(t),e.classList.add("selected"),e.style.borderColor="#1800ac"))})});document.querySelectorAll(".residencyOption").forEach(e=>{e.addEventListener("click",()=>{a=e.dataset.residency||"",P(document.querySelectorAll(".residencyOption"),e)})});M.addEventListener("click",()=>{if(!i.size){o.textContent="Please select at least one deposit method to continue.";return}o.textContent="",d(2)});O.addEventListener("click",()=>{o.textContent="",d(1)});v(h,e=>{if(!e){window.location.href="sign-up.html";return}r=e});n.addEventListener("click",async()=>{if(r){if(!a){o.textContent="Please select your residency to finish.";return}n.disabled=!0,n.textContent="Saving...",o.textContent="Finalizing your setup...";try{const e=Array.from(i),t=e[0]||null,s=B(D,"users",r.uid);console.log("Saving onboarding data for user:",r.uid),console.log("Deposit methods:",e),console.log("Residency:",a);const y=await S(s),c={onboarding:{depositMethod:t,depositMethods:e,residency:a},onboardingCompletedAt:l(),onboardingStatus:"completed"};y.exists()?(console.log("User document exists, updating..."),await b(s,c)):(console.log("User document does not exist, creating with onboarding data..."),await A(s,{email:r.email||"",createdAt:l(),createdAtIso:new Date().toISOString(),...c},{merge:!0})),console.log("Onboarding data saved successfully"),o.textContent="",await I(),await k({onClose:async()=>{try{await w(h)}catch{}window.location.href="login.html"}})}catch(e){console.error("Onboarding save error:",e),console.error("Error code:",e==null?void 0:e.code),console.error("Error message:",e==null?void 0:e.message),console.error("Error stack:",e==null?void 0:e.stack);let t="We could not save your onboarding details. Please try again.";(e==null?void 0:e.code)==="permission-denied"?t="Permission denied. Please contact support if this issue persists.":e!=null&&e.message&&(t=`Error: ${e.message}`),o.textContent=t,o.className="mt-4 text-xs text-red-600",alert(t)}finally{n.disabled=!1,n.textContent="Finish Sign Up"}}});d(1);
