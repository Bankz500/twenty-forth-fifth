import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css             */import{initializeApp as v}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";import{getAuth as I,createUserWithEmailAndPassword as B,sendEmailVerification as A,onAuthStateChanged as P}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";import{getFirestore as S,serverTimestamp as w,setDoc as C,doc as N}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";const E={apiKey:"AIzaSyDk8K22XfrsAQAX7WarxSq_BnwO1YQLDSc",authDomain:"twenty-third-forth-ee57c.firebaseapp.com",projectId:"twenty-third-forth-ee57c",storageBucket:"twenty-third-forth-ee57c.firebasestorage.app",messagingSenderId:"47210898997",appId:"1:47210898997:web:d25c23eee45a7660cef37c",measurementId:"G-ESYD665GWG"};console.log("Initializing Firebase with config:",E);let p,d,h;try{p=v(E),d=I(p),h=S(p),console.log("Firebase initialized successfully:",{app:p,auth:d,db:h})}catch(o){console.error("Firebase initialization error:",o),alert("Failed to initialize Firebase. Please refresh the page and try again.")}const b=async(o,r)=>{var u;const e=document.getElementById(r==="personal"?"create-personal-account-btn":"create-account-btn"),s=document.getElementById("spinner"),g=e?e.textContent:"Create Account";if(!e){console.error("Create account button not found!"),alert("Error: Create account button not found. Please refresh the page.");return}if(!d){console.error("Firebase Auth not initialized!"),alert("Error: Firebase Authentication is not initialized. Please refresh the page.");return}if(!h){console.error("Firestore not initialized!"),alert("Error: Firestore is not initialized. Please refresh the page.");return}try{if(e.dataset.loading==="true"&&(e.dataset.loading="false",e.classList.remove("btn-loading")),e.disabled=!0,e.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Creating Account...',s&&s.classList.remove("hidden"),console.log("Starting sign-up process for:",o.email),console.log("Form data:",{email:o.email,accountType:r}),!o.email||!o.email.includes("@"))throw new Error("Please enter a valid email address.");if(!o.password||o.password.length<6)throw new Error("Password must be at least 6 characters long.");console.log("Calling createUserWithEmailAndPassword..."),console.log("Auth object before signup:",d);const a=(await B(d,o.email,o.password)).user;console.log("User created successfully:",a.uid,a.email),console.log("Current auth user:",(u=d.currentUser)==null?void 0:u.uid),await new Promise(t=>setTimeout(t,100)),(!d.currentUser||d.currentUser.uid!==a.uid)&&console.warn("Auth state not immediately available, but continuing...");const i={firstName:o.firstName,lastName:o.lastName,email:o.email,accountType:o.accountType,userAccountType:r,approvalStatus:"pending",isApproved:!1,approvalRequestedAt:w(),approvedAt:null,approvedBy:null,onboardingStatus:"not_started",onboarding:{depositMethod:null,depositMethods:[],residency:null},onboardingCompletedAt:null,createdAt:w(),createdAtIso:new Date().toISOString()};if(r==="personal"){const t=document.getElementById("phone-number"),c=document.getElementById("home-address"),m=document.getElementById("billing-address");t&&(i.phoneNumber=t.value.trim()),c&&(i.homeAddress=c.value.trim()),m&&(i.billingAddress=m.value.trim())}else{const t=document.getElementById("business-name"),c=document.getElementById("business-type"),m=document.getElementById("business-ein"),f=document.getElementById("business-cert"),y=document.getElementById("business-phone-number");t&&(i.businessName=t.value.trim()),c&&(i.businessType=c.value.trim()),m&&(i.businessEin=m.value.trim()),f&&(i.businessCert=f.value.trim()),y&&(i.phoneNumber=y.value.trim())}console.log("Saving user data to Firestore..."),console.log("User UID:",a.uid),console.log("User data to save:",i);try{const t=C(N(h,"users",a.uid),i),c=new Promise((m,f)=>setTimeout(()=>f(new Error("Firestore write timed out after 10 seconds")),1e4));await Promise.race([t,c]),console.log("User data saved to Firestore successfully")}catch(t){console.error("Firestore write error:",t),console.error("Error code:",t==null?void 0:t.code),console.error("Error message:",t==null?void 0:t.message),console.warn("Firestore write failed, but user is created in Auth. Continuing..."),(t==null?void 0:t.code)==="permission-denied"&&console.error("Firestore permission denied - check Firestore security rules")}try{await A(a)}catch(t){console.warn("Email verification send failed:",t)}e&&(e.dataset.loading="false",e.classList.remove("btn-loading"),e.dispatchEvent(new CustomEvent("site:button-reset")),e.disabled=!1,e.innerHTML='<i class="fas fa-check mr-2"></i>Account Created!',e.classList.add("bg-green-600","hover:bg-green-700")),console.log("Showing success modal...");const l=document.getElementById("success-modal");l?(l.classList.remove("hidden"),console.log("Success modal shown")):console.error("Success modal not found! Modal ID: success-modal");try{sessionStorage.setItem("firstcitizens_onboarding_after_signup","1")}catch{}P(d,t=>{t&&(t.emailVerified?console.log("Email verified. Access granted."):console.log("Please verify your email address."))})}catch(n){console.error("Error during sign-up:",n),console.error("Error details:",{code:n==null?void 0:n.code,message:n==null?void 0:n.message,stack:n==null?void 0:n.stack});const a=(n==null?void 0:n.code)||(n==null?void 0:n.message)||"unknown",i=F(a);alert(`Sign-up failed: ${i}`);const l=document.createElement("div");l.className="fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded z-50 shadow-lg max-w-md",l.innerHTML=`
                <strong class="font-bold">Error!</strong>
                <span class="block sm:inline">${i}</span>
                <button onclick="this.parentElement.remove()" class="mt-2 text-red-800 underline text-sm">Dismiss</button>
            `,document.body.appendChild(l),setTimeout(()=>{l.parentNode&&l.remove()},1e4)}finally{const n=document.getElementById("success-modal"),a=n&&!n.classList.contains("hidden");e&&a?console.log("Sign-up successful, keeping success state"):e&&(console.log("Resetting button after error"),e.dataset.loading="false",e.classList.remove("btn-loading"),e.dispatchEvent(new CustomEvent("site:button-reset")),e.disabled=!1,e.innerHTML=g,e.classList.remove("bg-green-600","hover:bg-green-700")),s&&s.classList.add("hidden")}},F=o=>{const r=String(o).toLowerCase();return r.includes("email-already-in-use")||r==="auth/email-already-in-use"?"This email is already registered. Please use a different email or try logging in.":r.includes("weak-password")||r==="auth/weak-password"?"Password is too weak. Please use at least 8 characters with a mix of letters, numbers, and symbols.":r.includes("invalid-email")||r==="auth/invalid-email"?"Please enter a valid email address.":r.includes("network-request-failed")||r==="auth/network-request-failed"?"Network error. Please check your internet connection and try again.":r.includes("too-many-requests")||r==="auth/too-many-requests"?"Too many attempts. Please try again later.":r.includes("operation-not-allowed")||r==="auth/operation-not-allowed"?"Email/password authentication is not enabled. Please contact support.":`An error occurred: ${o}. Please try again or contact support.`};window.signUp=b;document.addEventListener("DOMContentLoaded",function(){console.log("DOM loaded, setting up form handlers...");const o=document.querySelector("#business-info-form");o?(console.log("Business form found, attaching handler"),o.addEventListener("submit",async e=>{e.preventDefault(),console.log("Business form submitted");const s={firstName:document.getElementById("first-name").value.trim(),lastName:document.getElementById("last-name").value.trim(),email:document.getElementById("email").value.trim(),accountType:document.getElementById("account-type").value,password:document.getElementById("password").value,confirmPassword:document.getElementById("confirm-password").value};if(console.log("Form data collected:",{...s,password:"***"}),!s.firstName||!s.lastName||!s.email||!s.password||!s.accountType){alert("All fields are required.");return}if(s.password!==s.confirmPassword){alert("Passwords do not match.");return}if(s.password.length<8){alert("Password must be at least 8 characters long.");return}const g=document.getElementById("business-name").value.trim(),u=document.getElementById("business-type").value.trim(),n=document.getElementById("business-ein").value.trim(),a=document.getElementById("business-cert").value.trim(),i=document.getElementById("business-phone-number").value.trim();if(!g||!u||!n||!a||!i){alert("All business fields are required.");return}try{await b(s,"business")}catch(l){console.error("Sign-up error caught in handler:",l),alert(`Sign-up failed: ${l.message||"Unknown error"}`)}})):console.warn("Business form not found!");const r=document.querySelector("#personal-address-form");r?(console.log("Personal form found, attaching handler"),r.addEventListener("submit",async e=>{e.preventDefault(),console.log("Personal form submitted");const s={firstName:document.getElementById("first-name").value.trim(),lastName:document.getElementById("last-name").value.trim(),email:document.getElementById("email").value.trim(),accountType:document.getElementById("account-type").value,password:document.getElementById("password").value,confirmPassword:document.getElementById("confirm-password").value};if(console.log("Form data collected:",{...s,password:"***"}),!s.firstName||!s.lastName||!s.email||!s.password||!s.accountType){alert("All fields are required.");return}if(s.password!==s.confirmPassword){alert("Passwords do not match.");return}if(s.password.length<8){alert("Password must be at least 8 characters long.");return}const g=document.getElementById("phone-number").value.trim(),u=document.getElementById("home-address").value.trim(),n=document.getElementById("billing-address").value.trim();if(!g||!u||!n){alert("All contact information fields are required.");return}try{await b(s,"personal")}catch(a){console.error("Sign-up error caught in handler:",a),alert(`Sign-up failed: ${a.message||"Unknown error"}`)}})):console.warn("Personal form not found!")});
