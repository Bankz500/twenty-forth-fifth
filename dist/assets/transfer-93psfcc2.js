import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as b}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";import{getAuth as D,onAuthStateChanged as v,signOut as x}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js";import{getFirestore as T,doc as m,getDoc as l,updateDoc as P}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";const C={apiKey:"AIzaSyABYV12B7RM2ZCD2G1lFTLpgJwflJFwEXY",authDomain:"beal-offshore.firebaseapp.com",projectId:"beal-offshore",storageBucket:"beal-offshore.firebasestorage.app",messagingSenderId:"1091834410162",appId:"1:1091834410162:web:56285433b5751e681745ab",measurementId:"G-CT463F3T6J"},h=b(C);window.auth=D(h);window.db=T(h);window.executeTransfer=async function(){try{const e=window.auth.currentUser;if(!e)throw new Error("No user is signed in");const a=m(window.db,"users",e.uid),t=await l(a);if(!t.exists())throw new Error("User account not found");switch((t.data().status||"inactive").toLowerCase()){case"suspended":throw new Error("Your account is currently suspended. Please contact support for assistance.");case"inactive":throw new Error("Your account is inactive. Please activate your account to make transfers.");case"banned":throw new Error("This account has been banned. Please contact support for more information.");case"processing":throw new Error("Your account is currently under review. Please try again later.");case"active":break;default:throw new Error("Unable to verify account status. Please contact support.")}let r=document.getElementById("bankName").value,c=document.getElementById("accountNumber").value,s=document.getElementById("accountName").value,d=parseFloat(document.getElementById("withdrawCash").value.replace(/[^0-9.]/g,""))||0,i=document.getElementById("swiftCode").value,f=document.getElementById("paymentDescription").value,g="TRX"+Math.floor(Math.random()*1e6);const w=d*1e-4,y=new Date,E=y.toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),B=y.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}),u=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(d),p=`${r} - DEPOT 2  |  Wire Deposit  |  ${u} |  ${E}  |  ${B}  |  Pending`;await P(a,{pending1:p}),console.log("Transfer string saved in Firebase:",p);const I={bankName:r,accountNumber:c,accountName:s,transferAmount:u,swiftCode:i,transferType:selectedTransferType||"Domestic",paymentDescription:f,transactionRef:g,fee:w.toFixed(2)};await sendTransferDetails(I),document.getElementById("beneficiaryName").innerText=s,document.getElementById("beneficiaryAccount").innerText=c,document.getElementById("beneficiaryBank").innerText=r,document.getElementById("transferAmount").innerText=u,document.getElementById("transferFee").innerText=`$${w.toFixed(2)}`,document.getElementById("transactionRef").innerText=g,document.getElementById("receiptPaymentDescription").innerText=f||"-",selectedTransferType==="International"&&i?(document.getElementById("swiftCodeReceiptSection").classList.remove("hidden"),document.getElementById("receiptSwiftCode").innerText=i):document.getElementById("swiftCodeReceiptSection").classList.add("hidden"),document.getElementById("spinner").classList.add("hidden"),document.getElementById("successModal").classList.remove("hidden")}catch(e){console.error("Error executing transfer:",e),document.getElementById("spinner").classList.add("hidden"),showErrorModal(e.message)}};v(window.auth,async e=>{if(e){const a=m(window.db,"users",e.uid),t=await l(a);if(t.exists()){const n=t.data();document.getElementById("Deposit-account").textContent=`${n.deposit||"0.00"}`,document.getElementById("Profit-wallet").textContent=`${n.profit||"0.00"}`,document.getElementById("wallet").textContent=`${n.wallet||"0.00"}`,document.getElementById("welcome-message").textContent=`Welcome ${n.name}`}else console.log("No user document found in Firestore."),alert("No user data found.")}else console.log("No user signed in, redirecting to sign-in page."),window.location.href="login.html"});window.signOut=function(){x(window.auth).then(()=>{alert("Signed out successfully!"),window.location.href="login.html"}).catch(e=>{alert("Error signing out: "+e.message)})};window.validatePin=async function(){const e=document.getElementById("securityPin").value.trim(),a=document.getElementById("confirmButton"),t=document.getElementById("confirmButtonText"),n=document.getElementById("confirmButtonLoader"),o=document.getElementById("securityPinError");o.classList.add("hidden"),a.disabled=!0,t.textContent="Processing...",n.classList.remove("hidden"),document.getElementById("spinner").classList.remove("hidden");try{const r=window.auth.currentUser;if(r){const c=m(window.db,"users",r.uid),s=await l(c);if(s.exists()){const i=s.data().pin;i?e===i?(document.getElementById("securityPinModal").classList.add("hidden"),executeTransfer()):(o.textContent="Incorrect Pin. Please try again.",o.classList.remove("hidden")):(o.textContent="Please update your PIN in settings.",o.classList.remove("hidden"),window.location.href="pin.html")}}}catch(r){console.error("Error validating PIN:",r),o.textContent="Error validating PIN. Please try again.",o.classList.remove("hidden")}finally{a.disabled=!1,t.textContent="Confirm",n.classList.add("hidden"),document.getElementById("spinner").classList.add("hidden")}};document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("confirmButton");e&&e.addEventListener("click",window.validatePin)});
