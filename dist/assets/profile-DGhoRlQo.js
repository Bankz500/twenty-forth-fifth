import"./modulepreload-polyfill-B5Qt9EMX.js";import{b as m,a as f,d as y,c as N,o as C,s as S,g as I}from"./firebase-client-X0D09DJ_.js";import"./firebase-config-LdbrzKVt.js";window.auth=m;window.db=f;window.joinCreditCardWaitlist=async function(e){try{const t=m.currentUser,r=t?t.uid:`anon_${Date.now()}`,s=y(f,"credit_card_waitlist",r);return await N(s,{name:e.name,email:e.email,creditScore:e.creditScore||"",address:e.address,requestedAt:new Date().toISOString()},{merge:!0}),{ok:!0}}catch(t){console.error("joinCreditCardWaitlist error",t);try{const r="waitlistQueue",s=JSON.parse(localStorage.getItem(r)||"[]");s.push({...e,requestedAt:new Date().toISOString()}),localStorage.setItem(r,JSON.stringify(s))}catch{}return{ok:!0,queued:!0,error:t}}};function B(e){const t=(e.kycStatus||"").toLowerCase().trim(),r=document.getElementById("transferTierBadge"),s=document.getElementById("transferTierText"),i=document.getElementById("minTransferLimit"),o=document.getElementById("maxTransferLimit"),n=document.getElementById("verificationTier"),a=document.getElementById("upgradeTransferLimitSection");if(!r||!s||!i||!o||!n)return;let d=1,l="Tier 1 - Unverified",c="$1 - $250,000",g="$50,000",u="$1,000,000",h="bg-gray-400 text-white",x=!0;t==="approved"||t==="completed"?(d=3,l="Tier 3 - Verified",c="$1 - $100,000,000",g="$5,000,000",u="Unlimited",h="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white",x=!1):t==="pending"||t==="reviewed"?(d=2,l="Tier 2 - Under Review",c="$1 - $500,000",g="$100,000",u="$3,000,000",h="bg-gray-600 text-white",x=!1):(d=1,l="Tier 1 - Unverified",c="$1 - $250,000",g="$50,000",u="$1,000,000",h="bg-gray-400 text-white",x=!0),s.textContent=`Tier ${d}`,r.className=`inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm ${h}`;const v=document.getElementById("dailyTransferLimit"),E=document.getElementById("perTransferLimit"),T=document.getElementById("monthlyTransferLimit");v&&(v.textContent=c),E&&(E.textContent=g),T&&(T.textContent=u),i&&(i.textContent=c),o&&(o.textContent=u),n&&(n.textContent=l),a&&(x?a.classList.remove("hidden"):a.classList.add("hidden"))}async function L(e){const t=document.getElementById("status");t&&(t.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-gray-200 text-gray-700",t.innerHTML='<div class="h-2 w-2 rounded-full bg-gray-500 mr-2 animate-pulse"></div><span>Loading...</span>');try{const r=y(f,"users",e.uid),s=await I(r);if(s.exists()){const i=s.data();console.log("User data loaded:",i),B(i);const o=(a,d,l="")=>{const c=document.getElementById(a);c?c.tagName==="INPUT"?(c.value=d||l,c.placeholder=d||l):c.textContent=d||l:console.warn(`Element with id "${a}" not found`)};o("firstName",i.firstName,"First Name"),o("email",e.email,e.email);const n=document.getElementById("status");if(n){const a=i.status||"Processing...";switch(n.textContent=a,a.toLowerCase()){case"active":n.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-gray-800 text-white",n.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2"></div><span>'+a+"</span>";break;case"suspended":n.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-gray-600 text-white",n.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2"></div><span>'+a+"</span>";break;case"banned":n.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-gray-900 text-white",n.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2"></div><span>'+a+"</span>";break;case"processing":n.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-gray-600 text-white",n.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2 animate-pulse"></div><span>'+a+"</span>";break;case"inactive":n.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-gray-500 text-white",n.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2"></div><span>'+a+"</span>";break;default:n.textContent="Processing",n.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-gray-600 text-white",n.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2 animate-pulse"></div><span>Processing</span>'}}}else{console.log("No user document found."),console.error("No user data found.");const i=document.getElementById("email");i&&(i.value=e.email,i.placeholder=e.email)}}catch(r){console.error("Error fetching user data:",r);const s=document.getElementById("status");s&&(s.className="inline-flex items-center text-xs md:text-sm px-4 py-2 rounded-full font-semibold shadow-sm bg-gray-900 text-white",s.innerHTML='<div class="h-2 w-2 rounded-full bg-white mr-2"></div><span>Error loading data</span>')}}let b=!1,w=null,p=!1;C(m,async e=>{w&&(clearTimeout(w),w=null),e?(p=!0,b=!0,console.log("User authenticated:",e.uid,e.email),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>L(e)):L(e)):(b||(await new Promise(t=>setTimeout(t,500)),b=!0),p?console.log("User state changed to null, but user was previously authenticated. Waiting..."):w=setTimeout(()=>{const t=m.currentUser;!t&&!p?(console.log("No user signed in after verification. Redirecting to sign-in page."),window.location.href="login.html"):t&&(console.log("Auth state changed - user is now authenticated, canceling redirect"),p=!0)},1e3))});window.signOut=function(){S(m).then(()=>{alert("Signed out successfully!"),window.location.href="login.html"}).catch(e=>{alert("Error signing out: "+e.message)})};window.updateProfile=async function(){var t,r;const e=m.currentUser;if(e){const s=y(f,"users",e.uid),i={firstName:((t=document.getElementById("firstName"))==null?void 0:t.value.trim())||"",lastName:((r=document.getElementById("lastName"))==null?void 0:r.value.trim())||""},o=document.querySelector('button[type="submit"]');o&&(o.disabled=!0,o.textContent="Saving changes...");try{await N(s,i,{merge:!0}),alert("Profile updated successfully!")}catch(n){console.error("Error updating profile:",n),alert("Error updating profile: "+n.message)}finally{o&&(o.disabled=!1,o.textContent="Save Changes")}}else alert("No user is currently signed in.")};window.showUserInfo=async function(){const e=m.currentUser;if(e)try{const t=y(f,"users",e.uid),r=await I(t);if(r.exists()){const s=r.data(),i=(n,a,d="")=>{const l=document.getElementById(n);l&&(l.value=a||d,l.hasAttribute("placeholder")&&(l.placeholder=a||d))};i("firstName",s.firstName,"First Name"),i("status",s.status,"status"),i("email",e.email),i("phone",s.phone);const o=document.getElementById("profileInfoCard");o&&o.classList.remove("hidden")}else console.log("No user document found."),alert("No user data found.")}catch(t){console.error("Error fetching user info:",t),alert("Error fetching user information.")}else alert("No user is currently signed in.")};
