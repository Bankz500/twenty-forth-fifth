import"./modulepreload-polyfill-B5Qt9EMX.js";import{b as L,a as B,k as se,c as Q,u as ae,g as q,d as T,e as $,h as re,f as le,l as ce,m as j,o as de,s as Z,n as me,j as K}from"./firebase-client-BuhbagS3.js";import"./firebase-config-CwkpdvL9.js";window.auth=L;window.db=B;window.firestoreHelpers={addDoc:le,collection:re,serverTimestamp:$,doc:T,getDoc:q,updateDoc:ae,setDoc:Q,deleteDoc:se};function ue(e){try{let o=document.getElementById("firebaseStatusBanner");o||(o=document.createElement("div"),o.id="firebaseStatusBanner",o.className="fixed top-0 left-0 right-0 z-50 bg-red-600 text-white text-sm px-4 py-3 shadow-lg",document.body.appendChild(o)),o.textContent=e}catch{}}window.addEventListener("unhandledrejection",e=>{var n;const o=((n=e==null?void 0:e.reason)==null?void 0:n.message)||String((e==null?void 0:e.reason)||"");(o.includes("auth/internal-error")||o.includes("Could not reach Cloud Firestore backend"))&&ue("Connection issue: Firebase could not be reached (offline/VPN/adblock). Please check your internet connection and try again.")});document.addEventListener("DOMContentLoaded",()=>{var e;try{const o=ce(),n=document.getElementById("user-first-name"),t=((e=L.currentUser)==null?void 0:e.uid)||null;if(!o||!n||n.textContent.trim()||!t)return;if(o.__uid&&o.__uid!==t){j();return}o.__uid===t&&ye(o)}catch{}},{passive:!0});let P=null,U=null,k=null,A=null;function M(){const e=document.getElementById("debitCardProgressWrap"),o=document.getElementById("debitCardProgressStatus"),n=document.getElementById("debitCardProgressBar"),t=document.getElementById("debitCardProgressText");if(!e||!o||!n||!t)return;const s=k&&(k.status||"active")==="active",i=((A==null?void 0:A.status)||"").toLowerCase();if(s){e.classList.add("hidden");return}if(i==="pending"){e.classList.remove("hidden"),o.textContent="Pending approval",n.style.width="60%",t.textContent="Your debit card request is being reviewed.";return}e.classList.add("hidden")}function fe(e){try{if(P){try{P()}catch{}P=null}if(U){try{U()}catch{}U=null}k=null,A=null;const o=T(B,"debit_cards",e.uid),n=T(B,"debit_card_applications",e.uid);P=K(o,t=>{k=t.exists()?t.data():null,M()},()=>{k=null,M()}),U=K(n,t=>{A=t.exists()?t.data():null,M()},()=>{A=null,M()})}catch(o){console.warn("Debit card progress setup failed",o)}}function ee(e,o){const n=o.split("|").map(E=>E.trim()),t=n[0]||"",s=n[1]||"",i=n[2]||"",a=n[3]||"",r=n[4]||"",d=n[5]||"",m=n.slice(6).join("|")||"";e.dataset.transactionType=t,e.dataset.transactionRecipient=s,e.dataset.transactionAmount=i,e.dataset.transactionTime=a,e.dataset.transactionDate=r,e.dataset.transactionReference=d,e.dataset.transactionNotes=m;const g=e.querySelector(".transaction-description"),u=e.querySelector(".transaction-recipient"),f=e.querySelector(".transaction-type"),c=e.querySelector(".transaction-amount"),l=e.querySelector(".transaction-date"),w=e.querySelector(".transaction-reference"),h=e.querySelector(".meta-row"),p=e.querySelector(".separator"),b=e.querySelector(".transaction-avatar"),y=e.querySelector(".transaction-avatar-text");g&&(g.textContent=t),u&&(u.textContent=s),f&&(f.textContent=t),c&&(c.textContent=i),l&&(l.textContent=r),w&&(w.textContent=d);const x=e.querySelector(".mobile-transaction-item");if(x){const E=x.querySelector(".mobile-transaction-description"),C=x.querySelector(".mobile-transaction-time"),I=x.querySelector(".mobile-transaction-amount"),S=x.querySelector(".mobile-transaction-icon"),v=x.querySelector(".transaction-icon-text-mobile");if(E&&(E.textContent=t||s||"Transaction"),C&&(C.textContent=a||r||"-"),I){I.textContent=i||"-";const N=i&&(i.startsWith("+")||i.includes("credit")||i.includes("deposit"));I.className="mobile-transaction-amount transaction-amount-mobile "+(N?"credit":"debit")}if(S&&v){const N=(t||"").toLowerCase();N.includes("cashback")||N.includes("refund")?(S.style.backgroundColor="#e0f2fe",v.textContent="₦",v.style.color="#0369a1"):N.includes("mtn")||N.includes("data")?(S.style.backgroundColor="#fef3c7",v.textContent="MTN",v.style.fontSize="10px",v.style.color="#1e40af"):N.includes("savings")||N.includes("deposit")?(S.style.backgroundColor="#ede9fe",v.textContent="K.",v.style.fontSize="12px",v.style.color="#7c3aed"):(S.style.backgroundColor="#e0f2fe",v.textContent="₦",v.style.color="#0369a1")}}if(h){const E=!!t&&t!=="-",C=!!r&&r!=="-";E||C?(h.classList.remove("hidden"),p&&(E&&C?p.classList.remove("hidden"):p.classList.add("hidden"))):h.classList.add("hidden")}if(b&&y){const E=(t||"").toLowerCase();let C="TX",I="bg-green-50",S="text-green-700";E.includes("deposit")?(C="DP",I="bg-green-50",S="text-green-700"):E.includes("transfer")?(C="TF",I="bg-indigo-50",S="text-indigo-700"):E.includes("refund")?(C="RF",I="bg-amber-50",S="text-amber-700"):E.includes("reversal")&&(C="RV",I="bg-rose-50",S="text-rose-700"),y.textContent=C,b.className="w-12 h-12 rounded-full flex items-center justify-center transaction-avatar font-semibold text-sm "+I+" "+S}}function ge(e){const o=document.getElementById("transactionDetailModal");if(!o||!e)return;const n=e.dataset.transactionType||"",t=e.dataset.transactionRecipient||"",s=e.dataset.transactionAmount||"",i=e.dataset.transactionTime||"",a=e.dataset.transactionDate||"",r=e.dataset.transactionReference||"",d=e.dataset.transactionNotes||"";let m=a;a&&i?m=`On ${a} at ${i}`:a?m=a:i&&(m=i);const g=s&&(s.startsWith("+")||s.includes("credit")||s.includes("deposit"));document.getElementById("detail-amount").textContent=s||"₦0.00",document.getElementById("detail-amount").className="transaction-detail-amount"+(g?" credit":""),document.getElementById("detail-type").textContent=(n||t||"Transaction").toUpperCase(),document.getElementById("detail-date").textContent=m||"-",document.getElementById("detail-description").textContent=d||n||t||"-",document.getElementById("detail-method").textContent=n||"-",document.getElementById("detail-reference").textContent=r||"-",document.getElementById("detail-from").textContent=t||"Kuda";const u=(n||"").toLowerCase();let f="Savings";u.includes("cashback")?f="Cashback":u.includes("mtn")||u.includes("data")?f="Data":u.includes("savings")&&(f="Savings"),document.getElementById("detail-category").textContent=f,window.innerWidth<768&&(o.classList.add("active"),document.body.style.overflow="hidden")}function Y(e){if(window.innerWidth>=768)return;const o=e.target.closest(".mobile-transaction-item");if(!o)return;const n=o.dataset.transactionId;if(!n)return;const t=document.getElementById(n);t&&t.dataset.transactionType&&t.dataset.transactionType!==""&&(e.preventDefault(),e.stopPropagation(),ge(t))}let F=!1,R=null;de(L,async e=>{if(R&&(clearTimeout(R),R=null),e){F=!0,console.log("User is logged in:",e.uid);const o=document.querySelectorAll(".accounts-section, #history-container");o.forEach(n=>{n&&(n.style.opacity="0.6")}),await pe(e),he(e),fe(e),o.forEach(n=>{n&&(n.style.opacity="1")})}else F||(await new Promise(o=>setTimeout(o,500)),F=!0),R=setTimeout(()=>{L.currentUser||(console.log("No user signed in. Redirecting to sign-in page."),j(),window.location.href="login.html")},1e3)});let te="$";window.formatAmountWithCurrency=function(e){const o=te||"$";if(!e&&e!==0)return o+"0.00";const n=typeof e=="string"?parseFloat(e.replace(/[^0-9.-]/g,""))||0:Number(e)||0,t=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(n);return o+t};async function ne(e){let o="$";try{const i=T(B,"settings","currency"),a=await q(i);a.exists()&&a.data().currencySign?(o=a.data().currencySign,console.log("Currency sign loaded from settings:",o)):console.log("Currency setting not found, using default: $")}catch(i){console.error("Error loading currency setting:",i)}te=o;const n=document.getElementById("checking"),t=document.getElementById("savings"),s=document.getElementById("fixed");if(n){const i=window.formatAmountWithCurrency(e.checking);n.textContent=i,console.log("Checking balance formatted:",i)}if(t){const i=window.formatAmountWithCurrency(e.savings);t.textContent=i,console.log("Savings balance formatted:",i)}if(s){const i=window.formatAmountWithCurrency(e.fixed);s.textContent=i,console.log("Fixed balance formatted:",i)}}async function pe(e){const o=T(B,"users",e.uid),n=await q(o);let t=null;if(n.exists())t=n.data()||{};else{let f=null;try{const p=(e.email||"").trim();if(p){const b=T(B,"users",p),y=await q(b);y.exists()&&(f=y.data()||{})}}catch(p){console.warn("Legacy email-doc migration skipped/failed:",p)}const c=f&&typeof f=="object"?f:{},l=e.displayName||"",w=c.firstName||(typeof c.name=="string"?c.name.split(" ")[0]:"")||(typeof c.fullName=="string"?c.fullName.split(" ")[0]:"")||(l?l.split(" ")[0]:"")||(e.email||"").split("@")[0]||"",h={...c,email:c.email||e.email||null,firstName:c.firstName||w||null,approvalStatus:c.approvalStatus||"approved",isApproved:typeof c.isApproved=="boolean"?c.isApproved:!0,approvedAt:c.approvedAt||$(),approvedBy:c.approvedBy||(f?"legacy_migrated":"legacy_auto"),createdAt:c.createdAt||$(),createdAtIso:c.createdAtIso||new Date().toISOString(),migratedFrom:f?"users/{email}":null};await Q(o,h,{merge:!0}),t=h}const s=(t==null?void 0:t.approvalStatus)||null,i=typeof(t==null?void 0:t.isApproved)=="boolean"?t.isApproved:null;if(!(s==="approved"||s==null&&i!==!1)){j();try{await Z(L)}catch{}window.location.href="login.html?pending=1";return}me({...t||{},__uid:e.uid,__email:e.email||(t==null?void 0:t.email)||null}),await ne(t),oe(t);const r=document.getElementById("user-first-name"),d=typeof t.firstName=="string"&&t.firstName.trim()?t.firstName.trim():typeof t.name=="string"&&t.name.trim()?t.name.trim().split(" ")[0]:typeof t.fullName=="string"&&t.fullName.trim()?t.fullName.trim().split(" ")[0]:e.email?e.email.split("@")[0]:"";r&&(r.textContent=d||"");const m=document.getElementById("cardholder-name"),g=document.getElementById("modal-cardholder-name");let u="";t.firstName&&t.lastName?u=`${String(t.firstName).toUpperCase()} ${String(t.lastName).toUpperCase()}`:t.firstName?u=String(t.firstName).toUpperCase():t.fullName?u=String(t.fullName).toUpperCase():t.name&&(u=String(t.name).toUpperCase()),u&&(m&&(m.textContent=u),g&&(g.textContent=u)),setTimeout(()=>{let f=!1,c=0;for(let h=1;h<=20;h++){const p=document.getElementById(`history${h}`);if(p){const b=t[`history${h}`]||"";if(b&&b.trim()!==""){if(ee(p,b),c<10){p.style.display="block";const y=p.querySelector(".mobile-transaction-item");y&&(y.style.display="flex"),c++}else{p.style.display="none";const y=p.querySelector(".mobile-transaction-item");y&&(y.style.display="none")}h>10&&(f=!0)}else{p.style.display="none";const y=p.querySelector(".mobile-transaction-item");y&&(y.style.display="none")}}}const l=document.getElementById("see-more");l&&(f?l.classList.remove("hidden"):l.classList.add("hidden"));const w=document.getElementById("recent-transactions");w&&(w.removeEventListener("click",Y),w.addEventListener("click",Y,{passive:!0}))},100),setTimeout(()=>{const f=document.getElementById("pending1"),c=document.getElementById("pending2"),l=document.getElementById("pending3"),w=document.getElementById("pending4"),h=document.getElementById("pending5"),p=document.getElementById("pending-list");function b(x,E){const C=E.split("|").map(ie=>ie.trim()),I=C[0]||"",S=C[1]||"",v=C[2]||"";C[3];const N=C[4]||"";C[5];const W=x.querySelector(".pending-description"),H=x.querySelector(".pending-recipient"),V=x.querySelector(".pending-type"),z=x.querySelector(".pending-amount"),O=x.querySelector(".pending-date"),J=x.querySelector(".pending-avatar"),G=x.querySelector(".pending-avatar-text");W&&(W.textContent=I),H&&(H.textContent=S),V&&(V.textContent=I),z&&(z.textContent=v),O&&(O.textContent=N),J&&G&&(G.textContent="PN",J.className="w-12 h-12 rounded-full flex items-center justify-center pending-avatar font-semibold text-sm bg-orange-50 text-orange-700")}function y(x){!p||!x||p.appendChild(x)}t.pending1&&t.pending1.trim()!==""&&(f.classList.remove("hidden"),b(f,t.pending1),y(f)),t.pending2&&t.pending2.trim()!==""&&(c.classList.remove("hidden"),b(c,t.pending2),y(c)),t.pending3&&t.pending3.trim()!==""&&(l.classList.remove("hidden"),b(l,t.pending3),y(l)),t.pending4&&t.pending4.trim()!==""&&(w.classList.remove("hidden"),b(w,t.pending4),y(w)),t.pending5&&t.pending5.trim()!==""&&(h.classList.remove("hidden"),b(h,t.pending5),y(h)),t.pending1&&t.pending2&&t.pending3&&t.pending4&&t.pending5&&t.pending1.trim()!==""&&t.pending2.trim()!==""&&t.pending3.trim()!==""&&t.pending4.trim()!==""&&t.pending5.trim()!==""?document.getElementById("pending-limit-notice").classList.remove("hidden"):document.getElementById("pending-limit-notice").classList.add("hidden")},200)}function oe(e){const o=document.getElementById("kycNotification"),n=document.getElementById("kycNotificationTitle"),t=document.getElementById("kycNotificationMessage"),s=document.getElementById("kycNotificationTime");if(!o||!n||!t||!s)return;const i=e.kycStatus||"not_completed";i==="pending"?(n.textContent="KYC Verification Pending",t.textContent="Your KYC document is currently under review. We will notify you once the verification is complete.",s.textContent="Recently",o.style.display="flex"):i==="reviewed"?(n.textContent="KYC Under Review",t.textContent="Your KYC document has been reviewed and is being processed. You will be notified once a decision is made.",s.textContent="Recently",o.style.display="flex"):i==="approved"||i==="completed"?(n.textContent="KYC Verification Approved",t.textContent="Congratulations! Your KYC verification has been approved. Your account now has full access to all features.",s.textContent="Recently",o.style.display="flex"):i==="rejected"||i==="declined"?(n.textContent="KYC Verification Rejected",t.textContent="Your KYC verification was not approved. Please upload a new valid government-issued ID document to complete verification.",s.textContent="Recently",o.style.display="flex"):(n.textContent="KYC Verification Required",t.textContent="Complete your KYC verification to unlock all account features. Upload a valid government-issued ID in the Security section.",s.textContent="Important",o.style.display="flex")}async function ye(e){var a;const o=((a=L.currentUser)==null?void 0:a.uid)||null;if(o&&(e!=null&&e.__uid)&&e.__uid!==o)return;await ne(e),oe(e),xe(e),Ce(e);const n=document.getElementById("user-first-name");e.firstName&&e.firstName.trim()!==""&&(n.textContent=e.firstName);const t=document.getElementById("cardholder-name"),s=document.getElementById("modal-cardholder-name");let i="";e.firstName&&e.lastName?i=`${e.firstName.toUpperCase()} ${e.lastName.toUpperCase()}`:e.firstName&&(i=e.firstName.toUpperCase()),i&&(t&&(t.textContent=i),s&&(s.textContent=i))}function xe(e){let o=!1,n=0;for(let i=1;i<=20;i++){const a=document.getElementById(`history${i}`);if(a){const r=e[`history${i}`]||"";if(r&&r.trim()!==""){if(ee(a,r),n<10){a.style.display="block";const d=a.querySelector(".mobile-transaction-item");d&&(d.style.display="flex"),n++}else{a.style.display="none";const d=a.querySelector(".mobile-transaction-item");d&&(d.style.display="none")}i>10&&(o=!0)}else{a.style.display="none";const d=a.querySelector(".mobile-transaction-item");d&&(d.style.display="none")}}}const t=document.getElementById("see-more");t&&(o?t.classList.remove("hidden"):t.classList.add("hidden"));const s=document.getElementById("recent-transactions");s&&(s.removeEventListener("click",Y),s.addEventListener("click",Y,{passive:!0}))}function Ce(e){const o=document.getElementById("pending1"),n=document.getElementById("pending2"),t=document.getElementById("pending3"),s=document.getElementById("pending4"),i=document.getElementById("pending5"),a=document.getElementById("pending-list");function r(d,m){const g=m.split("|").map(C=>C.trim()),u=g[0]||"",f=g[1]||"",c=g[2]||"";g[3];const l=g[4]||"";g[5];const w=d.querySelector(".pending-description"),h=d.querySelector(".pending-recipient"),p=d.querySelector(".pending-type"),b=d.querySelector(".pending-amount"),y=d.querySelector(".pending-date"),x=d.querySelector(".pending-avatar"),E=d.querySelector(".pending-avatar-text");w&&(w.textContent=u),h&&(h.textContent=f),p&&(p.textContent=u),b&&(b.textContent=c),y&&(y.textContent=l),x&&E&&(E.textContent="PN",x.className="w-12 h-12 rounded-full flex items-center justify-center pending-avatar font-semibold text-sm bg-orange-50 text-orange-700")}e.pending1&&e.pending1.trim()!==""&&(o.classList.remove("hidden"),r(o,e.pending1),a&&a.appendChild(o)),e.pending2&&e.pending2.trim()!==""&&(n.classList.remove("hidden"),r(n,e.pending2),a&&a.appendChild(n)),e.pending3&&e.pending3.trim()!==""&&(t.classList.remove("hidden"),r(t,e.pending3),a&&a.appendChild(t)),e.pending4&&e.pending4.trim()!==""&&(s.classList.remove("hidden"),r(s,e.pending4),a&&a.appendChild(s)),e.pending5&&e.pending5.trim()!==""&&(i.classList.remove("hidden"),r(i,e.pending5),a&&a.appendChild(i)),e.pending1&&e.pending2&&e.pending3&&e.pending4&&e.pending5&&e.pending1.trim()!==""&&e.pending2.trim()!==""&&e.pending3.trim()!==""&&e.pending4.trim()!==""&&e.pending5.trim()!==""?document.getElementById("pending-limit-notice").classList.remove("hidden"):document.getElementById("pending-limit-notice").classList.add("hidden")}window.signOut=function(){j(),Z(L).then(()=>{alert("Signed out successfully!"),window.location.href="login.html"}).catch(e=>{alert("Error signing out: "+e.message)})};let _=null;async function he(e){try{const o=T(B,"loans",e.uid);_&&_(),_=K(o,n=>{if(n.exists()){const t=n.data();console.log("Loan document updated:",t),console.log("Loan status:",t.status),be(t)}else console.log("Loan document does not exist"),D()},n=>{console.warn("Error listening to loan status:",n),n.code!=="permission-denied"&&D()})}catch(o){console.error("Error checking loan status:",o)}}function be(e){const o=e.status||e.loanStatus||"pending",n=String(o).toLowerCase().trim();e.loanAmount,e.submittedAt||e.createdAt,console.log("Updating loan status display:",{rawStatus:o,normalizedStatus:n,fullLoanData:e});const t=document.getElementById("loanStatusCard"),s=document.getElementById("loanProgressModal");s&&s.classList.add("hidden"),t?(t.classList.remove("hidden"),Ee(e,n)):console.error("Loan status card not found")}function Ee(e,o){const n=document.getElementById("loanStatusCard");if(!n)return;const t=e.loanAmount||0,s=e.submittedAt||e.createdAt;let i="N/A";s&&s.toDate&&(i=s.toDate().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}));const a=n.querySelector("#loanCardAmount"),r=n.querySelector("#loanCardStatus"),d=n.querySelector("#loanCardDate"),m=n.querySelector("#loanCardIcon"),g=n.querySelector("#loanCardTitle"),u=n.querySelector("#loanCardMessage");a&&(a.textContent=`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`),d&&(d.textContent=i),o==="approved"?(m&&(m.className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",m.innerHTML='<i class="fas fa-check-circle text-green-600 text-2xl"></i>'),g&&(g.textContent="Loan Approved"),u&&(u.textContent="Your loan application has been approved. View details to see repayment schedule."),r&&(r.textContent="Approved",r.className="px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700"),n.className="bg-white rounded-xl shadow-lg border-2 border-green-200 p-5 mb-6"):o==="rejected"?(m&&(m.className="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",m.innerHTML='<i class="fas fa-times-circle text-red-600 text-2xl"></i>'),g&&(g.textContent="Loan Rejected"),u&&(u.textContent="Your loan application was not approved. Contact support for more information."),r&&(r.textContent="Rejected",r.className="px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700"),n.className="bg-white rounded-xl shadow-lg border-2 border-red-200 p-5 mb-6"):(m&&(m.className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",m.innerHTML='<i class="fas fa-spinner fa-spin text-green-600 text-2xl"></i>'),g&&(g.textContent="Loan Under Review"),u&&(u.textContent="Your loan application is being reviewed. We will notify you once a decision is made."),r&&(r.textContent="Pending",r.className="px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-700"),n.className="bg-white rounded-xl shadow-lg border-2 border-green-200 p-5 mb-6"),n.dataset.loanData=JSON.stringify(e),n.dataset.loanStatus=o}function X(e,o){const n=document.getElementById("loanProgressModal"),t=document.getElementById("loanProgressIcon"),s=document.getElementById("loanProgressTitle"),i=document.getElementById("loanProgressMessage"),a=document.getElementById("loanProgressAmount"),r=document.getElementById("loanProgressStatus"),d=document.getElementById("loanProgressDate"),m=document.getElementById("loanProgressBar");if(!n){console.error("Loan progress modal not found");return}const g=String(o).toLowerCase().trim();console.log("Showing loan status modal with status:",g,"original:",o);const u=e.loanAmount||0,f=e.submittedAt||e.createdAt;let c="N/A";if(f&&f.toDate&&(c=f.toDate().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})),a.textContent=`$${u.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,d.textContent=c,g==="approved"){console.log("Setting modal to APPROVED state"),t.className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",t.innerHTML='<i class="fas fa-check-circle text-green-600 text-3xl"></i>',s.textContent="Loan Application Approved!",i.textContent="Congratulations! Your loan application has been approved. Click the button below to view your loan details and repayment schedule.",r.textContent="Approved",r.className="text-sm font-semibold text-green-600",m.style.width="100%",m.className="bg-green-600 h-2 rounded-full transition-all duration-500";const l=n.querySelector("button");l&&(l.innerHTML='<i class="fas fa-arrow-right mr-2"></i>View Loan Details',l.onclick=function(){window.location.href="loan.html"},l.className="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200")}else if(g==="rejected"){console.log("Setting modal to REJECTED state"),t.className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",t.innerHTML='<i class="fas fa-times-circle text-red-600 text-3xl"></i>',s.textContent="Loan Application Rejected",i.textContent="We're sorry, but your loan application has been rejected. Please contact support for more information or try applying again later.",r.textContent="Rejected",r.className="text-sm font-semibold text-red-600",m.style.width="100%",m.className="bg-red-600 h-2 rounded-full transition-all duration-500";const l=n.querySelector("button");l&&(l.innerHTML='<i class="fas fa-times mr-2"></i>Close',l.onclick=function(){closeLoanProgressModal()},l.className="w-full text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200",l.style.backgroundColor="#1800ac",l.onmouseover=function(){this.style.backgroundColor="#140099"},l.onmouseout=function(){this.style.backgroundColor="#1800ac"})}else{console.log("Setting modal to PENDING state"),t.className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",t.innerHTML='<i class="fas fa-spinner fa-spin text-green-600 text-3xl"></i>',s.textContent="Loan Application Under Review",i.textContent="Your loan application is being reviewed by our team. You will be notified once a decision has been made.",r.textContent="Pending",r.className="text-sm font-semibold text-yellow-600",m.style.width="50%",m.className="bg-green-600 h-2 rounded-full transition-all duration-500";const l=n.querySelector("button");l&&(l.innerHTML='<i class="fas fa-times mr-2"></i>Close',l.onclick=function(){closeLoanProgressModal()},l.className="w-full text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200",l.style.backgroundColor="#1800ac",l.onmouseover=function(){this.style.backgroundColor="#140099"},l.onmouseout=function(){this.style.backgroundColor="#1800ac"})}n.classList.remove("hidden")}function D(){const e=document.getElementById("loanStatusBadge"),o=document.getElementById("loanProgressModal"),n=document.getElementById("loanStatusCard");e&&e.classList.add("hidden"),o&&o.classList.add("hidden"),n&&n.classList.add("hidden")}window.openLoanProgressModal=function(){const e=document.getElementById("loanStatusCard");if(e&&e.dataset.loanData)try{const o=JSON.parse(e.dataset.loanData),n=e.dataset.loanStatus||o.status||"pending";X(o,n)}catch(o){console.error("Error parsing loan data:",o)}else{const o=L.currentUser;if(!o)return;const n=T(B,"loans",o.uid);q(n).then(t=>{if(t.exists()){const s=t.data();X(s,s.status||"pending")}}).catch(t=>{console.error("Error loading loan data:",t)})}};window.closeLoanProgressModal=function(){const e=document.getElementById("loanProgressModal");e&&e.classList.add("hidden")};
