import"./modulepreload-polyfill-B5Qt9EMX.js";import{o as B,d as y,a as u,g as v,b as f,s as b,i as L,c as x,e as S,f as k,h as P}from"./firebase-client-DvgkFHPb.js";import"./firebase-config-C56FTJjz.js";let h=null;B(f,async t=>{if(t){h=t;const n=y(u,"users",t.uid),o=await v(n);if(o.exists()){let r=function(){document.getElementById("kycStatus")?p(e):setTimeout(r,50)};const e=o.data(),s=document.getElementById("profileUsername"),d=document.getElementById("Deposit-account"),i=document.getElementById("Profit-wallet"),l=document.getElementById("wallet"),a=document.getElementById("welcome-message"),c=document.getElementById("displayEmail");s&&(s.textContent=e.firstName||"@syndicate"),d&&(d.textContent=e.deposit||"0.00"),i&&(i.textContent=e.profit||"0.00"),l&&(l.textContent=e.wallet||"0.00"),a&&(a.textContent=`Welcome ${e.firstName}`),c&&(c.textContent=t.email),r()}else console.log("No user document found."),alert("No user data found.")}else console.log("No user signed in. Redirecting to sign-in page."),window.location.href="login.html"});async function p(t){console.log("=== Loading KYC Status ==="),console.log("Full userData:",t),console.log("KYC Status value:",t.kycStatus),console.log("KYC Status type:",typeof t.kycStatus);const n=t.kycStatus||"not_completed",o=document.getElementById("kycStatus"),e=document.getElementById("kycStatusBadge"),s=document.getElementById("kycUploadSection"),d=document.getElementById("kycCompletedMessage"),i=document.getElementById("kycPendingMessage"),l=document.getElementById("kycRejectedMessage");if(!o||!e){console.error("KYC status elements not found"),console.error("kycStatusElement:",o),console.error("kycStatusBadge:",e);return}d&&d.classList.add("hidden"),i&&i.classList.add("hidden"),l&&l.classList.add("hidden");const a=String(n||"").trim(),c=a.toLowerCase();console.log("Raw status:",a,"Type:",typeof n),console.log("Normalized status:",c),console.log("Checking if status is approved or completed...");const r=a==="approved"||a==="completed"||c==="approved"||c==="completed"||c==="verified";if(console.log("Is approved?",r),r){console.log("✅ User is APPROVED - Setting verified tier 3 badge"),o.innerHTML='<i class="fas fa-star text-yellow-400 mr-1"></i> KYC Verified Tier 3',e.className="px-3 py-1 rounded text-xs font-medium bg-gradient-to-r from-yellow-500 to-yellow-600 text-white",e.style.display="inline-flex",e.style.alignItems="center",e.style.gap="4px",s&&s.classList.add("hidden"),d&&d.classList.remove("hidden");const w=document.querySelector(".bg-white.border.border-gray-300.rounded-lg.p-6");w&&(w.style.display="block"),console.log("✅ Badge updated successfully");return}else c==="rejected"?(console.log("Status is REJECTED"),o.textContent="KYC Rejected",e.className="px-3 py-1 rounded text-xs font-medium bg-red-600 text-white",s&&s.classList.remove("hidden"),l&&l.classList.remove("hidden")):c==="reviewed"?(console.log("Status is REVIEWED"),o.textContent="KYC Under Review",e.className="px-3 py-1 rounded text-xs font-medium bg-blue-600 text-white",s&&s.classList.add("hidden"),i&&(i.classList.remove("hidden"),i.innerHTML='<p class="text-sm text-gray-700"><strong class="text-gray-900">Status:</strong> Your KYC document has been reviewed and is being processed. You will be notified once a decision is made.</p>')):c==="pending"?(console.log("Status is PENDING"),o.textContent="KYC Pending Review",e.className="px-3 py-1 rounded text-xs font-medium bg-gray-600 text-white",s&&s.classList.add("hidden"),i&&(i.classList.remove("hidden"),i.innerHTML='<p class="text-sm text-gray-700"><strong class="text-gray-900">Status:</strong> Your KYC document is currently under review. You will be notified once the verification is complete.</p>')):(console.log("❌ Status is NOT COMPLETED. Normalized value:",c),console.log('Setting default "KYC Not Completed"'),o.textContent="KYC Not Completed",e.className="px-3 py-1 rounded text-xs font-medium bg-gray-400 text-white",s&&s.classList.remove("hidden"));console.log("=== KYC Status Load Complete ===")}window.loadKYCStatus=p;document.addEventListener("visibilitychange",()=>{if(!document.hidden&&h){const t=y(u,"users",h.uid);v(t).then(n=>{n.exists()&&p(n.data())})}});window.signOut=function(){b(f).then(()=>{alert("Signed out successfully!"),window.location.href="login.html"}).catch(t=>{alert("Error signing out: "+t.message)})};const M=document.getElementById("changePinForm");M.addEventListener("submit",t=>{t.preventDefault();const n=document.getElementById("newPin").value;if(n.length!==5||isNaN(n)){alert("Please enter a valid 5-digit PIN.");return}const o=document.getElementById("submitButton");o.disabled=!0,o.textContent="Processing...",setTimeout(()=>{document.getElementById("passwordModal").classList.remove("hidden"),o.disabled=!1,o.textContent="Change PIN"},1e3)});const E=document.getElementById("passwordConfirmForm");E.addEventListener("submit",async t=>{t.preventDefault();const n=document.getElementById("email").value,o=document.getElementById("firebasePassword").value,e=document.getElementById("newPin").value,s=E.querySelector('button[type="submit"]');s.disabled=!0,s.textContent="Processing...";try{const i=(await L(f,n,o)).user;if(i){const l=y(u,"users",i.uid);await x(l,{pin:e},{merge:!0});const a=document.createElement("div");a.textContent="PIN Change updated!",a.className="text-gray-700 text-xs text-center mt-4",E.parentElement.appendChild(a),setTimeout(()=>{document.getElementById("passwordModal").classList.add("hidden")},2e3)}}catch(d){console.error("Error updating PIN:",d),alert("Error updating PIN: "+d.message)}finally{s.disabled=!1,s.textContent="Confirm"}});window.handleKYCUpload=async function(){const t=document.getElementById("kycIdFile"),n=t.files[0];if(!n){alert("Please select a valid government issued ID image.");return}if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(n.type)){alert("Please upload a valid image file (JPEG, PNG, or WebP).");return}if(n.size>5*1024*1024){alert("File size must be less than 5MB.");return}const e=document.getElementById("uploadKYCButton");e.disabled=!0,e.textContent="Uploading...";try{const s=await N(n),d=f.currentUser;if(!d)throw new Error("User not authenticated");const i={userId:d.uid,userEmail:d.email,idImageBase64:s,status:"pending",submittedAt:S(),reviewedAt:null,reviewedBy:null};await k(P(u,"kyc_requests"),i);const l=y(u,"users",d.uid);await x(l,{kycStatus:"pending",kycIdImageLink:s},{merge:!0}),document.getElementById("kycSuccessModal").classList.remove("hidden"),document.getElementById("kycUploadSection").classList.add("hidden"),document.getElementById("kycPendingMessage").classList.remove("hidden");const a=await v(l);a.exists()&&p(a.data()),t.value="",document.getElementById("kycImagePreview").src="",document.getElementById("imagePreviewContainer").classList.add("hidden")}catch(s){console.error("Error uploading KYC:",s),alert("Error uploading KYC document: "+s.message)}finally{e.disabled=!1,e.textContent="Upload ID"}};function N(t){return new Promise((n,o)=>{const e=new FileReader;e.onload=()=>{const s=e.result;n(s)},e.onerror=o,e.readAsDataURL(t)})}window.togglePinVisibility=function(){const t=document.getElementById("newPin"),n=document.getElementById("eyeIcon");t.type==="password"?(t.type="text",n.innerHTML='<path d="M17.94 17.94A10.09 10.09 0 0 1 12 20c-7 0-11-8-11-8a18.66 18.66 0 0 1 3-4m3.53-2.36A10.09 10.09 0 0 1 12 4c7 0 11 8 11 8a18.3 18.3 0 0 1-1.72 2.82M15 12a3 3 0 1 0-3 3m8.17 8.17L3 3"></path>'):(t.type="password",n.innerHTML='<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>')};window.previewKYCImage=function(t){const n=t.target.files[0];if(n){const o=new FileReader;o.onload=function(e){const s=document.getElementById("kycImagePreview"),d=document.getElementById("imagePreviewContainer");s.src=e.target.result,s.classList.remove("hidden"),d.classList.remove("hidden")},o.readAsDataURL(n)}};window.closeKYCSuccessModal=function(){document.getElementById("kycSuccessModal").classList.add("hidden")};const m=document.getElementById("mobile-menu"),g=document.getElementById("overlay"),I=document.getElementById("mobile-menu-button"),C=document.getElementById("close-menu");if(m&&g&&I&&C){let t=function(){m.classList.remove("translate-x-full"),g.classList.remove("hidden"),document.body.style.overflow="hidden"},n=function(){m.classList.add("translate-x-full"),g.classList.add("hidden"),document.body.style.overflow=""};I.addEventListener("click",t),C.addEventListener("click",n),g.addEventListener("click",n),m.querySelectorAll("a").forEach(o=>{o.addEventListener("click",n)})}
