<!-- Cookie Consent Banner -->
<div id="cookie-consent-banner" class="hidden fixed bottom-0 left-0 right-0 z-50 bg-white border-t-2 border-blue-200 shadow-2xl">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6">
    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
      <div class="flex-1">
        <div class="flex items-center gap-2 mb-2">
          <i class="fas fa-cookie-bite text-blue-600 text-xl"></i>
          <h3 class="text-lg font-semibold text-blue-950">We care about your privacy</h3>
        </div>
        <p class="text-sm text-blue-800 leading-relaxed">
          By clicking "Accept All Cookies", you agree to the storing of cookies on your device to enhance site navigation, analyze site usage, and assist in our marketing efforts. If you would like to modify your preferences, please click the <strong>Manage Preferences</strong>.
        </p>
      </div>
      <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
        <button id="accept-all-cookies" class="btn-blue px-6 py-2.5 rounded-xl font-semibold text-sm inline-flex items-center justify-center shadow-sm whitespace-nowrap">
          <i class="fas fa-check mr-2"></i>Accept Cookies
        </button>
        <button id="reject-all-cookies" class="px-6 py-2.5 rounded-xl font-semibold text-sm inline-flex items-center justify-center border border-blue-200 bg-white text-blue-950 hover:bg-blue-50 transition whitespace-nowrap">
          <i class="fas fa-times mr-2"></i>Reject All
        </button>
        <button id="manage-preferences" class="px-6 py-2.5 rounded-xl font-semibold text-sm inline-flex items-center justify-center border border-blue-200 bg-white text-blue-950 hover:bg-blue-50 transition whitespace-nowrap">
          <i class="fas fa-cog mr-2"></i>Manage Preferences
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Cookie Preferences Modal -->
<div id="cookie-preferences-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
  <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
    <!-- Background overlay -->
    <div class="fixed inset-0 bg-blue-950/60 transition-opacity" onclick="closeCookiePreferences()"></div>

    <!-- Modal panel -->
    <div class="inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
      <div class="bg-white px-6 py-5 border-b border-blue-100">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <i class="fas fa-cookie-bite text-blue-600 text-2xl"></i>
            <h3 class="text-2xl font-bold text-blue-950">Cookie Preferences</h3>
          </div>
          <button onclick="closeCookiePreferences()" class="text-blue-700 hover:text-blue-950 transition">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        <p class="mt-2 text-sm text-blue-800">Manage your cookie preferences. You can enable or disable different types of cookies below.</p>
      </div>

      <div class="px-6 py-6 space-y-6 max-h-96 overflow-y-auto">
        <!-- Essential Cookies -->
        <div class="border border-blue-100 rounded-xl p-4">
          <div class="flex items-center justify-between mb-3">
            <div>
              <h4 class="font-semibold text-blue-950">Essential Cookies</h4>
              <p class="text-sm text-blue-700 mt-1">Required for the website to function properly</p>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" class="sr-only peer" id="essential-cookies" checked disabled>
              <div class="w-11 h-6 bg-blue-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
            </label>
          </div>
          <p class="text-xs text-blue-600">These cookies cannot be disabled as they are essential for the website to function.</p>
        </div>

        <!-- Analytics Cookies -->
        <div class="border border-blue-100 rounded-xl p-4">
          <div class="flex items-center justify-between mb-3">
            <div>
              <h4 class="font-semibold text-blue-950">Analytics Cookies</h4>
              <p class="text-sm text-blue-700 mt-1">Help us understand how visitors interact with our website</p>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" class="sr-only peer" id="analytics-cookies">
              <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
            </label>
          </div>
          <p class="text-xs text-blue-600">These cookies collect information about how you use our website to help us improve it.</p>
        </div>

        <!-- Marketing Cookies -->
        <div class="border border-blue-100 rounded-xl p-4">
          <div class="flex items-center justify-between mb-3">
            <div>
              <h4 class="font-semibold text-blue-950">Marketing Cookies</h4>
              <p class="text-sm text-blue-700 mt-1">Used to deliver personalized advertisements</p>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" class="sr-only peer" id="marketing-cookies">
              <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
            </label>
          </div>
          <p class="text-xs text-blue-600">These cookies are used to show you relevant advertisements based on your interests.</p>
        </div>
      </div>

      <div class="bg-blue-50 px-6 py-4 border-t border-blue-100 flex flex-col sm:flex-row gap-3 justify-end">
        <button onclick="closeCookiePreferences()" class="px-6 py-2.5 rounded-xl font-semibold text-sm inline-flex items-center justify-center border border-blue-200 bg-white text-blue-950 hover:bg-blue-50 transition">
          Cancel
        </button>
        <button id="save-preferences" class="btn-blue px-6 py-2.5 rounded-xl font-semibold text-sm inline-flex items-center justify-center shadow-sm">
          <i class="fas fa-save mr-2"></i>Save Preferences
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Cookie Consent Script -->
<script>
(function() {
  // Wait for DOM to be ready
  function initCookieConsent() {
    const COOKIE_CONSENT_KEY = 'fci_cookie_consent';
    const COOKIE_PREFERENCES_KEY = 'fci_cookie_preferences';
    
    const banner = document.getElementById('cookie-consent-banner');
    const modal = document.getElementById('cookie-preferences-modal');
    const acceptAllBtn = document.getElementById('accept-all-cookies');
    const rejectAllBtn = document.getElementById('reject-all-cookies');
    const managePrefsBtn = document.getElementById('manage-preferences');
    const savePrefsBtn = document.getElementById('save-preferences');
    
    if (!banner) return; // Exit if banner doesn't exist
    
    // Check if user has already made a choice
    function hasConsent() {
      return localStorage.getItem(COOKIE_CONSENT_KEY) !== null;
    }
    
    // Get stored preferences
    function getPreferences() {
      const stored = localStorage.getItem(COOKIE_PREFERENCES_KEY);
      if (stored) {
        try {
          return JSON.parse(stored);
        } catch {
          return null;
        }
      }
      return null;
    }
    
    // Save preferences
    function savePreferences(prefs) {
      localStorage.setItem(COOKIE_PREFERENCES_KEY, JSON.stringify(prefs));
      localStorage.setItem(COOKIE_CONSENT_KEY, 'true');
    }
    
    // Show banner if no consent given
    if (!hasConsent()) {
      banner.classList.remove('hidden');
    }
    
    // Accept all cookies
    if (acceptAllBtn) {
      acceptAllBtn.addEventListener('click', () => {
        const prefs = {
          essential: true,
          analytics: true,
          marketing: true,
          timestamp: new Date().toISOString()
        };
        savePreferences(prefs);
        banner.classList.add('hidden');
      });
    }
    
    // Reject all cookies (except essential)
    if (rejectAllBtn) {
      rejectAllBtn.addEventListener('click', () => {
        const prefs = {
          essential: true,
          analytics: false,
          marketing: false,
          timestamp: new Date().toISOString()
        };
        savePreferences(prefs);
        banner.classList.add('hidden');
      });
    }
    
    // Open preferences modal
    if (managePrefsBtn) {
      managePrefsBtn.addEventListener('click', () => {
        const prefs = getPreferences();
        const analyticsCheckbox = document.getElementById('analytics-cookies');
        const marketingCheckbox = document.getElementById('marketing-cookies');
        
        if (prefs && analyticsCheckbox && marketingCheckbox) {
          analyticsCheckbox.checked = prefs.analytics || false;
          marketingCheckbox.checked = prefs.marketing || false;
        }
        if (modal) modal.classList.remove('hidden');
      });
    }
    
    // Close preferences modal
    window.closeCookiePreferences = function() {
      if (modal) modal.classList.add('hidden');
    };
    
    // Save preferences from modal
    if (savePrefsBtn) {
      savePrefsBtn.addEventListener('click', () => {
        const analyticsCheckbox = document.getElementById('analytics-cookies');
        const marketingCheckbox = document.getElementById('marketing-cookies');
        
        const prefs = {
          essential: true,
          analytics: analyticsCheckbox ? analyticsCheckbox.checked : false,
          marketing: marketingCheckbox ? marketingCheckbox.checked : false,
          timestamp: new Date().toISOString()
        };
        savePreferences(prefs);
        if (modal) modal.classList.add('hidden');
        banner.classList.add('hidden');
      });
    }
    
    // Load saved preferences and apply them
    const savedPrefs = getPreferences();
    if (savedPrefs) {
      // Apply analytics cookies if enabled
      if (savedPrefs.analytics) {
        // Initialize analytics here if needed
        console.log('Analytics cookies enabled');
      }
      
      // Apply marketing cookies if enabled
      if (savedPrefs.marketing) {
        // Initialize marketing scripts here if needed
        console.log('Marketing cookies enabled');
      }
    }
  }
  
  // Initialize when DOM is ready or after a short delay (for async includes)
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCookieConsent);
  } else {
    // DOM already loaded, but component might be loaded async
    setTimeout(initCookieConsent, 100);
  }
  
  // Also listen for the fragments-loaded event
  window.addEventListener('site:fragments-loaded', initCookieConsent);
})();
</script>

